#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ПрограммныйИнтерфейс

// Добавляет записи в регистр заданий.
//
// Параметры:
//  ОбъектРасчета	 - ДокументСсылка.ЭтапПроизводства2_2	 - документ, для которого необходимо добавить задание.
//  АвтоЗапуск		 - Булево								 - автоматический запуск расчет фоновым заданием.
//
Процедура ДобавитьЗадание(ОбъектРасчета, Автозапуск = Истина) Экспорт
	
	Задание = Новый Структура("ОбъектРасчета", ОбъектРасчета);
	
	Идентификаторы = ПроизводствоСервер.ДобавитьЗаданиеВОчередь("ЗаданияКРасчетуОчередиПроизводственныхОпераций", Задание);
	
	Если Автозапуск Тогда
		
		ПроизводствоСервер.ЗапуститьЗаданиеОбработкиОчереди("ЗаданияКРасчетуОчередиПроизводственныхОпераций", Задание, Идентификаторы);
		
	КонецЕсли;
	
КонецПроцедуры

// Запускает в фоновом режиме задание расчета очереди производственных операций
//
Процедура ЗапуститьЗадание() Экспорт
	
	ПроизводствоСервер.ЗапуститьЗаданиеОбработкиОчереди("ЗаданияКРасчетуОчередиПроизводственныхОпераций");
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

Функция ПараметрыОбработки() Экспорт
	
	ПараметрыОбработки = Новый Структура;
	ПараметрыОбработки.Вставить("Обработчик", "РегистрыСведений.ОчередьПроизводственныхОпераций.РассчитатьОчередьОтложенно");
	ПараметрыОбработки.Вставить("ДополнительныеДанные", Новый Структура);
	Возврат ПараметрыОбработки;
	
КонецФункции

Функция ОчередьЗаданий(Отбор = Неопределено) Экспорт
	
	ЗаданияКОбработке = ПроизводствоСервер.ОчередьЗаданий("ЗаданияКРасчетуОчередиПроизводственныхОпераций", Отбор);
	Возврат ЗаданияКОбработке;
	
КонецФункции

Функция ВыбратьИзОчереди(МенеджерВременныхТаблиц) Экспорт
	
	Очередь = ПроизводствоСервер.ВыбратьИзОчереди("ЗаданияКРасчетуОчередиПроизводственныхОпераций", МенеджерВременныхТаблиц);
	Возврат Очередь;
	
КонецФункции

Процедура УдалитьЗадание(Задание, МенеджерВременныхТаблиц) Экспорт
	
	ПроизводствоСервер.УдалитьЗадание("ЗаданияКРасчетуОчередиПроизводственныхОпераций", Задание, МенеджерВременныхТаблиц);
	
КонецПроцедуры

Процедура ЗаписатьОшибку(Задание, ПропуститьЗадание, ИнформацияОбОшибке) Экспорт
	
	ТекстОшибки = ПодробноеПредставлениеОшибки(ИнформацияОбОшибке);
	
	ПроизводствоСервер.ЗаписатьОшибкуОбработкиОчередиЗаданий("ЗаданияКРасчетуОчередиПроизводственныхОпераций", ТекстОшибки, Задание);
	
КонецПроцедуры

#КонецОбласти

#КонецЕсли