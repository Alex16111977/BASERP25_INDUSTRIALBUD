
#Область СлужебныйПрограммныйИнтерфейс

/// Получение описаний вычетов для представления пользователю.
//	Параметры:
//		Вычеты - ссылок на вычеты
// 	Возвращает: 
//		Соответствие ссылок вычетов и их описаний.
Функция ПолучитьОписаниеЛьготы(Льгота, ВключатьЛьготуВОписание = Ложь) Экспорт
	Если ЗначениеЗаполнено(Льгота) Тогда
		ДанныеЛьготы = ОбщегоНазначения.ЗначенияРеквизитовОбъекта(Льгота, "Наименование, Код");
		Если ВключатьЛьготуВОписание Тогда
			Возврат ДанныеЛьготы.Код + " " + ДанныеЛьготы.Наименование;
		Иначе
			Возврат ДанныеЛьготы.Наименование;
		КонецЕсли;	
	Иначе
		Возврат НСтр("ru='Льгота не указана';uk='Пільга не вказана'");
	КонецЕсли;
	
КонецФункции

Функция ПолучитьОписаниеКодаДохода(КодДохода) Экспорт
	ОписаниеКодаДохода = ОбщегоНазначения.ЗначенияРеквизитовОбъекта(КодДохода, "ВычетРассчитываетсяАвтоматически, ВычетПоУмолчанию, ИмеетЕдинственныйВычет");	
			
	Возврат ОписаниеКодаДохода;
КонецФункции	

Функция ВычетыКДоходам(ГодНалоговогоПериода) Экспорт
	Возврат УчетНДФЛ.ВычетыКДоходам(ГодНалоговогоПериода);	
КонецФункции


// Обработчик события "ОбработкаПолученияДанныхВыбора" модуля менеджера справочника ВидыЛьготПоНДФЛ.
//
// Параметры:
//  	ДанныеВыбора			- СписокЗначений
//		Параметры				- Структура
//		СтандартнаяОбработка	- Булево
//
Процедура ВидыЛьготНДФЛОбработкаПолученияДанныхВыбора(ДанныеВыбора, Параметры, СтандартнаяОбработка) Экспорт
	
	Начисление = Неопределено;
	КодДохода = Неопределено;
	МесяцНачисления = Неопределено;
	НалоговыйПериод = Неопределено;
	ГруппаВычета = Неопределено;
	
	Параметры.Свойство("Начисление", Начисление);
	Параметры.Свойство("КодДохода", КодДохода);
	Параметры.Свойство("МесяцНачисления", МесяцНачисления);
	Параметры.Свойство("НалоговыйПериод", НалоговыйПериод);
	
	Если МесяцНачисления <> Неопределено И НалоговыйПериод = Неопределено Тогда
		НалоговыйПериод = Год(МесяцНачисления)
	КонецЕсли;
	Если Начисление <> Неопределено Тогда
		КодДохода = ОбщегоНазначения.ЗначениеРеквизитаОбъекта(Начисление, "КодДоходаНДФЛ");
	КонецЕсли;
	
		
	
		
		ДанныеВыбора = Новый СписокЗначений;

		ДоступныеВычеты = УчетНДФЛ.ВычетыНалогоплательщика(НалоговыйПериод, ГруппаВычета);
		ЗаполнитьДанныеВыбораПоДоступнымВычетам(ДанныеВыбора, ДоступныеВычеты, Параметры, СтандартнаяОбработка);
		СтандартнаяОбработка = Ложь;
		
		Возврат;
		
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

// Вспомогательные функции и процедуры

Процедура ЗаполнитьДанныеВыбораПоДоступнымВычетам(ДанныеВыбора, ДоступныеВычеты, Параметры, СтандартнаяОбработка)
	
	Если ПустаяСтрока(Параметры.СтрокаПоиска) Тогда 
		
		ЗначенияРеквизитовВычетов = ОбщегоНазначения.ЗначенияРеквизитовОбъектов(ДоступныеВычеты, "Код,Наименование");
		Для каждого Вычет Из ДоступныеВычеты Цикл
			ЗначенияРеквизитовВычета = ЗначенияРеквизитовВычетов.Получить(Вычет);
			ДанныеВыбора.Добавить(Вычет, СокрЛП(ЗначенияРеквизитовВычета.Код) + " (" + ЗначенияРеквизитовВычета.Наименование + ")");
		КонецЦикла;
		
	Иначе 	
		Параметры.Отбор.Вставить("Ссылка", Новый ФиксированныйМассив(ДоступныеВычеты));
		ЗарплатаКадрыВызовСервера.ПодготовитьДанныеВыбораКлассификаторовСПорядкомКодов(ДанныеВыбора, Параметры, СтандартнаяОбработка, "Справочник.ВидыЛьготПоНДФЛ");
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти
