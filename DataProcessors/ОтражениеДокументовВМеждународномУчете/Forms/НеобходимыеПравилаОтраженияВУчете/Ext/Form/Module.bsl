#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если Параметры.Свойство("АвтоТест") Тогда // Возврат при получении формы для анализа.
		Возврат;
	КонецЕсли;
	
	РезультатПроверки = ПолучитьИзВременногоХранилища(Параметры.АдресРезультатаПроверки);
	
	ХозяйственныеОперацииБезПравилОтражения.Загрузить(РезультатПроверки.ХозяйственныеОперацииБезПравилОтражения);
	СчетаБезПравилОтражения.Загрузить(РезультатПроверки.СчетаБезПравилОтражения);
	
	Организация = Параметры.Организация;
	
	УстановитьВидимостьЭлементовФормы();
	
КонецПроцедуры

&НаКлиенте
Процедура ПриЗакрытии()
	
	Оповестить("ЗакрытаФормаНастройкиНеобходимыхПравилОтраженияВУчете");
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиСобытийЭлементовФормы

&НаКлиенте
Процедура ХозяйственныеОперацииБезПравилОтраженияВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	
	ТекущиеДанные = ХозяйственныеОперацииБезПравилОтражения.НайтиПоИдентификатору(ВыбраннаяСтрока);
	МеждународныйУчетПоДаннымОперативногоУчетаКлиент.ОткрытьНастройкуШаблоновПроводок(
		ТекущиеДанные.УчетнаяПолитика, ТекущиеДанные.Операция, ЭтаФорма);
	
КонецПроцедуры

&НаКлиенте
Процедура ХозяйственныеОперацииБезПравилОтраженияПриАктивизацииСтроки(Элемент)
	
	ПодключитьОбработчикОжидания("ОбработчикиПолучитьСписокДокументовПоХозяйственнойОперации", 0.2, Истина);
	
КонецПроцедуры

&НаКлиенте
Процедура СчетаБезПравилОтраженияПриАктивизацииСтроки(Элемент)
	
	ПодключитьОбработчикОжидания("ОбработчикиПолучитьСписокДокументовПоСчету", 0.2, Истина);
	
КонецПроцедуры

&НаКлиенте
Процедура СтраницыПриСменеСтраницы(Элемент, ТекущаяСтраница)
	
	Если Элементы.Страницы.ТекущаяСтраница = Элементы.СтраницаСчетаБезПравилОтражения Тогда
		ОбработчикиПолучитьСписокДокументовПоСчету();
	Иначе
		ОбработчикиПолучитьСписокДокументовПоХозяйственнойОперации();
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура СписокДокументовПоСчетуВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	
	ТекущиеДанные = СписокДокументов.НайтиПоИдентификатору(ВыбраннаяСтрока);
	ПоказатьЗначение(, ТекущиеДанные.Документ);
	
КонецПроцедуры

&НаКлиенте
Процедура СписокДокументовПоОперацииВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	
	ТекущиеДанные = СписокДокументов.НайтиПоИдентификатору(ВыбраннаяСтрока);
	ПоказатьЗначение(, ТекущиеДанные.Документ);
	
КонецПроцедуры

&НаКлиенте
Процедура СчетаБезПравилОтраженияВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	
	НастроитьСоответствиеСчетов(ВыбраннаяСтрока);
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура НастроитьШаблонПроводки(Команда)
	
	ТекущиеДанные = Элементы.ХозяйственныеОперацииБезПравилОтражения.ТекущиеДанные;
	
	Если ТекущиеДанные = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	МеждународныйУчетПоДаннымОперативногоУчетаКлиент.ОткрытьНастройкуШаблоновПроводок(
		ТекущиеДанные.УчетнаяПолитика, ТекущиеДанные.Операция, ЭтаФорма);
	
КонецПроцедуры

&НаКлиенте
Процедура НастроитьСоответствиеСчетов(Команда)
	
	ТекущиеДанные = Элементы.СчетаБезПравилОтражения.ТекущиеДанные;
	Если ТекущиеДанные = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	МеждународныйУчетПоДаннымРеглУчетаКлиент.ОткрытьНастройкуСоответствияСчетовИОборотов(
		ТекущиеДанные.УчетнаяПолитика,
		ТекущиеДанные.Счет,
		ЭтаФорма);

КонецПроцедуры

&НаКлиенте
Процедура Обновить(Команда)
	
	ПроверитьНастройкуПравилСервер();
	
КонецПроцедуры

&НаКлиенте
Процедура ПроводкиМеждународногоУчетаПоДокументуОперации(Команда)
	
	ПроводкиМеждународногоУчетаПоДокументу(Элементы.СписокДокументовПоОперации.ТекущаяСтрока);
	
КонецПроцедуры

&НаКлиенте
Процедура ПроводкиМеждународногоУчетаПоДокументуСчета(Команда)
	
	ПроводкиМеждународногоУчетаПоДокументу(Элементы.СписокДокументовПоСчету.ТекущаяСтрока);
	
КонецПроцедуры

&НаКлиенте
Процедура ПроводкиРеглУчетаДокументаПоСчету(Команда)
	
	ТекущиеДанные = Элементы.СписокДокументовПоСчету.ТекущиеДанные;
	Если ТекущиеДанные = Неопределено Тогда
		Возврат;
	КонецЕсли;
	МеждународныйУчетПоДаннымРеглУчетаКлиент.ОткрытьПроводкиРеглУчета(ТекущиеДанные.Документ, ЭтаФорма);
	
КонецПроцедуры

&НаКлиенте
Процедура ПроводкиРеглУчетаДокументуПоОперации(Команда)
	
	ТекущиеДанные = Элементы.СписокДокументовПоОперации.ТекущиеДанные;
	Если ТекущиеДанные = Неопределено Тогда
		Возврат;
	КонецЕсли;
	МеждународныйУчетПоДаннымРеглУчетаКлиент.ОткрытьПроводкиРеглУчета(ТекущиеДанные.Документ, ЭтаФорма);
	
КонецПроцедуры

&НаКлиенте
Процедура ОткрытьДокументОперации(Команда)
	
	ОткрытьДокумент(Элементы.СписокДокументовПоОперации.ТекущаяСтрока);
	
КонецПроцедуры

&НаКлиенте
Процедура ОткрытьДокументСчета(Команда)
	
	ОткрытьДокумент(Элементы.СписокДокументовПоСчету.ТекущаяСтрока);
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаСервере
Процедура УстановитьВидимостьЭлементовФормы()
	
	Элементы.СтраницаХозяйственныеОперацииБезПравилОтражения.Заголовок =
		СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
			НСтр("ru='Шаблоны проводок (%1)';uk='Шаблони проводок (%1)'"), 
			ХозяйственныеОперацииБезПравилОтражения.Количество());
	
	Элементы.СтраницаСчетаБезПравилОтражения.Заголовок =
		СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
			НСтр("ru='Соответствующие счета международного учета (%1)';uk='Відповідні рахунки міжнародного обліку (%1)'"), 
			СчетаБезПравилОтражения.Количество());
	
	Элементы.СтраницаХозяйственныеОперацииБезПравилОтражения.Видимость = ХозяйственныеОперацииБезПравилОтражения.Количество() > 0;
	
	Элементы.СтраницаСчетаБезПравилОтражения.Видимость = СчетаБезПравилОтражения.Количество() > 0;;
	
	Элементы.СтраницаНастроеныВсеПравилаОтражения.Видимость = 
		(ХозяйственныеОперацииБезПравилОтражения.Количество() = 0) И (СчетаБезПравилОтражения.Количество() = 0);
	
	ВидимыеСтраницы = Новый Массив;
	Для каждого Страница Из Элементы.Страницы.ПодчиненныеЭлементы Цикл
		Если Страница.Видимость Тогда
			ВидимыеСтраницы.Добавить(Страница);
		КонецЕсли;
	КонецЦикла;
	
	Элементы.Страницы.ОтображениеСтраниц = 
		?(ВидимыеСтраницы.Количество() = 1, ОтображениеСтраницФормы.Нет, ОтображениеСтраницФормы.ЗакладкиСверху);
	
КонецПроцедуры

&НаКлиенте
Процедура ОткрытьДокумент(ИдентификаторСтроки)
	
	Если ИдентификаторСтроки = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	ТекущиеДанные = СписокДокументов.НайтиПоИдентификатору(ИдентификаторСтроки);
	Если ТекущиеДанные = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	ПоказатьЗначение(,ТекущиеДанные.Документ);
	
КонецПроцедуры

&НаКлиенте
Процедура ПроводкиМеждународногоУчетаПоДокументу(ИдентификаторСтроки)
	
	Если ИдентификаторСтроки = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	ТекущиеДанные = СписокДокументов.НайтиПоИдентификатору(ИдентификаторСтроки);
	
	ПараметрыОтбора = Новый Структура("Регистратор", ТекущиеДанные.Документ);
	ПараметрыФормы = Новый Структура("Отбор", ПараметрыОтбора);
	ОткрытьФорму("РегистрБухгалтерии.Международный.Форма.ПроводкиМеждународногоУчета",
		ПараметрыФормы, ЭтаФорма);
	
КонецПроцедуры

&НаСервере
Процедура ПроверитьНастройкуПравилСервер()
	
	РезультатПроверки = Обработки.ОтражениеДокументовВМеждународномУчете.ПроверитьНастройкуПравилОтраженияУчете(Организация);
	
	ХозяйственныеОперацииБезПравилОтражения.Загрузить(РезультатПроверки.ХозяйственныеОперацииБезПравилОтражения);
	СчетаБезПравилОтражения.Загрузить(РезультатПроверки.СчетаБезПравилОтражения);
	
	УстановитьВидимостьЭлементовФормы();
	
КонецПроцедуры

&НаКлиенте
Процедура ОбработчикиПолучитьСписокДокументовПоХозяйственнойОперации()

	ТекущиеДанные = Элементы.ХозяйственныеОперацииБезПравилОтражения.ТекущиеДанные;
	Если ТекущиеДанные = Неопределено Тогда
		СписокДокументов.Очистить();
	Иначе
		ЗаполнитьСписокДокументовПоХозяйственнойОперации(
			ТекущиеДанные.ХозяйственнаяОперация, 
			ТекущиеДанные.ИсточникДанных, 
			ТекущиеДанные.УчетнаяПолитика);
	КонецЕсли;

КонецПроцедуры

&НаКлиенте
Процедура ОбработчикиПолучитьСписокДокументовПоСчету()

	ТекущиеДанные = Элементы.СчетаБезПравилОтражения.ТекущиеДанные;
	Если ТекущиеДанные = Неопределено Тогда
		СписокДокументов.Очистить();
	Иначе
		ЗаполнитьТаблицуДокументовПоСчету(ТекущиеДанные.Счет, ТекущиеДанные.УчетнаяПолитика);
	КонецЕсли;

КонецПроцедуры

&НаСервере
Процедура ЗаполнитьСписокДокументовПоХозяйственнойОперации(ХозяйственнаяОперация, ИсточникДанных, УчетнаяПолитика)
	
	МеждународныйУчетПоДаннымОперативногоУчета.ЗаполнитьТаблицуДокументовПоОперации(
		СписокДокументов, ХозяйственнаяОперация, ИсточникДанных, УчетнаяПолитика, Организация);
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьТаблицуДокументовПоСчету(Счет, УчетнаяПолитика)
	
	МеждународныйУчетПоДаннымРеглУчета.ЗаполнитьТаблицуДокументовПоСчету(
		СписокДокументов, Счет, УчетнаяПолитика, Организация);
	
КонецПроцедуры

#КонецОбласти