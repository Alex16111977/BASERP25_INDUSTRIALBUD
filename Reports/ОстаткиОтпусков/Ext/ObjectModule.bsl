#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда
	
#Область ОбработчикиСобытий

Процедура ПриКомпоновкеРезультата(ДокументРезультат, ДанныеРасшифровки, СтандартнаяОбработка)
	
	// Получаем виртуальную таблицу Представления_КадровыеДанныеСотрудников.
	ИнициализироватьОтчет();
	
	НастройкиОтчета = КомпоновщикНастроек.ПолучитьНастройки();
	РассчитыватьОстатокОтпускаПоКалендарнымДням = КадровыйУчетРасширенный.НастройкиКадровогоУчета().РассчитыватьОстатокОтпускаПоКалендарнымДням;
	
	МассивСотрудников = Неопределено; 
	Для каждого ЭлементОтбора Из НастройкиОтчета.Отбор.Элементы Цикл
		Если ТипЗнч(ЭлементОтбора) = Тип("ЭлементОтбораКомпоновкиДанных")
			И ЭлементОтбора.ЛевоеЗначение = Новый ПолеКомпоновкиДанных("Сотрудник")
			И ЭлементОтбора.Использование Тогда
			
			МассивСотрудников = Новый Массив;
			МассивСотрудников.Добавить(ЭлементОтбора.ПравоеЗначение);
			
		КонецЕсли; 
	КонецЦикла; 
	
	ДатаОтчета = НастройкиОтчета.ПараметрыДанных.Элементы.Найти("ДатаОтчета");
	Если НЕ ДатаОтчета.Использование Тогда
		ДатаОтчета.Значение = Новый СтандартнаяДатаНачала(ВариантСтандартнойДатыНачала.НачалоЭтогоДня);
		ДатаОтчета.Использование = Истина;
	КонецЕсли;
	
	ОстаткиОтпусков.РасчетЗаработанныхОтпусков(МассивСотрудников, КонецДня(ДатаОтчета.Значение.Дата));
	
	Если РассчитыватьОстатокОтпускаПоКалендарнымДням Тогда
		ТаблицаСотрудников = Новый ТаблицаЗначений;
		ТаблицаСотрудников.Колонки.Добавить("Сотрудник", Новый ОписаниеТипов("СправочникСсылка.Сотрудники"));
		Для каждого Сотрудник Из МассивСотрудников Цикл
			Если ТипЗнч(Сотрудник) = Тип("СписокЗначений") Тогда
				Для Каждого СтрокаСотрудника Из Сотрудник Цикл
					СтрокаТаблицы = ТаблицаСотрудников.Добавить();
					СтрокаТаблицы.Сотрудник = СтрокаСотрудника.Значение  
				КонецЦикла	
			Иначе	
				СтрокаТаблицы = ТаблицаСотрудников.Добавить();
				СтрокаТаблицы.Сотрудник = Сотрудник  
			КонецЕсли	
		КонецЦикла;      
		
		Запрос = Новый Запрос;
		МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
		Запрос.МенеджерВременныхТаблиц = МенеджерВременныхТаблиц;
		Запрос.УстановитьПараметр("ТаблицаСотрудников", ТаблицаСотрудников);    

		Запрос.УстановитьПараметр("ДатаОтчета", КонецДня(ДатаОтчета.Значение.Дата));   
		
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ТаблицаСотрудников.Сотрудник
		|ПОМЕСТИТЬ ВТВыбранныеСотрудники
		|ИЗ
		|	&ТаблицаСотрудников КАК ТаблицаСотрудников
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ТекущиеКадровыеДанныеСотрудников.Сотрудник,
		|	ТекущиеКадровыеДанныеСотрудников.ДатаУвольнения
		|ПОМЕСТИТЬ ВТТекущиеКадровыеДанныеСотрудников
		|ИЗ
		|	РегистрСведений.ТекущиеКадровыеДанныеСотрудников КАК ТекущиеКадровыеДанныеСотрудников
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТВыбранныеСотрудники КАК ВТВыбранныеСотрудники
		|		ПО ТекущиеКадровыеДанныеСотрудников.Сотрудник = ВТВыбранныеСотрудники.Сотрудник
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ВидыОтпусков.Ссылка КАК ВидЕжегодногоОтпуска
		|ПОМЕСТИТЬ ВТЕжегодныеОтпуска
		|ИЗ
		|	Справочник.ВидыОтпусков КАК ВидыОтпусков
		|ГДЕ
		|	ВидыОтпусков.ОтпускЯвляетсяЕжегодным = ИСТИНА
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ЗаработанныеПраваНаОтпуска.Сотрудник КАК Сотрудник,
		|	ЗаработанныеПраваНаОтпуска.ВидЕжегодногоОтпуска КАК ВидЕжегодногоОтпуска,
		|	ЗаработанныеПраваНаОтпуска.ВидЕжегодногоОтпуска.УчитыватьОтпускВРазрезеКалендарногоГода КАК УчитыватьОтпускВРазрезеКалендарногоГода,
		|	ЗаработанныеПраваНаОтпуска.ДатаНачала КАК ДатаНачала,
		|	ЗаработанныеПраваНаОтпуска.ДатаОкончания КАК ДатаОкончания
		|ПОМЕСТИТЬ ВТСотрудникиИЗаработанныеПраваНаОтпускаПолная
		|ИЗ
		|	РегистрСведений.ЗаработанныеПраваНаОтпуска КАК ЗаработанныеПраваНаОтпуска
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТВыбранныеСотрудники КАК Сотрудники
		|		ПО ЗаработанныеПраваНаОтпуска.Сотрудник = Сотрудники.Сотрудник
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТЕжегодныеОтпуска КАК ЕжегодныеОтпуска
		|		ПО ЗаработанныеПраваНаОтпуска.ВидЕжегодногоОтпуска = ЕжегодныеОтпуска.ВидЕжегодногоОтпуска
		|ГДЕ
		|	ЗаработанныеПраваНаОтпуска.ДатаНачала < &ДатаОтчета
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	ЗаработанныеПраваНаОтпуска.Сотрудник КАК Сотрудник,
		|	ЗаработанныеПраваНаОтпуска.ВидЕжегодногоОтпуска КАК ВидЕжегодногоОтпуска,
		|	МИНИМУМ(ЗаработанныеПраваНаОтпуска.ДатаНачала) КАК ДатаНачалаОтсчета
		|ПОМЕСТИТЬ ВТДатыОтсчета
		|ИЗ
		|	ВТСотрудникиИЗаработанныеПраваНаОтпускаПолная КАК ЗаработанныеПраваНаОтпуска
		|
		|СГРУППИРОВАТЬ ПО
		|	ЗаработанныеПраваНаОтпуска.Сотрудник,
		|	ЗаработанныеПраваНаОтпуска.ВидЕжегодногоОтпуска
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ЗаработанныеПраваНаОтпуска.Сотрудник КАК Сотрудник,
		|	ЗаработанныеПраваНаОтпуска.ВидЕжегодногоОтпуска КАК ВидЕжегодногоОтпуска,
		|	ЗаработанныеПраваНаОтпуска.ДатаНачала КАК ДатаНачалаОбщая,
		|	ЗаработанныеПраваНаОтпуска.ДатаОкончания КАК ДатаОкончанияОбщая,
		|	ВЫБОР
		|		КОГДА ЗаработанныеПраваНаОтпуска.УчитыватьОтпускВРазрезеКалендарногоГода
		|			ТОГДА КОНЕЦПЕРИОДА(ЗаработанныеПраваНаОтпуска.ДатаНачала, ГОД)
		|		ИНАЧЕ ЗаработанныеПраваНаОтпуска.ДатаОкончания
		|	КОНЕЦ КАК ДатаОкончания,
		|	ВЫБОР
		|		КОГДА ЗаработанныеПраваНаОтпуска.УчитыватьОтпускВРазрезеКалендарногоГода
		|				И НЕ ЗаработанныеПраваНаОтпуска.ДатаНачала = ДатыОтсчета.ДатаНачалаОтсчета
		|			ТОГДА НАЧАЛОПЕРИОДА(ЗаработанныеПраваНаОтпуска.ДатаНачала, ГОД)
		|		ИНАЧЕ ЗаработанныеПраваНаОтпуска.ДатаНачала
		|	КОНЕЦ КАК ДатаНачала,
		|	ЗаработанныеПраваНаОтпуска.УчитыватьОтпускВРазрезеКалендарногоГода КАК УчитыватьОтпускВРазрезеКалендарногоГода
		|ПОМЕСТИТЬ ВТСотрудникиИЗаработанныеПраваНаОтпуска_
		|ИЗ
		|	ВТСотрудникиИЗаработанныеПраваНаОтпускаПолная КАК ЗаработанныеПраваНаОтпуска
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТДатыОтсчета КАК ДатыОтсчета
		|		ПО ЗаработанныеПраваНаОтпуска.ВидЕжегодногоОтпуска = ДатыОтсчета.ВидЕжегодногоОтпуска
		|			И ЗаработанныеПраваНаОтпуска.Сотрудник = ДатыОтсчета.Сотрудник
		|
		|СГРУППИРОВАТЬ ПО
		|	ЗаработанныеПраваНаОтпуска.ДатаНачала,
		|	ЗаработанныеПраваНаОтпуска.ДатаОкончания,
		|	ВЫБОР
		|		КОГДА ЗаработанныеПраваНаОтпуска.УчитыватьОтпускВРазрезеКалендарногоГода
		|			ТОГДА КОНЕЦПЕРИОДА(ЗаработанныеПраваНаОтпуска.ДатаНачала, ГОД)
		|		ИНАЧЕ ЗаработанныеПраваНаОтпуска.ДатаОкончания
		|	КОНЕЦ,
		|	ЗаработанныеПраваНаОтпуска.Сотрудник,
		|	ЗаработанныеПраваНаОтпуска.ВидЕжегодногоОтпуска,
		|	ВЫБОР
		|		КОГДА ЗаработанныеПраваНаОтпуска.УчитыватьОтпускВРазрезеКалендарногоГода
		|				И НЕ ЗаработанныеПраваНаОтпуска.ДатаНачала = ДатыОтсчета.ДатаНачалаОтсчета
		|			ТОГДА НАЧАЛОПЕРИОДА(ЗаработанныеПраваНаОтпуска.ДатаНачала, ГОД)
		|		ИНАЧЕ ЗаработанныеПраваНаОтпуска.ДатаНачала
		|	КОНЕЦ,
		|	ЗаработанныеПраваНаОтпуска.УчитыватьОтпускВРазрезеКалендарногоГода
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ЗаработанныеПраваНаОтпуска.Сотрудник КАК Сотрудник,
		|	ЗаработанныеПраваНаОтпуска.ВидЕжегодногоОтпуска КАК ВидЕжегодногоОтпуска,
		|	ВЫБОР
		|		КОГДА МАКСИМУМ(ЗаработанныеПраваНаОтпуска.ДатаОкончанияОбщая) > &ДатаОтчета
		|			ТОГДА &ДатаОтчета
		|		ИНАЧЕ МАКСИМУМ(ЗаработанныеПраваНаОтпуска.ДатаОкончанияОбщая)
		|	КОНЕЦ КАК ДатаОкончанияОбщая
		|ПОМЕСТИТЬ ВТКалендарныйГодПоследний
		|ИЗ
		|	ВТСотрудникиИЗаработанныеПраваНаОтпуска_ КАК ЗаработанныеПраваНаОтпуска
		|ГДЕ
		|	ЗаработанныеПраваНаОтпуска.УчитыватьОтпускВРазрезеКалендарногоГода = ИСТИНА
		|	И ГОД(ЗаработанныеПраваНаОтпуска.ДатаНачалаОбщая) = ГОД(ЗаработанныеПраваНаОтпуска.ДатаНачала)
		|
		|СГРУППИРОВАТЬ ПО
		|	ЗаработанныеПраваНаОтпуска.Сотрудник,
		|	ЗаработанныеПраваНаОтпуска.ВидЕжегодногоОтпуска
		|;
		|ВЫБРАТЬ 
		|	ЗаработанныеПраваНаОтпуска.Сотрудник КАК Сотрудник,
		|	ЗаработанныеПраваНаОтпуска.ВидЕжегодногоОтпуска КАК ВидЕжегодногоОтпуска, 
		|	ЗаработанныеПраваНаОтпуска.ДатаНачалаОбщая КАК ДатаНачалаОбщая, 
		|	ЗаработанныеПраваНаОтпуска.ДатаОкончанияОбщая КАК ДатаОкончанияОбщая,
		|	НАЧАЛОПЕРИОДА(КалендарныйГодПоследний.ДатаОкончанияОбщая, ГОД) КАК ДатаНачала,
		|	КОНЕЦПЕРИОДА(КалендарныйГодПоследний.ДатаОкончанияОбщая, ГОД) КАК ДатаОкончания
		|ПОМЕСТИТЬ ВТРабочийГодПоследний  
		|ИЗ
		|	ВТСотрудникиИЗаработанныеПраваНаОтпуска_ КАК ЗаработанныеПраваНаОтпуска    
		|ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТКалендарныйГодПоследний КАК КалендарныйГодПоследний
		|	ПО ЗаработанныеПраваНаОтпуска.Сотрудник = КалендарныйГодПоследний.Сотрудник  
		|	И ЗаработанныеПраваНаОтпуска.ВидЕжегодногоОтпуска = КалендарныйГодПоследний.ВидЕжегодногоОтпуска  
		|	И ГОД(ЗаработанныеПраваНаОтпуска.ДатаОкончанияОбщая) = ГОД(КалендарныйГодПоследний.ДатаОкончанияОбщая)  
        |;  
		|ВЫБРАТЬ
		|	ЗаработанныеПраваНаОтпуска.Сотрудник КАК Сотрудник,
		|	ЗаработанныеПраваНаОтпуска.ВидЕжегодногоОтпуска КАК ВидЕжегодногоОтпуска,
		|	ЗаработанныеПраваНаОтпуска.ДатаНачалаОбщая КАК ДатаНачалаОбщая,
		|	ЗаработанныеПраваНаОтпуска.ДатаОкончанияОбщая КАК ДатаОкончанияОбщая,
		|	ЗаработанныеПраваНаОтпуска.ДатаНачала КАК ДатаНачала,
		|	ЗаработанныеПраваНаОтпуска.ДатаОкончания КАК ДатаОкончания, 
		|	ЗаработанныеПраваНаОтпуска.УчитыватьОтпускВРазрезеКалендарногоГода КАК УчитыватьОтпускВРазрезеКалендарногоГода
		|ПОМЕСТИТЬ ВТСотрудникиИЗаработанныеПраваНаОтпуска
		|ИЗ ВТСотрудникиИЗаработанныеПраваНаОтпуска_ КАК ЗаработанныеПраваНаОтпуска
		| 
		|ОБЪЕДИНИТЬ
		|            
		|ВЫБРАТЬ
		|	РабочийГодПоследний.Сотрудник,
		|	РабочийГодПоследний.ВидЕжегодногоОтпуска,
		|	РабочийГодПоследний.ДатаНачалаОбщая,
		|	РабочийГодПоследний.ДатаОкончанияОбщая,
		|	РабочийГодПоследний.ДатаНачала,
		|	РабочийГодПоследний.ДатаОкончания, 
		|	ИСТИНА 
		|ИЗ ВТРабочийГодПоследний КАК РабочийГодПоследний
		|";
		 
		Запрос.Выполнить();
		
		ДатаНачала = Дата(1,1,1);
		ДатаОкончания = Дата(1,1,1);
		
		Запрос.Текст = "
		|ВЫБРАТЬ
		|	ЕСТЬNULL(МИНИМУМ(СотрудникиИЗаработанныеПраваНаОтпуска.ДатаНачала), ДАТАВРЕМЯ(1, 1, 1)) КАК МинимальнаяДатаНачала,
		|	ЕСТЬNULL(МАКСИМУМ(СотрудникиИЗаработанныеПраваНаОтпуска.ДатаОкончания), ДАТАВРЕМЯ(1, 1, 1)) КАК МаксимальнаяДатаОкончания 
		|ИЗ ВТСотрудникиИЗаработанныеПраваНаОтпуска КАК СотрудникиИЗаработанныеПраваНаОтпуска
		//|ГДЕ НЕ СотрудникиИЗаработанныеПраваНаОтпуска.ВидЕжегодногоОтпуска.УчитыватьОтпускВРазрезеКалендарногоГода
		|";        
		Выборка = Запрос.Выполнить().Выбрать();
		Если Выборка.Следующий() Тогда   
			ДатаНачала = Выборка.МинимальнаяДатаНачала;
			ДатаОкончания = Выборка.МаксимальнаяДатаОкончания
		КонецЕсли;
		
		Запрос.Текст = "
		|ВЫБРАТЬ 
		|	СотрудникиИЗаработанныеПраваНаОтпуска.Сотрудник КАК Сотрудник,
		|	СотрудникиИЗаработанныеПраваНаОтпуска.ДатаНачала КАК ДатаНачала,
		|	СотрудникиИЗаработанныеПраваНаОтпуска.ДатаОкончания КАК ДатаОкончания
		|ПОМЕСТИТЬ ВТСотрудники
		|ИЗ ВТСотрудникиИЗаработанныеПраваНаОтпуска КАК СотрудникиИЗаработанныеПраваНаОтпуска
		|";
		Запрос.Выполнить();
		
		ПараметрыПостроения = ЗарплатаКадрыОбщиеНаборыДанных.ПараметрыПостроенияДляСоздатьВТИмяРегистра();
		ПараметрыПостроения.ВключатьЗаписиНаНачалоПериода = Истина;
		ОписаниеФильтра = ЗарплатаКадрыОбщиеНаборыДанных.ОписаниеФильтраДляСоздатьВТИмяРегистра("ВТСотрудники","Сотрудник");
		
		ЗарплатаКадрыОбщиеНаборыДанных.СоздатьВТИмяРегистра(
			"ПоложенныеВидыЕжегодныхОтпусков",
			МенеджерВременныхТаблиц,
			Ложь,
			ОписаниеФильтра,
			ПараметрыПостроения,
			"ВТПоложенныеВидыЕжегодныхОтпусков");   
		
		
		ПараметрыЗаполнения = УчетРабочегоВремени.ПараметрыДляЗапросВТДанныеУчетаВремениИСостоянийСотрудников();
		
		ПараметрыЗаполнения.ИмяВТСотрудники = "ВТСотрудники";
		ПараметрыЗаполнения.ИмяВТРезультат = "ВТДанныеУчетаВремениИСостоянийСотрудников";
		ПараметрыЗаполнения.РассчитыватьПлановоеВремя = Ложь;   
		ПараметрыЗаполнения.ДатаАктуальности  = ДатаОтчета.Значение.Дата;           
		Если ДатаНачала = Дата(1, 1, 1) Тогда
			ПараметрыЗаполнения.ДатаНачала = ДатаОтчета.Значение.Дата
		Иначе	
			ПараметрыЗаполнения.ДатаНачала = ДатаНачала
		КонецЕсли;	   
		ПараметрыЗаполнения.ДатаОкончания = ДатаОтчета.Значение.Дата; 
		ПараметрыЗаполнения.МесяцДатаНачала = НачалоМесяца(ДатаНачала);
		ПараметрыЗаполнения.МесяцДатаОкончания = КонецМесяца(ДатаОтчета.Значение.Дата);
		ПараметрыЗаполнения.ПолучатьУжеРассчитанныеДанные = Ложь;
		
		ДанныеПоНевыходам = ОстаткиОтпусков.НевыходыИсключаемыеИзСтажаДляОтпуска();
		 
		СостоянияСотрудников.СоздатьВТСостоянияСотрудников(Запрос.МенеджерВременныхТаблиц, МассивСотрудников, ДанныеПоНевыходам.СписокСостояний, ПараметрыЗаполнения.ДатаНачала, ПараметрыЗаполнения.ДатаОкончания);
		
		УчетРабочегоВремени.СоздатьВТТаблицаПраздничныхДнейПодробно(Запрос.МенеджерВременныхТаблиц, ДатаНачала, ДатаОкончания);    
		
		Запрос.УстановитьПараметр("ДатаОтчета", ДатаОтчета.Значение.Дата); 
		Запрос.УстановитьПараметр("ТаблицаНевыходовПоВидамОтпусков", ДанныеПоНевыходам.ТаблицаНевыходовПоВидамОтпусков);
		
		Запрос.Текст = "
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ      
		|	ПоложенныеВидыЕжегодныхОтпусков.Сотрудник,   
		|	ПоложенныеВидыЕжегодныхОтпусков.Период КАК ДатаДействия,   
		|	ПоложенныеВидыЕжегодныхОтпусков.ВидЕжегодногоОтпуска,
		|	ВЫБОР
		|		КОГДА ПоложенныеВидыЕжегодныхОтпусков.Используется
		|			ТОГДА ПоложенныеВидыЕжегодныхОтпусков.КоличествоДнейВГод
		|		ИНАЧЕ 0
		|	КОНЕЦ КАК ДнейЕжегодно,
		|	ПоложенныеВидыЕжегодныхОтпусков.Используется
		|ПОМЕСТИТЬ ВТВсеТекущиеПраваНаОтпуска
		|ИЗ
		|	ВТПоложенныеВидыЕжегодныхОтпусков КАК ПоложенныеВидыЕжегодныхОтпусков
		|ГДЕ ПоложенныеВидыЕжегодныхОтпусков.Период <= &ДатаОтчета
		|;
		|ВЫБРАТЬ
		|	РабочиеГодаПоСотруднику.Сотрудник КАК Сотрудник,
		|	РабочиеГодаПоСотруднику.ВидЕжегодногоОтпуска КАК ВидЕжегодногоОтпуска,
		|	РабочиеГодаПоСотруднику.ДатаНачала КАК ДатаНачала,
		|	РабочиеГодаПоСотруднику.ДатаОкончания КАК ДатаОкончания,
		|	ТаблицаПравНаЕжегодныйОтпуск.ДатаДействия КАК ДатаДействия,
		|	ТаблицаПравНаЕжегодныйОтпуск.ДнейЕжегодно КАК ДнейЕжегодно
		|ПОМЕСТИТЬ ВТВсеИзмененияПрав
		|ИЗ
		|	ВТСотрудникиИЗаработанныеПраваНаОтпуска КАК РабочиеГодаПоСотруднику
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТВсеТекущиеПраваНаОтпуска КАК ТаблицаПравНаЕжегодныйОтпуск
		|		ПО (ТаблицаПравНаЕжегодныйОтпуск.Сотрудник = РабочиеГодаПоСотруднику.Сотрудник)
		|			И (ТаблицаПравНаЕжегодныйОтпуск.ВидЕжегодногоОтпуска = РабочиеГодаПоСотруднику.ВидЕжегодногоОтпуска)
		|			И (ВЫБОР КОГДА РабочиеГодаПоСотруднику.УчитыватьОтпускВРазрезеКалендарногоГода ТОГДА   
		|				ТаблицаПравНаЕжегодныйОтпуск.ДатаДействия <= РабочиеГодаПоСотруднику.ДатаОкончания 
		|				ИНАЧЕ ТаблицаПравНаЕжегодныйОтпуск.ДатаДействия <= РабочиеГодаПоСотруднику.ДатаОкончанияОбщая КОНЕЦ) 
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВсеИзмененияПрав.Сотрудник КАК Сотрудник,
		|	ВсеИзмененияПрав.ВидЕжегодногоОтпуска КАК ВидЕжегодногоОтпуска,
		|	ВсеИзмененияПрав.ДатаНачала КАК ДатаНачала,
		|	ВсеИзмененияПрав.ДатаОкончания КАК ДатаОкончания,
		|	МАКСИМУМ(ВсеИзмененияПрав.ДатаДействия) КАК ДатаДействия
		|ПОМЕСТИТЬ ВТМаксимальныеДатыИзмененияПрав
		|ИЗ
		|	ВТВсеИзмененияПрав КАК ВсеИзмененияПрав
		|
		|СГРУППИРОВАТЬ ПО
		|	ВсеИзмененияПрав.Сотрудник,
		|	ВсеИзмененияПрав.ВидЕжегодногоОтпуска,
		|	ВсеИзмененияПрав.ДатаНачала,
		|	ВсеИзмененияПрав.ДатаОкончания
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	МаксимальныеДатыИзмененияПрав.Сотрудник КАК Сотрудник,
		|	МаксимальныеДатыИзмененияПрав.ВидЕжегодногоОтпуска КАК ВидЕжегодногоОтпуска,
		|	МаксимальныеДатыИзмененияПрав.ДатаНачала КАК ДатаНачала,
		|	МаксимальныеДатыИзмененияПрав.ДатаОкончания КАК ДатаОкончания,
		|	ВсеИзмененияПрав.ДнейЕжегодно КАК ДнейЕжегодно
		|ПОМЕСТИТЬ ВТТекущиеПраваНаОтпускаОбщая
		|ИЗ
		|	ВТМаксимальныеДатыИзмененияПрав КАК МаксимальныеДатыИзмененияПрав
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТВсеИзмененияПрав КАК ВсеИзмененияПрав
		|		ПО МаксимальныеДатыИзмененияПрав.Сотрудник = ВсеИзмененияПрав.Сотрудник
		|			И МаксимальныеДатыИзмененияПрав.ВидЕжегодногоОтпуска = ВсеИзмененияПрав.ВидЕжегодногоОтпуска
		|			И МаксимальныеДатыИзмененияПрав.ДатаДействия = ВсеИзмененияПрав.ДатаДействия
		|
		|;     
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	РабочиеГодаПоСотруднику.Сотрудник КАК Сотрудник,
		|	РабочиеГодаПоСотруднику.ВидЕжегодногоОтпуска КАК ВидЕжегодногоОтпуска,
		|	ВЫБОР
		|		КОГДА РабочиеГодаПоСотруднику.УчитыватьОтпускВРазрезеКалендарногоГода
		|				И НЕ РабочиеГодаПоСотруднику.ДатаНачала = ДатыОтсчета.ДатаНачалаОтсчета
		|			ТОГДА НАЧАЛОПЕРИОДА(РабочиеГодаПоСотруднику.ДатаНачала, ГОД)
		|		ИНАЧЕ РабочиеГодаПоСотруднику.ДатаНачала
		|	КОНЕЦ КАК ДатаНачала,
		|	ВЫБОР
		|		КОГДА РабочиеГодаПоСотруднику.УчитыватьОтпускВРазрезеКалендарногоГода
		|			ТОГДА КОНЕЦПЕРИОДА(РабочиеГодаПоСотруднику.ДатаНачала, ГОД)
		|		ИНАЧЕ РабочиеГодаПоСотруднику.ДатаОкончания
		|	КОНЕЦ КАК ДатаОкончания,
		|	ТекущиеПраваНаОтпуска.ДнейЕжегодно КАК ДнейЕжегодно
		|ПОМЕСТИТЬ ВТТекущиеПраваНаОтпуска
		|ИЗ   
		|   ВТСотрудникиИЗаработанныеПраваНаОтпуска КАК РабочиеГодаПоСотруднику 
		|ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТДатыОтсчета КАК ДатыОтсчета
		|		ПО РабочиеГодаПоСотруднику.ВидЕжегодногоОтпуска = ДатыОтсчета.ВидЕжегодногоОтпуска
		|			И РабочиеГодаПоСотруднику.Сотрудник = ДатыОтсчета.Сотрудник
		|ВНУТРЕННЕЕ СОЕДИНЕНИЕ 
		|	ВТТекущиеПраваНаОтпускаОбщая КАК ТекущиеПраваНаОтпуска
		|		ПО РабочиеГодаПоСотруднику.Сотрудник = ТекущиеПраваНаОтпуска.Сотрудник
		|		И РабочиеГодаПоСотруднику.ВидЕжегодногоОтпуска = ТекущиеПраваНаОтпуска.ВидЕжегодногоОтпуска
		|		И РабочиеГодаПоСотруднику.ДатаНачала = ТекущиеПраваНаОтпуска.ДатаНачала
		|		И РабочиеГодаПоСотруднику.ДатаОкончания = ТекущиеПраваНаОтпуска.ДатаОкончания
		|;
		|ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	НачальныеОстаткиОтпусков.Сотрудник,
		|	НачальныеОстаткиОтпусков.ВидЕжегодногоОтпуска, 
		|	НачальныеОстаткиОтпусков.ВидЕжегодногоОтпуска.УчитыватьОтпускВРазрезеКалендарногоГода КАК УчитыватьОтпускВРазрезеКалендарногоГода,
		|	НачальныеОстаткиОтпусков.ДатаОстатка КАК ДатаОстатка,
		|	НачальныеОстаткиОтпусков.РабочийГодНачало КАК РабочийГодНачало,   
		|	НачальныеОстаткиОтпусков.РабочийГодОкончание КАК РабочийГодОкончание,  
		|	ВЫБОР КОГДА НачальныеОстаткиОтпусков.ДатаОстатка МЕЖДУ НачальныеОстаткиОтпусков.РабочийГодНачало И НачальныеОстаткиОтпусков.РабочийГодОкончание
		|		ТОГДА ИСТИНА ИНАЧЕ ЛОЖЬ КОНЕЦ КАК ПоследнийГодОстатков,  
		|	НачальныеОстаткиОтпусков.КоличествоДней КАК КоличествоДней
		|ПОМЕСТИТЬ ВТВсеНачальныеОстатки_
		|ИЗ
		|	РегистрСведений.НачальныеОстаткиОтпусков КАК НачальныеОстаткиОтпусков   
		|ГДЕ НачальныеОстаткиОтпусков.ДатаОстатка <= &ДатаОтчета   
		|
		|; 
		|ВЫБРАТЬ
		|	НачальныеОстаткиОтпусков.Сотрудник,
		|	НачальныеОстаткиОтпусков.ВидЕжегодногоОтпуска,
		|	МАКСИМУМ(НачальныеОстаткиОтпусков.ДатаОстатка) КАК ДатаОстатка
		|ПОМЕСТИТЬ ВТНачальныеОстатки
		|ИЗ
		|	ВТВсеНачальныеОстатки_ КАК НачальныеОстаткиОтпусков 
		|ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТВыбранныеСотрудники КАК Сотрудники
		|ПО НачальныеОстаткиОтпусков.Сотрудник = Сотрудники.Сотрудник 
		|
		|СГРУППИРОВАТЬ ПО
		|	НачальныеОстаткиОтпусков.Сотрудник,
		|	НачальныеОстаткиОтпусков.ВидЕжегодногоОтпуска
		|;
		|ВЫБРАТЬ 
		|	НачальныеОстаткиОтпусков.Сотрудник,
		|	НачальныеОстаткиОтпусков.ВидЕжегодногоОтпуска,      
		|   НачальныеОстаткиОтпусков.УчитыватьОтпускВРазрезеКалендарногоГода КАК УчитыватьОтпускВРазрезеКалендарногоГода,
		|	НачальныеОстаткиОтпусков.ДатаОстатка КАК ДатаОстатка,                
		|   ВЫБОР КОГДА НачальныеОстаткиОтпусков.УчитыватьОтпускВРазрезеКалендарногоГода ТОГДА
		|   	НАЧАЛОПЕРИОДА(НачальныеОстаткиОтпусков.РабочийГодНачало, ГОД)
		|   ИНАЧЕ
		|		НачальныеОстаткиОтпусков.РабочийГодНачало 
		|	КОНЕЦ КАК РабочийГодНачало, 
		|	НачальныеОстаткиОтпусков.ПоследнийГодОстатков КАК ПоследнийГодОстатков,
       	|	НачальныеОстаткиОтпусков.КоличествоДней КАК КоличествоДней   
		|ПОМЕСТИТЬ ВТВсеНачальныеОстаткиДоИзменений
		|ИЗ
		|	ВТВсеНачальныеОстатки_ КАК НачальныеОстаткиОтпусков  
		|ВНУТРЕННЕЕ СОЕДИНЕНИЕ
		|   ВТНачальныеОстатки КАК ПоследниеНачальныеОстатки
		|ПО НачальныеОстаткиОтпусков.Сотрудник = ПоследниеНачальныеОстатки.Сотрудник
		|	И НачальныеОстаткиОтпусков.ВидЕжегодногоОтпуска = ПоследниеНачальныеОстатки.ВидЕжегодногоОтпуска 
		|	И НачальныеОстаткиОтпусков.ДатаОстатка = ПоследниеНачальныеОстатки.ДатаОстатка 
		|;   
		|ВЫБРАТЬ 
		|	ВсеНачальныеОстатки.Сотрудник КАК Сотрудник,
		|	ВсеНачальныеОстатки.ВидЕжегодногоОтпуска КАК ВидЕжегодногоОтпуска,
		|   ВсеНачальныеОстатки.УчитыватьОтпускВРазрезеКалендарногоГода КАК УчитыватьОтпускВРазрезеКалендарногоГода,
		|	ВсеНачальныеОстатки.ДатаОстатка КАК ДатаОстатка, 
		|	ВсеНачальныеОстатки.ПоследнийГодОстатков КАК ПоследнийГодОстатков,
		|	ВсеНачальныеОстатки.РабочийГодНачало КАК РабочийГодНачало,
       	|	ВсеНачальныеОстатки.КоличествоДней КАК КоличествоДней   
		|ИЗ ВТВсеНачальныеОстаткиДоИзменений КАК ВсеНачальныеОстатки
		|УПОРЯДОЧИТЬ ПО
		|   Сотрудник, ВидЕжегодногоОтпуска, РабочийГодНачало ВОЗР
		|";           
		ТаблицаНачальныхОстатков = Запрос.Выполнить().Выгрузить();      
		
		ВТПредыдущиеОстаткиОбщая = Новый ТаблицаЗначений();
		ВТПредыдущиеОстаткиОбщая.Колонки.Добавить("Сотрудник", Новый ОписаниеТипов("СправочникСсылка.Сотрудники"));
		ВТПредыдущиеОстаткиОбщая.Колонки.Добавить("ВидЕжегодногоОтпуска", Новый ОписаниеТипов("СправочникСсылка.ВидыОтпусков"));     
		ВТПредыдущиеОстаткиОбщая.Колонки.Добавить("УчитыватьОтпускВРазрезеКалендарногоГода", Новый ОписаниеТипов("Булево"));
		ВТПредыдущиеОстаткиОбщая.Колонки.Добавить("ДатаОстатка", Новый ОписаниеТипов("Дата"));  
		ВТПредыдущиеОстаткиОбщая.Колонки.Добавить("РабочийГодНачало", Новый ОписаниеТипов("Дата")); 
		ВТПредыдущиеОстаткиОбщая.Колонки.Добавить("ПоследнийГодОстатков", Новый ОписаниеТипов("Булево"));
		ВТПредыдущиеОстаткиОбщая.Колонки.Добавить("КоличествоДней", Новый ОписаниеТипов("Число")); 
		
		Запрос.Текст = "ВЫБРАТЬ РАЗЛИЧНЫЕ
		|	ВсеНачальныеОстатки.Сотрудник КАК Сотрудник,
		|	ВсеНачальныеОстатки.ВидЕжегодногоОтпуска КАК ВидЕжегодногоОтпуска
		|ПОМЕСТИТЬ ВТОтрицательныеНачальныеОстатки
		|ИЗ
		|	ВТВсеНачальныеОстаткиДоИзменений КАК ВсеНачальныеОстатки
		|ГДЕ
		|	ВсеНачальныеОстатки.КоличествоДней < 0
		|
		|СГРУППИРОВАТЬ ПО
		|	ВсеНачальныеОстатки.Сотрудник,
		|	ВсеНачальныеОстатки.ВидЕжегодногоОтпуска,
		|	ВсеНачальныеОстатки.КоличествоДней
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВсеНачальныеОстатки.Сотрудник КАК Сотрудник,
		|	ВсеНачальныеОстатки.ВидЕжегодногоОтпуска КАК ВидЕжегодногоОтпуска
		|ПОМЕСТИТЬ ВТПоложительныеОтрицательныеОстатки
		|ИЗ
		|	ВТВсеНачальныеОстаткиДоИзменений КАК ВсеНачальныеОстатки
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТОтрицательныеНачальныеОстатки КАК ОтрицательныеНачальныеОстатки
		|		ПО ВсеНачальныеОстатки.Сотрудник = ОтрицательныеНачальныеОстатки.Сотрудник
		|			И ВсеНачальныеОстатки.ВидЕжегодногоОтпуска = ОтрицательныеНачальныеОстатки.ВидЕжегодногоОтпуска
		|ГДЕ
		|	ВсеНачальныеОстатки.КоличествоДней > 0
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВсеНачальныеОстатки.Сотрудник КАК Сотрудник,
		|	ВсеНачальныеОстатки.ВидЕжегодногоОтпуска КАК ВидЕжегодногоОтпуска,
		|	ВсеНачальныеОстатки.УчитыватьОтпускВРазрезеКалендарногоГода КАК УчитыватьОтпускВРазрезеКалендарногоГода,
		|	ВсеНачальныеОстатки.ДатаОстатка КАК ДатаОстатка,
		|	ВсеНачальныеОстатки.РабочийГодНачало КАК РабочийГодНачало,
		|	ВсеНачальныеОстатки.ПоследнийГодОстатков КАК ПоследнийГодОстатков,  
		|	ВсеНачальныеОстатки.КоличествоДней КАК КоличествоДней
		|ИЗ
		|	ВТВсеНачальныеОстаткиДоИзменений КАК ВсеНачальныеОстатки
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТПоложительныеОтрицательныеОстатки КАК ПоложительныеОтрицательныеОстатки
		|		ПО ВсеНачальныеОстатки.Сотрудник = ПоложительныеОтрицательныеОстатки.Сотрудник
		|			И ВсеНачальныеОстатки.ВидЕжегодногоОтпуска = ПоложительныеОтрицательныеОстатки.ВидЕжегодногоОтпуска
		|
		|СГРУППИРОВАТЬ ПО
		|	ВсеНачальныеОстатки.Сотрудник,
		|	ВсеНачальныеОстатки.ВидЕжегодногоОтпуска,
		|	ВсеНачальныеОстатки.УчитыватьОтпускВРазрезеКалендарногоГода,
		|	ВсеНачальныеОстатки.ДатаОстатка,
		|	ВсеНачальныеОстатки.РабочийГодНачало,
		|	ВсеНачальныеОстатки.ПоследнийГодОстатков,
		|	ВсеНачальныеОстатки.КоличествоДней
		|
		|УПОРЯДОЧИТЬ ПО
		|	РабочийГодНачало
		|ИТОГИ ПО
		|	ОБЩИЕ,
		|	Сотрудник,
		|	ВидЕжегодногоОтпуска";
		Выборка = Запрос.Выполнить().Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам,);
		Пока Выборка.Следующий() Цикл    
			ВыборкаПоОтпускам = Выборка.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
			Пока ВыборкаПоОтпускам.Следующий() Цикл 
				ВыборкаПоСотрудникам = ВыборкаПоОтпускам.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);       
				Пока ВыборкаПоСотрудникам.Следующий() Цикл 
					ВыборкаПоПериодам = ВыборкаПоСотрудникам.Выбрать();
					ВТПредыдущиеОстатки = Новый ТаблицаЗначений();
					ВТПредыдущиеОстатки.Колонки.Добавить("Сотрудник", Новый ОписаниеТипов("СправочникСсылка.Сотрудники"));
					ВТПредыдущиеОстатки.Колонки.Добавить("ВидЕжегодногоОтпуска", Новый ОписаниеТипов("СправочникСсылка.ВидыОтпусков"));     
					ВТПредыдущиеОстатки.Колонки.Добавить("УчитыватьОтпускВРазрезеКалендарногоГода", Новый ОписаниеТипов("Булево"));
					ВТПредыдущиеОстатки.Колонки.Добавить("ДатаОстатка", Новый ОписаниеТипов("Дата"));  
					ВТПредыдущиеОстатки.Колонки.Добавить("РабочийГодНачало", Новый ОписаниеТипов("Дата"));
					ВТПредыдущиеОстатки.Колонки.Добавить("ПоследнийГодОстатков", Новый ОписаниеТипов("Булево"));
					ВТПредыдущиеОстатки.Колонки.Добавить("КоличествоДней", Новый ОписаниеТипов("Число")); 
					Пока ВыборкаПоПериодам.Следующий() Цикл  
						Если ВыборкаПоПериодам.КоличествоДней < 0 Тогда   
							КоличествоДнейТекущегоПериода = ВыборкаПоПериодам.КоличествоДней; 
							Если ВТПредыдущиеОстатки.Итог("КоличествоДней") + КоличествоДнейТекущегоПериода  > 0 Тогда
								Для Каждого СтрокаВТПредыдущиеОстатки ИЗ ВТПредыдущиеОстатки Цикл 
									Если (СтрокаВТПредыдущиеОстатки.КоличествоДней + КоличествоДнейТекущегоПериода) < 0 Тогда
										КоличествоДнейТекущегоПериода = КоличествоДнейТекущегоПериода + СтрокаВТПредыдущиеОстатки.КоличествоДней;
										СтрокаВТПредыдущиеОстатки.КоличествоДней = 0    
									Иначе	
										СтрокаВТПредыдущиеОстатки.КоличествоДней = СтрокаВТПредыдущиеОстатки.КоличествоДней + КоличествоДнейТекущегоПериода;
										КоличествоДнейТекущегоПериода = 0
									КонецЕсли	
								КонецЦикла;   
								НоваяСтрокаВТПредыдущиеОстатки = ВТПредыдущиеОстатки.Добавить();
								ЗаполнитьЗначенияСвойств(НоваяСтрокаВТПредыдущиеОстатки, ВыборкаПоПериодам); 
								НоваяСтрокаВТПредыдущиеОстатки.КоличествоДней = КоличествоДнейТекущегоПериода  
							ИначеЕсли ВТПредыдущиеОстатки.Итог("КоличествоДней") + КоличествоДнейТекущегоПериода  = 0 Тогда
								Для Каждого СтрокаВТПредыдущиеОстатки ИЗ ВТПредыдущиеОстатки Цикл 
									Если (СтрокаВТПредыдущиеОстатки.КоличествоДней + КоличествоДнейТекущегоПериода) < 0 Тогда
										КоличествоДнейТекущегоПериода = КоличествоДнейТекущегоПериода + СтрокаВТПредыдущиеОстатки.КоличествоДней;
										СтрокаВТПредыдущиеОстатки.КоличествоДней = 0    
									Иначе	
										СтрокаВТПредыдущиеОстатки.КоличествоДней = СтрокаВТПредыдущиеОстатки.КоличествоДней + КоличествоДнейТекущегоПериода;
										КоличествоДнейТекущегоПериода = 0
									КонецЕсли	
								КонецЦикла;   
								НоваяСтрокаВТПредыдущиеОстатки = ВТПредыдущиеОстатки.Добавить();
								ЗаполнитьЗначенияСвойств(НоваяСтрокаВТПредыдущиеОстатки, ВыборкаПоПериодам); 
								НоваяСтрокаВТПредыдущиеОстатки.КоличествоДней = КоличествоДнейТекущегоПериода  
							Иначе            
								ИтогПредыдущих = ВТПредыдущиеОстатки.Итог("КоличествоДней");
								Если ИтогПредыдущих <= 0 Тогда       
									НоваяСтрокаВТПредыдущиеОстатки = ВТПредыдущиеОстатки.Добавить();
									ЗаполнитьЗначенияСвойств(НоваяСтрокаВТПредыдущиеОстатки, ВыборкаПоПериодам);
								Иначе        
									КоличествоДнейТекущегоПериода = ВыборкаПоПериодам.КоличествоДней; 
									Для Каждого СтрокаВТПредыдущиеОстатки ИЗ ВТПредыдущиеОстатки Цикл 
										Если (СтрокаВТПредыдущиеОстатки.КоличествоДней + КоличествоДнейТекущегоПериода) <= 0 Тогда  
											КоличествоДнейТекущегоПериода = КоличествоДнейТекущегоПериода + СтрокаВТПредыдущиеОстатки.КоличествоДней; 
											СтрокаВТПредыдущиеОстатки.КоличествоДней = 0           
										КонецЕсли	
									КонецЦикла;
									НоваяСтрокаВТПредыдущиеОстатки = ВТПредыдущиеОстатки.Добавить();
									ЗаполнитьЗначенияСвойств(НоваяСтрокаВТПредыдущиеОстатки, ВыборкаПоПериодам); 
									НоваяСтрокаВТПредыдущиеОстатки.КоличествоДней = КоличествоДнейТекущегоПериода  
								КонецЕсли;	
							КонецЕсли 
						ИначеЕсли ВыборкаПоПериодам.КоличествоДней > 0 Тогда 
							КоличествоДнейТекущегоПериода = ВыборкаПоПериодам.КоличествоДней; 
							ИтогПредыдущих = ВТПредыдущиеОстатки.Итог("КоличествоДней");
							Если ИтогПредыдущих < 0 Тогда
								Для Каждого СтрокаВТПредыдущиеОстатки ИЗ ВТПредыдущиеОстатки Цикл 
									Если СтрокаВТПредыдущиеОстатки.КоличествоДней < 0 Тогда
										Если (КоличествоДнейТекущегоПериода + СтрокаВТПредыдущиеОстатки.КоличествоДней) < 0 Тогда
											СтрокаВТПредыдущиеОстатки.КоличествоДней = КоличествоДнейТекущегоПериода + СтрокаВТПредыдущиеОстатки.КоличествоДней;
											КоличествоДнейТекущегоПериода = 0
										Иначе
											КоличествоДнейТекущегоПериода = КоличествоДнейТекущегоПериода + СтрокаВТПредыдущиеОстатки.КоличествоДней;
											СтрокаВТПредыдущиеОстатки.КоличествоДней = 0;
										КонецЕсли	
									ИначеЕсли СтрокаВТПредыдущиеОстатки.КоличествоДней > 0 Тогда
										СтрокаВТПредыдущиеОстатки.КоличествоДней = СтрокаВТПредыдущиеОстатки.КоличествоДней + ВыборкаПоПериодам.КоличествоДней;
									КонецЕсли	
								КонецЦикла;
								НоваяСтрокаВТПредыдущиеОстатки = ВТПредыдущиеОстатки.Добавить();
								ЗаполнитьЗначенияСвойств(НоваяСтрокаВТПредыдущиеОстатки, ВыборкаПоПериодам);
								Если КоличествоДнейТекущегоПериода <> ВыборкаПоПериодам.КоличествоДней Тогда
									НоваяСтрокаВТПредыдущиеОстатки.КоличествоДней = КоличествоДнейТекущегоПериода 
								Иначе     
									НоваяСтрокаВТПредыдущиеОстатки.КоличествоДней = Выборка.КоличествоДней 
								КонецЕсли;	
							Иначе
								НоваяСтрокаВТПредыдущиеОстатки = ВТПредыдущиеОстатки.Добавить();
								ЗаполнитьЗначенияСвойств(НоваяСтрокаВТПредыдущиеОстатки, ВыборкаПоПериодам);
							КонецЕсли;
						Иначе
							НоваяСтрокаВТПредыдущиеОстатки = ВТПредыдущиеОстатки.Добавить();
							ЗаполнитьЗначенияСвойств(НоваяСтрокаВТПредыдущиеОстатки, ВыборкаПоПериодам);
						КонецЕсли	
					КонецЦикла;
					ДобавитьСтрокиВТаблицу(ВТПредыдущиеОстаткиОбщая, ВТПредыдущиеОстатки);
				КонецЦикла	
			КонецЦикла	
		КонецЦикла;	  
		
		Запрос.УстановитьПараметр("ПредыдущиеОстаткиОбщая", ВТПредыдущиеОстаткиОбщая);
		Запрос.Текст = "ВЫБРАТЬ
		|	ПредыдущиеОстаткиОбщая.Сотрудник КАК Сотрудник,
		|	ПредыдущиеОстаткиОбщая.ВидЕжегодногоОтпуска КАК ВидЕжегодногоОтпуска,
		|	ПредыдущиеОстаткиОбщая.УчитыватьОтпускВРазрезеКалендарногоГода КАК УчитыватьОтпускВРазрезеКалендарногоГода,
		|	ПредыдущиеОстаткиОбщая.ДатаОстатка КАК ДатаОстатка,
		|	ПредыдущиеОстаткиОбщая.РабочийГодНачало КАК РабочийГодНачало,
		|	ПредыдущиеОстаткиОбщая.ПоследнийГодОстатков КАК ПоследнийГодОстатков,
		|	ПредыдущиеОстаткиОбщая.КоличествоДней КАК КоличествоДней
		|ПОМЕСТИТЬ ВТПриведенныхНачальныхОстатков
		|ИЗ
		|	&ПредыдущиеОстаткиОбщая КАК ПредыдущиеОстаткиОбщая
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВсеНачальныеОстатки.Сотрудник КАК Сотрудник,
		|	ВсеНачальныеОстатки.ВидЕжегодногоОтпуска КАК ВидЕжегодногоОтпуска,
		|	ВсеНачальныеОстатки.УчитыватьОтпускВРазрезеКалендарногоГода КАК УчитыватьОтпускВРазрезеКалендарногоГода,
		|	ВсеНачальныеОстатки.ДатаОстатка КАК ДатаОстатка,
		|	ВсеНачальныеОстатки.РабочийГодНачало КАК РабочийГодНачало,
		|	ВсеНачальныеОстатки.ПоследнийГодОстатков КАК ПоследнийГодОстатков,
		|	ВсеНачальныеОстатки.КоличествоДней КАК КоличествоДней
		|ПОМЕСТИТЬ ВТВсеНачальныеОстатки
		|ИЗ
		|	ВТВсеНачальныеОстаткиДоИзменений КАК ВсеНачальныеОстатки
		|		ЛЕВОЕ СОЕДИНЕНИЕ ВТПриведенныхНачальныхОстатков КАК ПриведенныхНачальныхОстатков
		|		ПО ВсеНачальныеОстатки.Сотрудник = ПриведенныхНачальныхОстатков.Сотрудник
		|			И ВсеНачальныеОстатки.ВидЕжегодногоОтпуска = ПриведенныхНачальныхОстатков.ВидЕжегодногоОтпуска
		|ГДЕ
		|	ЕСТЬNULL(ПриведенныхНачальныхОстатков.Сотрудник, ЗНАЧЕНИЕ(Справочник.Сотрудники.ПустаяСсылка)) = ЗНАЧЕНИЕ(Справочник.Сотрудники.ПустаяСсылка)
		|	И ЕСТЬNULL(ПриведенныхНачальныхОстатков.ВидЕжегодногоОтпуска, ЗНАЧЕНИЕ(Справочник.ВидыОтпусков.ПустаяСсылка)) = ЗНАЧЕНИЕ(Справочник.ВидыОтпусков.ПустаяСсылка)
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВТПриведенныхНачальныхОстатков.Сотрудник,
		|	ВТПриведенныхНачальныхОстатков.ВидЕжегодногоОтпуска,
		|	ВТПриведенныхНачальныхОстатков.УчитыватьОтпускВРазрезеКалендарногоГода,
		|	ВТПриведенныхНачальныхОстатков.ДатаОстатка,
		|	ВТПриведенныхНачальныхОстатков.РабочийГодНачало,
		|	ВТПриведенныхНачальныхОстатков.ПоследнийГодОстатков,
		|	ВТПриведенныхНачальныхОстатков.КоличествоДней
		|ИЗ
		|	ВТПриведенныхНачальныхОстатков КАК ВТПриведенныхНачальныхОстатков";
		Запрос.Выполнить();
		
		Запрос.Текст = "ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
		|	ЗаработанныеПраваНаОтпуска.Сотрудник,
		|	ЗаработанныеПраваНаОтпуска.ВидЕжегодногоОтпуска,
		|	ЗаработанныеПраваНаОтпуска.ДатаНачала,
		|	ЗаработанныеПраваНаОтпуска.ДатаОкончания,
		|	ЗаработанныеПраваНаОтпуска.ДатаНачалаОбщая,
		|	ЗаработанныеПраваНаОтпуска.ДатаОкончанияОбщая,
		|	ЗаработанныеПраваНаОтпуска.УчитыватьОтпускВРазрезеКалендарногоГода,
		|   ВЫБОР КОГДА ЕСТЬNULL(ВсеНачальныеОстатки.РабочийГодНачало, ДАТАВРЕМЯ(1, 1, 1)) = ДАТАВРЕМЯ(1, 1, 1) 
		|   	ТОГДА 0
		|   ИНАЧЕ ВсеНачальныеОстатки.КоличествоДней КОНЕЦ КАК КоличествоДнейНачальногоОстатка,
		|   ВЫБОР КОГДА ЕСТЬNULL(НачальныеОстатки.ДатаОстатка, ДАТАВРЕМЯ(1, 1, 1)) МЕЖДУ ЗаработанныеПраваНаОтпуска.ДатаНачала И ЗаработанныеПраваНаОтпуска.ДатаОкончания  
		|   	ТОГДА ИСТИНА ИНАЧЕ ЛОЖЬ 
		|   КОНЕЦ КАК ПоследнийГодОстатков,
		|   ЕСТЬNULL(НачальныеОстатки.ДатаОстатка, ДАТАВРЕМЯ(1, 1, 1)) КАК ДатаОстатка,
		|   ВЫБОР КОГДА ЕСТЬNULL(ВсеНачальныеОстатки.РабочийГодНачало, ДАТАВРЕМЯ(1, 1, 1)) = ДАТАВРЕМЯ(1, 1, 1)
		|		ТОГДА ЛОЖЬ 
		|	ИНАЧЕ ИСТИНА КОНЕЦ КАК ГодОстатков
		|ПОМЕСТИТЬ ВТЗаработанныеПрава
		|ИЗ
		|	ВТСотрудникиИЗаработанныеПраваНаОтпуска КАК ЗаработанныеПраваНаОтпуска 
		|ЛЕВОЕ СОЕДИНЕНИЕ ВТВсеНачальныеОстатки КАК ВсеНачальныеОстатки
		|	ПО ЗаработанныеПраваНаОтпуска.Сотрудник = ВсеНачальныеОстатки.Сотрудник  
		|		И ЗаработанныеПраваНаОтпуска.ВидЕжегодногоОтпуска = ВсеНачальныеОстатки.ВидЕжегодногоОтпуска
		|		И ВЫБОР КОГДА ЗаработанныеПраваНаОтпуска.УчитыватьОтпускВРазрезеКалендарногоГода ТОГДА 
		|			НАЧАЛОПЕРИОДА(ЗаработанныеПраваНаОтпуска.ДатаНачала, ГОД) = НАЧАЛОПЕРИОДА(ВсеНачальныеОстатки.РабочийГодНачало, ГОД) 
		|			ИНАЧЕ ЗаработанныеПраваНаОтпуска.ДатаНачала = ВсеНачальныеОстатки.РабочийГодНачало 
		|		КОНЕЦ  
		|ЛЕВОЕ СОЕДИНЕНИЕ ВТНачальныеОстатки КАК НачальныеОстатки  
		|	ПО ЗаработанныеПраваНаОтпуска.Сотрудник = НачальныеОстатки.Сотрудник  
		|		И ЗаработанныеПраваНаОтпуска.ВидЕжегодногоОтпуска = НачальныеОстатки.ВидЕжегодногоОтпуска
		|
		|; 
		|ВЫБРАТЬ   
		|	ТаблицаНевыходовПоВидамОтпусков.Состояние КАК Состояние,
		|	ТаблицаНевыходовПоВидамОтпусков.ВидЕжегодногоОтпуска КАК ВидЕжегодногоОтпуска,
		|	ТаблицаНевыходовПоВидамОтпусков.ДатаНачалаИсключенияИзСтажа КАК ДатаНачалаИсключенияИзСтажа
		|ПОМЕСТИТЬ ВТТаблицаНевыходовПоВидамОтпусков
		|ИЗ
		|	&ТаблицаНевыходовПоВидамОтпусков КАК ТаблицаНевыходовПоВидамОтпусков
		|;
		|   
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВТЗаработанныеПрава.Сотрудник,
		|	ВТЗаработанныеПрава.ВидЕжегодногоОтпуска,
		|	МАКСИМУМ(ВТЗаработанныеПрава.ДатаНачала) КАК Период
		|ПОМЕСТИТЬ ВТУказателиПоследних
		|ИЗ
		|	ВТЗаработанныеПрава КАК ВТЗаработанныеПрава
		|
		|СГРУППИРОВАТЬ ПО
		|	ВТЗаработанныеПрава.Сотрудник,
		|	ВТЗаработанныеПрава.ВидЕжегодногоОтпуска
		|;
		|
		|
		|////////////////////////////////////////////////////////////////////////////////     
		|";
		Запрос.Выполнить();
		
		Запрос.Текст = "ВЫБРАТЬ
		               |	СостоянияСотрудников.Сотрудник КАК Сотрудник,
		               |	СостоянияСотрудников.Состояние КАК Состояние,
		               |	ВЫБОР
		               |		КОГДА НЕ ЕСТЬNULL(ТаблицаНевыходовПоВидамОтпусков.ДатаНачалаИсключенияИзСтажа, ДАТАВРЕМЯ(1, 1, 1)) = ДАТАВРЕМЯ(1, 1, 1)
		               |				И (ЕСТЬNULL(ТаблицаНевыходовПоВидамОтпусков.ДатаНачалаИсключенияИзСтажа, ДАТАВРЕМЯ(1, 1, 1)) МЕЖДУ СостоянияСотрудников.Начало И СостоянияСотрудников.Окончание)
		               |			ТОГДА ЕСТЬNULL(ТаблицаНевыходовПоВидамОтпусков.ДатаНачалаИсключенияИзСтажа, ДАТАВРЕМЯ(1, 1, 1))
		               |		ИНАЧЕ СостоянияСотрудников.Начало
		               |	КОНЕЦ КАК Начало,
		               |	ВЫБОР
		               |		КОГДА ЕСТЬNULL(СостоянияСотрудников.Окончание, ДАТАВРЕМЯ(1, 1, 1)) = ДАТАВРЕМЯ(1, 1, 1)
		               |			ТОГДА &ДатаОтчета
		               |		ИНАЧЕ СостоянияСотрудников.Окончание
		               |	КОНЕЦ КАК Окончание,
		               |	СостоянияСотрудников.ОкончаниеПредположительно КАК ОкончаниеПредположительно,
		               |	ЕСТЬNULL(ТаблицаНевыходовПоВидамОтпусков.ДатаНачалаИсключенияИзСтажа, ДАТАВРЕМЯ(1, 1, 1)) КАК ДатаНачалаИсключенияИзСтажа
		               |ПОМЕСТИТЬ ВТВсеНевыходыСотрудников_
		               |ИЗ
		               |	ВТСостоянияСотрудников КАК СостоянияСотрудников
		               |		ЛЕВОЕ СОЕДИНЕНИЕ ВТТаблицаНевыходовПоВидамОтпусков КАК ТаблицаНевыходовПоВидамОтпусков
		               |		ПО СостоянияСотрудников.Состояние = ТаблицаНевыходовПоВидамОтпусков.Состояние
		               |;
					   |ВЫБРАТЬ  
					   |	СостоянияСотрудников.Сотрудник КАК Сотрудник,
					   |	СостоянияСотрудников.Состояние КАК Состояние,  
					   |	СостоянияСотрудников.Начало КАК Начало,
					   |	СостоянияСотрудников.Окончание КАК Окончание,
					   |	СостоянияСотрудников.ОкончаниеПредположительно КАК ОкончаниеПредположительно,
					   |    СостоянияСотрудников.ДатаНачалаИсключенияИзСтажа КАК ДатаНачалаИсключенияИзСтажа,
					   |	ВЫБОР 
					   |	КОГДА Не СостоянияСотрудников.ДатаНачалаИсключенияИзСтажа = ДАТАВРЕМЯ(1, 1, 1) И 
					   |   	СостоянияСотрудников.ДатаНачалаИсключенияИзСтажа > СостоянияСотрудников.Окончание 
					   |   	ТОГДА ИСТИНА
					   |	КОГДА  
					   |   	&ДатаОтчета <= СостоянияСотрудников.Начало 
					   |   	ТОГДА ИСТИНА
					   |	ИНАЧЕ
					   |		ЛОЖЬ 
					   |	КОНЕЦ КАК НеВключатьНевыход
					   |ПОМЕСТИТЬ ВТВсеНевыходыСотрудников
					   |ИЗ ВТВсеНевыходыСотрудников_ КАК СостоянияСотрудников 
					   |;
		               |////////////////////////////////////////////////////////////////////////////////
		               |ВЫБРАТЬ
		               |	СостоянияСотрудников.Сотрудник КАК Сотрудник,
		               |	СостоянияСотрудников.Состояние КАК Состояние,
		               |	СостоянияСотрудников.Начало КАК Начало,
		               |	СостоянияСотрудников.Окончание КАК Окончание,
		               |	СостоянияСотрудников.ОкончаниеПредположительно КАК ОкончаниеПредположительно,
		               |	ЕСТЬNULL(ВТНачальныеОстатки.ДатаОстатка, ДАТАВРЕМЯ(1, 1, 1)) КАК ДатаОстатка,
		               |	ЕСТЬNULL(ВТНачальныеОстатки.ВидЕжегодногоОтпуска, ЗНАЧЕНИЕ(Справочник.ВидыОтпусков.ПустаяСсылка)) КАК ВидЕжегодногоОтпускаОстаток
		               |ПОМЕСТИТЬ ВТВсеСостоянияСотрудников
		               |ИЗ
		               |	ВТВсеНевыходыСотрудников КАК СостоянияСотрудников
		               |		ЛЕВОЕ СОЕДИНЕНИЕ ВТНачальныеОстатки КАК ВТНачальныеОстатки
		               |		ПО СостоянияСотрудников.Сотрудник = ВТНачальныеОстатки.Сотрудник
		               |ГДЕ
		               |	СостоянияСотрудников.НеВключатьНевыход = ЛОЖЬ
		               |;
		               |
		               |////////////////////////////////////////////////////////////////////////////////
		               |ВЫБРАТЬ
		               |	СостоянияСотрудников.Сотрудник КАК Сотрудник,
		               |	СостоянияСотрудников.Состояние КАК Состояние,
		               |	ВЫБОР
		               |		КОГДА СостоянияСотрудников.ДатаОстатка <> ДАТАВРЕМЯ(1, 1, 1)
		               |				И СостоянияСотрудников.Начало < СостоянияСотрудников.ДатаОстатка
		               |				И СостоянияСотрудников.Окончание <= СостоянияСотрудников.ДатаОстатка
		               |			ТОГДА ЛОЖЬ
		               |		ИНАЧЕ ИСТИНА
		               |	КОНЕЦ КАК УчитыватьНевыход,
		               |	ВЫБОР
		               |		КОГДА СостоянияСотрудников.ДатаОстатка <> ДАТАВРЕМЯ(1, 1, 1)
		               |				И СостоянияСотрудников.Начало < СостоянияСотрудников.ДатаОстатка
		               |				И СостоянияСотрудников.Окончание > СостоянияСотрудников.ДатаОстатка
		               |			ТОГДА СостоянияСотрудников.ДатаОстатка
		               |		ИНАЧЕ СостоянияСотрудников.Начало
		               |	КОНЕЦ КАК Начало,
		               |	СостоянияСотрудников.Окончание КАК Окончание,
		               |	СостоянияСотрудников.ОкончаниеПредположительно КАК ОкончаниеПредположительно,
		               |	СостоянияСотрудников.ВидЕжегодногоОтпускаОстаток КАК ВидЕжегодногоОтпускаОстаток
		               |ПОМЕСТИТЬ ВТСостоянияСотрудников_
		               |ИЗ
		               |	ВТВсеСостоянияСотрудников КАК СостоянияСотрудников
		               |;
		               |
		               |////////////////////////////////////////////////////////////////////////////////
		               |ВЫБРАТЬ
		               |	СостоянияСотрудников.Сотрудник КАК Сотрудник,
		               |	СостоянияСотрудников.Начало КАК Начало,
		               |	СостоянияСотрудников.Окончание КАК Окончание,
		               |	СостоянияСотрудников.Состояние КАК Состояние,
		               |	СотрудникиИЗаработанныеПраваНаОтпуска.ДатаНачала КАК РабочийГодДатаНачала,
		               |	СотрудникиИЗаработанныеПраваНаОтпуска.ДатаОкончания КАК РабочийГодДатаОкончания,
		               |	СотрудникиИЗаработанныеПраваНаОтпуска.ВидЕжегодногоОтпуска КАК ВидЕжегодногоОтпуска
		               |ПОМЕСТИТЬ ВТСостоянияНевыходов
		               |ИЗ
		               |	ВТСостоянияСотрудников_ КАК СостоянияСотрудников
		               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТСотрудникиИЗаработанныеПраваНаОтпуска КАК СотрудникиИЗаработанныеПраваНаОтпуска
		               |		ПО СостоянияСотрудников.Сотрудник = СотрудникиИЗаработанныеПраваНаОтпуска.Сотрудник
		               |			И (СостоянияСотрудников.Начало <= СотрудникиИЗаработанныеПраваНаОтпуска.ДатаНачала
		               |					И СостоянияСотрудников.Окончание >= СотрудникиИЗаработанныеПраваНаОтпуска.ДатаОкончания
		               |				ИЛИ СостоянияСотрудников.Начало МЕЖДУ СотрудникиИЗаработанныеПраваНаОтпуска.ДатаНачала И СотрудникиИЗаработанныеПраваНаОтпуска.ДатаОкончания
		               |				ИЛИ СостоянияСотрудников.Окончание МЕЖДУ СотрудникиИЗаработанныеПраваНаОтпуска.ДатаНачала И СотрудникиИЗаработанныеПраваНаОтпуска.ДатаОкончания)
		               |			И (ВЫБОР
		               |				КОГДА СостоянияСотрудников.ВидЕжегодногоОтпускаОстаток <> ЗНАЧЕНИЕ(Справочник.ВидыОтпусков.ПустаяСсылка)
		               |					ТОГДА СостоянияСотрудников.ВидЕжегодногоОтпускаОстаток = СотрудникиИЗаработанныеПраваНаОтпуска.ВидЕжегодногоОтпуска
		               |				ИНАЧЕ ИСТИНА
		               |			КОНЕЦ)
		               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТТаблицаНевыходовПоВидамОтпусков КАК ТаблицаНевыходовПоВидамОтпусков
		               |		ПО СостоянияСотрудников.Состояние = ТаблицаНевыходовПоВидамОтпусков.Состояние
		               |			И (СотрудникиИЗаработанныеПраваНаОтпуска.ВидЕжегодногоОтпуска = ТаблицаНевыходовПоВидамОтпусков.ВидЕжегодногоОтпуска)
		               |ГДЕ
		               |	СостоянияСотрудников.УчитыватьНевыход = ИСТИНА  
					   |СГРУППИРОВАТЬ ПО
	               	   |	СостоянияСотрудников.Сотрудник,
		               |	СостоянияСотрудников.Начало,
		               |	СостоянияСотрудников.Окончание,
		               |	СостоянияСотрудников.Состояние,
		               |	СотрудникиИЗаработанныеПраваНаОтпуска.ДатаНачала,
		               |	СотрудникиИЗаработанныеПраваНаОтпуска.ДатаОкончания,
		               |	СотрудникиИЗаработанныеПраваНаОтпуска.ВидЕжегодногоОтпуска
					   |;
		               |
		               |////////////////////////////////////////////////////////////////////////////////
		               |ВЫБРАТЬ
		               |	СостоянияНевыходов.Сотрудник КАК Сотрудник,
		               |	ВЫБОР
		               |		КОГДА СостоянияНевыходов.Начало < СостоянияНевыходов.РабочийГодДатаНачала
		               |			ТОГДА СостоянияНевыходов.РабочийГодДатаНачала
		               |		ИНАЧЕ СостоянияНевыходов.Начало
		               |	КОНЕЦ КАК Начало,
		               |	ВЫБОР
		               |		КОГДА СостоянияНевыходов.Окончание > ВЫБОР
		               |				КОГДА СостоянияНевыходов.РабочийГодДатаОкончания > &ДатаОтчета
		               |					ТОГДА &ДатаОтчета
		               |				ИНАЧЕ СостоянияНевыходов.РабочийГодДатаОкончания
		               |			КОНЕЦ
		               |			ТОГДА ВЫБОР
		               |					КОГДА СостоянияНевыходов.РабочийГодДатаОкончания > &ДатаОтчета
		               |						ТОГДА &ДатаОтчета
		               |					ИНАЧЕ СостоянияНевыходов.РабочийГодДатаОкончания
		               |				КОНЕЦ
		               |		ИНАЧЕ СостоянияНевыходов.Окончание
		               |	КОНЕЦ КАК Окончание,
		               |	СостоянияНевыходов.Состояние КАК Состояние,
		               |	СостоянияНевыходов.РабочийГодДатаНачала КАК РабочийГодДатаНачала,
		               |	СостоянияНевыходов.РабочийГодДатаОкончания КАК РабочийГодДатаОкончания,
		               |	СостоянияНевыходов.ВидЕжегодногоОтпуска КАК ВидЕжегодногоОтпуска
		               |ПОМЕСТИТЬ ВТСостоянияНевыходовПорабочимГодам
		               |ИЗ
		               |	ВТСостоянияНевыходов КАК СостоянияНевыходов
		               |;
		               |
		               |////////////////////////////////////////////////////////////////////////////////
		               |ВЫБРАТЬ
		               |	СостоянияНевыходовПорабочимГодам.Сотрудник КАК Сотрудник,
		               |	РАЗНОСТЬДАТ(СостоянияНевыходовПорабочимГодам.Начало, СостоянияНевыходовПорабочимГодам.Окончание, ДЕНЬ) + 1 КАК ДниНевыходовЗаРабочийГод,
		               |	СостоянияНевыходовПорабочимГодам.РабочийГодДатаНачала КАК РабочийГодДатаНачала,
		               |	СостоянияНевыходовПорабочимГодам.РабочийГодДатаОкончания КАК РабочийГодДатаОкончания,
		               |	СостоянияНевыходовПорабочимГодам.ВидЕжегодногоОтпуска КАК ВидЕжегодногоОтпуска
		               |ПОМЕСТИТЬ ВТНевыходыЗаРабочийГод
		               |ИЗ
		               |	ВТСостоянияНевыходовПорабочимГодам КАК СостоянияНевыходовПорабочимГодам
		               |;
		               |
		               |////////////////////////////////////////////////////////////////////////////////
		               |ВЫБРАТЬ
		               |	НевыходыЗаРабочийГод.Сотрудник КАК Сотрудник,
		               |	СУММА(НевыходыЗаРабочийГод.ДниНевыходовЗаРабочийГод) КАК ДниНевыходов,
		               |	НевыходыЗаРабочийГод.РабочийГодДатаНачала КАК РабочийГодДатаНачала,
		               |	НевыходыЗаРабочийГод.РабочийГодДатаОкончания КАК РабочийГодДатаОкончания,
		               |	НевыходыЗаРабочийГод.ВидЕжегодногоОтпуска КАК ВидЕжегодногоОтпуска
		               |ПОМЕСТИТЬ ВТНевыходы
		               |ИЗ
		               |	ВТНевыходыЗаРабочийГод КАК НевыходыЗаРабочийГод
		               |
		               |СГРУППИРОВАТЬ ПО
		               |	НевыходыЗаРабочийГод.Сотрудник,
		               |	НевыходыЗаРабочийГод.РабочийГодДатаНачала,
		               |	НевыходыЗаРабочийГод.РабочийГодДатаОкончания,
		               |	НевыходыЗаРабочийГод.ВидЕжегодногоОтпуска
		               |;
		               |
		               |////////////////////////////////////////////////////////////////////////////////
		               |ВЫБРАТЬ РАЗРЕШЕННЫЕ
		               |	ФактическиеОтпуска.Сотрудник,
		               |	ФактическиеОтпуска.ВидЕжегодногоОтпуска,
		               |	СУММА(ФактическиеОтпуска.Количество) КАК Отгуляно
		               |ПОМЕСТИТЬ ВТУчитываемыеОтпускаСотрудников
		               |ИЗ
		               |	РегистрНакопления.ФактическиеОтпуска КАК ФактическиеОтпуска
		               |		ЛЕВОЕ СОЕДИНЕНИЕ ВТНачальныеОстатки КАК ВТНачальныеОстатки
		               |		ПО ФактическиеОтпуска.Сотрудник = ВТНачальныеОстатки.Сотрудник
		               |			И ФактическиеОтпуска.ВидЕжегодногоОтпуска = ВТНачальныеОстатки.ВидЕжегодногоОтпуска
		               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТЕжегодныеОтпуска КАК ВТЕжегодныеОтпуска
		               |		ПО ФактическиеОтпуска.ВидЕжегодногоОтпуска = ВТЕжегодныеОтпуска.ВидЕжегодногоОтпуска
		               |ГДЕ
		               |	ФактическиеОтпуска.Период >= ЕСТЬNULL(ВТНачальныеОстатки.ДатаОстатка, ДАТАВРЕМЯ(1, 1, 1))
		               |	И ФактическиеОтпуска.Период <= КОНЕЦПЕРИОДА(&ДатаОтчета, ДЕНЬ)
		               |
		               |СГРУППИРОВАТЬ ПО
		               |	ФактическиеОтпуска.Сотрудник,
		               |	ФактическиеОтпуска.ВидЕжегодногоОтпуска
		               |;
		               |
		               |////////////////////////////////////////////////////////////////////////////////
		               |ВЫБРАТЬ
		               |	ЗаработанныеПрава.Сотрудник КАК Сотрудник,
		               |	ЗаработанныеПрава.ВидЕжегодногоОтпуска КАК ВидЕжегодногоОтпуска,
		               |	ЗаработанныеПрава.ДатаНачала КАК ДатаНачала,
		               |	ЗаработанныеПрава.ДатаОкончания КАК ДатаОкончания,
		               |	ВЫБОР
		               |		КОГДА ЕСТЬNULL(ПраздничныеДни.ДатаПраздника, ДАТАВРЕМЯ(1, 1, 1)) = ДАТАВРЕМЯ(1, 1, 1)
		               |			ТОГДА 0
		               |		ИНАЧЕ 1
		               |	КОНЕЦ КАК ПраздничныйДень
		               |ПОМЕСТИТЬ ВТПраздничные
		               |ИЗ
		               |	ВТЗаработанныеПрава КАК ЗаработанныеПрава
		               |		ЛЕВОЕ СОЕДИНЕНИЕ ВТПраздничныеДниПодробно КАК ПраздничныеДни
		               |		ПО (ПраздничныеДни.ДатаПраздника МЕЖДУ ЗаработанныеПрава.ДатаНачала И ЗаработанныеПрава.ДатаОкончания)
		               |;
		               |
		               |////////////////////////////////////////////////////////////////////////////////
		               |ВЫБРАТЬ
		               |	ЗаработанныеПраваИПраздники.Сотрудник КАК Сотрудник,
		               |	ЗаработанныеПраваИПраздники.ВидЕжегодногоОтпуска КАК ВидЕжегодногоОтпуска,
		               |	ЗаработанныеПраваИПраздники.ДатаНачала КАК ДатаНачала,
		               |	ЗаработанныеПраваИПраздники.ДатаОкончания КАК ДатаОкончания,
		               |	РАЗНОСТЬДАТ(ЗаработанныеПраваИПраздники.ДатаНачала, ЗаработанныеПраваИПраздники.ДатаОкончания, ДЕНЬ) + 1 КАК КалендарныхДней,
		               |	СУММА(ЗаработанныеПраваИПраздники.ПраздничныйДень) КАК ПраздничныхДней
		               |ПОМЕСТИТЬ ВТКалендарныеИПраздничные
		               |ИЗ
		               |	ВТПраздничные КАК ЗаработанныеПраваИПраздники
		               |
		               |СГРУППИРОВАТЬ ПО
		               |	ЗаработанныеПраваИПраздники.Сотрудник,
		               |	ЗаработанныеПраваИПраздники.ВидЕжегодногоОтпуска,
		               |	ЗаработанныеПраваИПраздники.ДатаНачала,
		               |	ЗаработанныеПраваИПраздники.ДатаОкончания
		               |;
		               |
		               |////////////////////////////////////////////////////////////////////////////////
		               |ВЫБРАТЬ
		               |	ЗаработанныеПрава.Сотрудник КАК Сотрудник,
		               |	ЗаработанныеПрава.ВидЕжегодногоОтпуска КАК ВидЕжегодногоОтпуска,
		               |	ЗаработанныеПрава.ДатаНачала КАК ДатаНачала,
		               |	ЗаработанныеПрава.ДатаОкончания КАК ДатаОкончания,
		               |	ВЫБОР
		               |		КОГДА ЕСТЬNULL(ПраздничныеДни.ДатаПраздника, ДАТАВРЕМЯ(1, 1, 1)) = ДАТАВРЕМЯ(1, 1, 1)
		               |				ИЛИ НЕ ТекущиеКадровыеДанныеСотрудников.ДатаУвольнения = ДАТАВРЕМЯ(1, 1, 1)
		               |					И ЕСТЬNULL(ПраздничныеДни.ДатаПраздника, ДАТАВРЕМЯ(1, 1, 1)) > ТекущиеКадровыеДанныеСотрудников.ДатаУвольнения
		               |			ТОГДА 0
		               |		ИНАЧЕ 1
		               |	КОНЕЦ КАК ПраздничныйДень
		               |ПОМЕСТИТЬ ВТПраздничныеЗаОтработанныйПериод
		               |ИЗ
		               |	ВТЗаработанныеПрава КАК ЗаработанныеПрава
		               |		ЛЕВОЕ СОЕДИНЕНИЕ ВТТекущиеКадровыеДанныеСотрудников КАК ТекущиеКадровыеДанныеСотрудников
		               |		ПО ЗаработанныеПрава.Сотрудник = ТекущиеКадровыеДанныеСотрудников.Сотрудник
		               |		ЛЕВОЕ СОЕДИНЕНИЕ ВТНачальныеОстатки КАК НачальныеОстатки
		               |		ПО ЗаработанныеПрава.Сотрудник = НачальныеОстатки.Сотрудник
		               |			И ЗаработанныеПрава.ВидЕжегодногоОтпуска = НачальныеОстатки.ВидЕжегодногоОтпуска
		               |			И (ВЫБОР
		               |				КОГДА ЗаработанныеПрава.УчитыватьОтпускВРазрезеКалендарногоГода
		               |					ТОГДА НачальныеОстатки.ДатаОстатка МЕЖДУ ЗаработанныеПрава.ДатаНачалаОбщая И ВЫБОР
		               |							КОГДА &ДатаОтчета < ЗаработанныеПрава.ДатаОкончанияОбщая
		               |								ТОГДА &ДатаОтчета
		               |							ИНАЧЕ ЗаработанныеПрава.ДатаОкончанияОбщая
		               |						КОНЕЦ
		               |				ИНАЧЕ НачальныеОстатки.ДатаОстатка МЕЖДУ ЗаработанныеПрава.ДатаНачала И ВЫБОР
		               |						КОГДА &ДатаОтчета < ЗаработанныеПрава.ДатаОкончания
		               |							ТОГДА &ДатаОтчета
		               |						ИНАЧЕ ЗаработанныеПрава.ДатаОкончания
		               |					КОНЕЦ
		               |			КОНЕЦ)
		               |		ЛЕВОЕ СОЕДИНЕНИЕ ВТПраздничныеДниПодробно КАК ПраздничныеДни
		               |		ПО (ПраздничныеДни.ДатаПраздника МЕЖДУ ВЫБОР
		               |				КОГДА НЕ ЕСТЬNULL(НачальныеОстатки.ДатаОстатка, ДАТАВРЕМЯ(1, 1, 1)) = ДАТАВРЕМЯ(1, 1, 1)
		               |					ТОГДА НачальныеОстатки.ДатаОстатка
		               |				ИНАЧЕ ЗаработанныеПрава.ДатаНачала
		               |			КОНЕЦ И ВЫБОР
		               |				КОГДА &ДатаОтчета < ЗаработанныеПрава.ДатаОкончания
		               |					ТОГДА &ДатаОтчета
		               |				ИНАЧЕ ЗаработанныеПрава.ДатаОкончания
		               |			КОНЕЦ)
		               |;
		               |
		               |////////////////////////////////////////////////////////////////////////////////
		               |ВЫБРАТЬ
		               |	ЗаработанныеПрава.Сотрудник КАК Сотрудник,
		               |	ЗаработанныеПрава.ВидЕжегодногоОтпуска КАК ВидЕжегодногоОтпуска,
		               |	ЗаработанныеПрава.ДатаНачала КАК ДатаНачала,
		               |	ЗаработанныеПрава.ДатаОкончания КАК ДатаОкончания,
		               |	ВЫБОР
		               |		КОГДА ЕСТЬNULL(НачальныеОстатки.ДатаОстатка, ДАТАВРЕМЯ(1, 1, 1)) = ДАТАВРЕМЯ(1, 1, 1)
		               |			ТОГДА РАЗНОСТЬДАТ(ЗаработанныеПрава.ДатаНачала, ВЫБОР
		               |						КОГДА НЕ ТекущиеКадровыеДанныеСотрудников.ДатаУвольнения = ДАТАВРЕМЯ(1, 1, 1)
		               |								И ТекущиеКадровыеДанныеСотрудников.ДатаУвольнения < &ДатаОтчета
		               |								И ТекущиеКадровыеДанныеСотрудников.ДатаУвольнения < ЗаработанныеПрава.ДатаОкончания
		               |							ТОГДА ТекущиеКадровыеДанныеСотрудников.ДатаУвольнения
		               |						КОГДА &ДатаОтчета < ЗаработанныеПрава.ДатаОкончания
		               |							ТОГДА &ДатаОтчета
		               |						ИНАЧЕ ЗаработанныеПрава.ДатаОкончания
		               |					КОНЕЦ, ДЕНЬ) + 1
		               |		ИНАЧЕ РАЗНОСТЬДАТ(НачальныеОстатки.ДатаОстатка, ВЫБОР
		               |					КОГДА &ДатаОтчета < ЗаработанныеПрава.ДатаОкончания
		               |						ТОГДА &ДатаОтчета
		               |					ИНАЧЕ ЗаработанныеПрава.ДатаОкончания
		               |				КОНЕЦ, ДЕНЬ) + 1
		               |	КОНЕЦ КАК КалендарныхДней,
		               |	СУММА(ПраздничныеДни.ПраздничныйДень) КАК ПраздничныхДней
		               |ПОМЕСТИТЬ ВТКалендарныеИПраздничныеЗаОтработанныйПериод
		               |ИЗ
		               |	ВТЗаработанныеПрава КАК ЗаработанныеПрава
		               |		ЛЕВОЕ СОЕДИНЕНИЕ ВТТекущиеКадровыеДанныеСотрудников КАК ТекущиеКадровыеДанныеСотрудников
		               |		ПО ЗаработанныеПрава.Сотрудник = ТекущиеКадровыеДанныеСотрудников.Сотрудник
		               |		ЛЕВОЕ СОЕДИНЕНИЕ ВТНачальныеОстатки КАК НачальныеОстатки
		               |		ПО ЗаработанныеПрава.Сотрудник = НачальныеОстатки.Сотрудник
		               |			И ЗаработанныеПрава.ВидЕжегодногоОтпуска = НачальныеОстатки.ВидЕжегодногоОтпуска
		               |			И (ВЫБОР
		               |				КОГДА ЗаработанныеПрава.УчитыватьОтпускВРазрезеКалендарногоГода
		               |					ТОГДА НачальныеОстатки.ДатаОстатка МЕЖДУ ЗаработанныеПрава.ДатаНачалаОбщая И ВЫБОР
		               |							КОГДА &ДатаОтчета < ЗаработанныеПрава.ДатаОкончанияОбщая
		               |								ТОГДА &ДатаОтчета
		               |							ИНАЧЕ ЗаработанныеПрава.ДатаОкончанияОбщая
		               |						КОНЕЦ
		               |				ИНАЧЕ НачальныеОстатки.ДатаОстатка МЕЖДУ ЗаработанныеПрава.ДатаНачала И ВЫБОР
		               |						КОГДА &ДатаОтчета < ЗаработанныеПрава.ДатаОкончания
		               |							ТОГДА &ДатаОтчета
		               |						ИНАЧЕ ЗаработанныеПрава.ДатаОкончания
		               |					КОНЕЦ
		               |			КОНЕЦ)
		               |		ЛЕВОЕ СОЕДИНЕНИЕ ВТПраздничныеЗаОтработанныйПериод КАК ПраздничныеДни
		               |		ПО ЗаработанныеПрава.Сотрудник = ПраздничныеДни.Сотрудник
		               |			И ЗаработанныеПрава.ВидЕжегодногоОтпуска = ПраздничныеДни.ВидЕжегодногоОтпуска
		               |			И ЗаработанныеПрава.ДатаНачала = ПраздничныеДни.ДатаНачала
		               |			И ЗаработанныеПрава.ДатаОкончания = ПраздничныеДни.ДатаОкончания
		               |
		               |СГРУППИРОВАТЬ ПО
		               |	ЗаработанныеПрава.Сотрудник,
		               |	ЗаработанныеПрава.ВидЕжегодногоОтпуска,
		               |	ЗаработанныеПрава.ДатаНачала,
		               |	ЗаработанныеПрава.ДатаОкончания,
		               |	ВЫБОР
		               |		КОГДА ЕСТЬNULL(НачальныеОстатки.ДатаОстатка, ДАТАВРЕМЯ(1, 1, 1)) = ДАТАВРЕМЯ(1, 1, 1)
		               |			ТОГДА РАЗНОСТЬДАТ(ЗаработанныеПрава.ДатаНачала, ВЫБОР
		               |						КОГДА НЕ ТекущиеКадровыеДанныеСотрудников.ДатаУвольнения = ДАТАВРЕМЯ(1, 1, 1)
		               |								И ТекущиеКадровыеДанныеСотрудников.ДатаУвольнения < &ДатаОтчета
		               |								И ТекущиеКадровыеДанныеСотрудников.ДатаУвольнения < ЗаработанныеПрава.ДатаОкончания
		               |							ТОГДА ТекущиеКадровыеДанныеСотрудников.ДатаУвольнения
		               |						КОГДА &ДатаОтчета < ЗаработанныеПрава.ДатаОкончания
		               |							ТОГДА &ДатаОтчета
		               |						ИНАЧЕ ЗаработанныеПрава.ДатаОкончания
		               |					КОНЕЦ, ДЕНЬ) + 1
		               |		ИНАЧЕ РАЗНОСТЬДАТ(НачальныеОстатки.ДатаОстатка, ВЫБОР
		               |					КОГДА &ДатаОтчета < ЗаработанныеПрава.ДатаОкончания
		               |						ТОГДА &ДатаОтчета
		               |					ИНАЧЕ ЗаработанныеПрава.ДатаОкончания
		               |				КОНЕЦ, ДЕНЬ) + 1
		               |	КОНЕЦ
		               |;
		               |
		               |////////////////////////////////////////////////////////////////////////////////
		               |ВЫБРАТЬ
		               |	ЗаработанныеПрава.Сотрудник КАК Сотрудник,
		               |	ЗаработанныеПрава.ВидЕжегодногоОтпуска КАК ВидЕжегодногоОтпуска,
		               |	ЗаработанныеПрава.ДатаНачала КАК ДатаНачала,
		               |	ЗаработанныеПрава.ДатаОкончания КАК ДатаОкончания,
		               |	КалендарныеИПраздничные.КалендарныхДней КАК КалендарныхДнейЗаРабочийГод,
		               |	КалендарныеИПраздничные.ПраздничныхДней КАК ПраздничныхДнейЗаРабочийГод,
		               |	КалендарныеИПраздничныеЗаОтработанныйПериод.КалендарныхДней КАК КалендарныхДнейЗаОтработанноеВремя,
		               |	КалендарныеИПраздничныеЗаОтработанныйПериод.ПраздничныхДней КАК ПраздничныхДнейЗаОтработанноеВремя,
		               |	ЕСТЬNULL(Невыходы.ДниНевыходов, 0) КАК ДниНевыходов,
		               |	ЕСТЬNULL(ТекущиеПраваНаОтпуска.ДнейЕжегодно, 0) КАК ДнейЕжегодно,
		               |	ЗаработанныеПрава.КоличествоДнейНачальногоОстатка КАК НачальныйОстаток,
					   |	ЗаработанныеПрава.ГодОстатков КАК ГодОстатков, 
					   |	ЗаработанныеПрава.ПоследнийГодОстатков КАК ПоследнийГодОстатков, 
					   |	ВЫБОР
					   |		КОГДА ЗаработанныеПрава.ВидЕжегодногоОтпуска.УчитыватьОтпускВРазрезеКалендарногоГода
					   |			ТОГДА ВЫБОР
					   |					КОГДА НЕ ЗаработанныеПрава.ГодОстатков
					   |						ТОГДА ЕСТЬNULL(ТекущиеПраваНаОтпуска.ДнейЕжегодно, 0)
					   |					ИНАЧЕ ЗаработанныеПрава.КоличествоДнейНачальногоОстатка
					   |				КОНЕЦ
					   |		ИНАЧЕ 
					   |            ВЫБОР 
					   |            	КОГДА ЗаработанныеПрава.ПоследнийГодОстатков  
					   |                	ТОГДА 
				   	   |						ВЫБОР КОГДА КалендарныеИПраздничные.КалендарныхДней - КалендарныеИПраздничные.ПраздничныхДней > 0
					   |							И КалендарныеИПраздничныеЗаОтработанныйПериод.КалендарныхДней > ЕСТЬNULL(Невыходы.ДниНевыходов, 0) + КалендарныеИПраздничныеЗаОтработанныйПериод.ПраздничныхДней  
					   |							ТОГДА ВЫРАЗИТЬ(ЕСТЬNULL(ТекущиеПраваНаОтпуска.ДнейЕжегодно, 0) * (КалендарныеИПраздничныеЗаОтработанныйПериод.КалендарныхДней - КалендарныеИПраздничныеЗаОтработанныйПериод.ПраздничныхДней - ЕСТЬNULL(Невыходы.ДниНевыходов, 0)) / (КалендарныеИПраздничные.КалендарныхДней - КалендарныеИПраздничные.ПраздничныхДней) + ЗаработанныеПрава.КоличествоДнейНачальногоОстатка КАК ЧИСЛО(5, 0))
					   |						ИНАЧЕ ЗаработанныеПрава.КоличествоДнейНачальногоОстатка
					   |                        КОНЕЦ    
					   |            	КОГДА НЕ ЗаработанныеПрава.ПоследнийГодОстатков И ЗаработанныеПрава.ГодОстатков 
					   |                	ТОГДА ЗаработанныеПрава.КоличествоДнейНачальногоОстатка   
					   |                КОГДА ЗаработанныеПрава.КоличествоДнейНачальногоОстатка = 0 И НЕ ЗаработанныеПрава.ГодОстатков  
					   |                    ТОГДА
					   |						ВЫБОР КОГДА КалендарныеИПраздничные.КалендарныхДней - КалендарныеИПраздничные.ПраздничныхДней > 0
					   |							И КалендарныеИПраздничныеЗаОтработанныйПериод.КалендарныхДней > ЕСТЬNULL(Невыходы.ДниНевыходов, 0) + КалендарныеИПраздничныеЗаОтработанныйПериод.ПраздничныхДней  
					   |							ТОГДА ВЫРАЗИТЬ(ЕСТЬNULL(ТекущиеПраваНаОтпуска.ДнейЕжегодно, 0) * (КалендарныеИПраздничныеЗаОтработанныйПериод.КалендарныхДней - КалендарныеИПраздничныеЗаОтработанныйПериод.ПраздничныхДней - ЕСТЬNULL(Невыходы.ДниНевыходов, 0)) / (КалендарныеИПраздничные.КалендарныхДней - КалендарныеИПраздничные.ПраздничныхДней) + ЗаработанныеПрава.КоличествоДнейНачальногоОстатка КАК ЧИСЛО(5, 0))
					   |						ИНАЧЕ ЗаработанныеПрава.КоличествоДнейНачальногоОстатка
					   |			 	 		КОНЕЦ  
					   |            КОНЕЦ
					   |	КОНЕЦ КАК Дней
					   |ПОМЕСТИТЬ ВТЗаработанныеОтпускаПоГодам
		               |ИЗ
		               |	ВТЗаработанныеПрава КАК ЗаработанныеПрава
		               |		ЛЕВОЕ СОЕДИНЕНИЕ ВТКалендарныеИПраздничные КАК КалендарныеИПраздничные
		               |		ПО ЗаработанныеПрава.Сотрудник = КалендарныеИПраздничные.Сотрудник
		               |			И ЗаработанныеПрава.ВидЕжегодногоОтпуска = КалендарныеИПраздничные.ВидЕжегодногоОтпуска
		               |			И ЗаработанныеПрава.ДатаНачала = КалендарныеИПраздничные.ДатаНачала
		               |			И ЗаработанныеПрава.ДатаОкончания = КалендарныеИПраздничные.ДатаОкончания
		               |		ЛЕВОЕ СОЕДИНЕНИЕ ВТКалендарныеИПраздничныеЗаОтработанныйПериод КАК КалендарныеИПраздничныеЗаОтработанныйПериод
		               |		ПО ЗаработанныеПрава.Сотрудник = КалендарныеИПраздничныеЗаОтработанныйПериод.Сотрудник
		               |			И ЗаработанныеПрава.ВидЕжегодногоОтпуска = КалендарныеИПраздничныеЗаОтработанныйПериод.ВидЕжегодногоОтпуска
		               |			И ЗаработанныеПрава.ДатаНачала = КалендарныеИПраздничныеЗаОтработанныйПериод.ДатаНачала
		               |			И ЗаработанныеПрава.ДатаОкончания = КалендарныеИПраздничныеЗаОтработанныйПериод.ДатаОкончания
		               |		ЛЕВОЕ СОЕДИНЕНИЕ ВТНевыходы КАК Невыходы
		               |		ПО ЗаработанныеПрава.Сотрудник = Невыходы.Сотрудник
		               |			И ЗаработанныеПрава.ДатаНачала = Невыходы.РабочийГодДатаНачала
		               |			И ЗаработанныеПрава.ДатаОкончания = Невыходы.РабочийГодДатаОкончания
		               |			И ЗаработанныеПрава.ВидЕжегодногоОтпуска = Невыходы.ВидЕжегодногоОтпуска
		               |		ЛЕВОЕ СОЕДИНЕНИЕ ВТТекущиеПраваНаОтпуска КАК ТекущиеПраваНаОтпуска
		               |		ПО ЗаработанныеПрава.Сотрудник = ТекущиеПраваНаОтпуска.Сотрудник
		               |			И ЗаработанныеПрава.ВидЕжегодногоОтпуска = ТекущиеПраваНаОтпуска.ВидЕжегодногоОтпуска
					   |			И ЗаработанныеПрава.ДатаНачала = ТекущиеПраваНаОтпуска.ДатаНачала
					   |			И ЗаработанныеПрава.ДатаОкончания = ТекущиеПраваНаОтпуска.ДатаОкончания
					   |		ЛЕВОЕ СОЕДИНЕНИЕ ВТНачальныеОстатки КАК НачальныеОстатки
					   |		ПО ЗаработанныеПрава.Сотрудник = НачальныеОстатки.Сотрудник
					   |			И ЗаработанныеПрава.ВидЕжегодногоОтпуска = НачальныеОстатки.ВидЕжегодногоОтпуска
					   |
					   |СГРУППИРОВАТЬ ПО
					   |	ЕСТЬNULL(Невыходы.ДниНевыходов, 0),
		               |	ЗаработанныеПрава.ДатаНачала,
		               |	ЗаработанныеПрава.Сотрудник,
		               |	ЗаработанныеПрава.ДатаОкончания,
		               |	ЗаработанныеПрава.ВидЕжегодногоОтпуска,
		               |	КалендарныеИПраздничные.КалендарныхДней,
		               |	КалендарныеИПраздничные.ПраздничныхДней,
		               |	КалендарныеИПраздничныеЗаОтработанныйПериод.КалендарныхДней,
		               |	КалендарныеИПраздничныеЗаОтработанныйПериод.ПраздничныхДней,
		               |	ЕСТЬNULL(ТекущиеПраваНаОтпуска.ДнейЕжегодно, 0),
					   |	ЗаработанныеПрава.КоличествоДнейНачальногоОстатка,
					   |	ЗаработанныеПрава.ГодОстатков,     
					   |	ЗаработанныеПрава.ПоследнийГодОстатков,
					   |	ВЫБОР
					   |		КОГДА ЗаработанныеПрава.ВидЕжегодногоОтпуска.УчитыватьОтпускВРазрезеКалендарногоГода
					   |			ТОГДА ВЫБОР
					   |					КОГДА НЕ ЗаработанныеПрава.ГодОстатков
					   |						ТОГДА ЕСТЬNULL(ТекущиеПраваНаОтпуска.ДнейЕжегодно, 0)
					   |					ИНАЧЕ ЗаработанныеПрава.КоличествоДнейНачальногоОстатка
					   |				КОНЕЦ
					   |		ИНАЧЕ 
					   |            ВЫБОР 
					   |            	КОГДА ЗаработанныеПрава.ПоследнийГодОстатков 
					   |                	ТОГДА 
				   	   |						ВЫБОР КОГДА КалендарныеИПраздничные.КалендарныхДней - КалендарныеИПраздничные.ПраздничныхДней > 0
					   |							И КалендарныеИПраздничныеЗаОтработанныйПериод.КалендарныхДней > ЕСТЬNULL(Невыходы.ДниНевыходов, 0) + КалендарныеИПраздничныеЗаОтработанныйПериод.ПраздничныхДней  
					   |							ТОГДА ВЫРАЗИТЬ(ЕСТЬNULL(ТекущиеПраваНаОтпуска.ДнейЕжегодно, 0) * (КалендарныеИПраздничныеЗаОтработанныйПериод.КалендарныхДней - КалендарныеИПраздничныеЗаОтработанныйПериод.ПраздничныхДней - ЕСТЬNULL(Невыходы.ДниНевыходов, 0)) / (КалендарныеИПраздничные.КалендарныхДней - КалендарныеИПраздничные.ПраздничныхДней) + ЗаработанныеПрава.КоличествоДнейНачальногоОстатка КАК ЧИСЛО(5, 0))
					   |						ИНАЧЕ ЗаработанныеПрава.КоличествоДнейНачальногоОстатка
					   |                        КОНЕЦ    
					   |            	КОГДА НЕ ЗаработанныеПрава.ПоследнийГодОстатков И ЗаработанныеПрава.ГодОстатков 
					   |                	ТОГДА ЗаработанныеПрава.КоличествоДнейНачальногоОстатка   
					   |                КОГДА ЗаработанныеПрава.КоличествоДнейНачальногоОстатка = 0 И НЕ ЗаработанныеПрава.ГодОстатков  
					   |                    ТОГДА
					   |						ВЫБОР КОГДА КалендарныеИПраздничные.КалендарныхДней - КалендарныеИПраздничные.ПраздничныхДней > 0
					   |							И КалендарныеИПраздничныеЗаОтработанныйПериод.КалендарныхДней > ЕСТЬNULL(Невыходы.ДниНевыходов, 0) + КалендарныеИПраздничныеЗаОтработанныйПериод.ПраздничныхДней  
					   |							ТОГДА ВЫРАЗИТЬ(ЕСТЬNULL(ТекущиеПраваНаОтпуска.ДнейЕжегодно, 0) * (КалендарныеИПраздничныеЗаОтработанныйПериод.КалендарныхДней - КалендарныеИПраздничныеЗаОтработанныйПериод.ПраздничныхДней - ЕСТЬNULL(Невыходы.ДниНевыходов, 0)) / (КалендарныеИПраздничные.КалендарныхДней - КалендарныеИПраздничные.ПраздничныхДней) + ЗаработанныеПрава.КоличествоДнейНачальногоОстатка КАК ЧИСЛО(5, 0))
					   |						ИНАЧЕ ЗаработанныеПрава.КоличествоДнейНачальногоОстатка
					   |			 	 		КОНЕЦ  
					   |            КОНЕЦ
					   |	КОНЕЦ
					   |;
		               |
		               |////////////////////////////////////////////////////////////////////////////////
		               |ВЫБРАТЬ
		               |	ЗаработанныеОтпускаПоГодам.Сотрудник КАК Сотрудник,
		               |	ЗаработанныеОтпускаПоГодам.ВидЕжегодногоОтпуска КАК ВидОтпуска,
		               |	ЗаработанныеОтпускаПоГодам.ДатаНачала КАК ДатаНачала,
		               |	ЗаработанныеОтпускаПоГодам.ДатаОкончания КАК ДатаОкончания,  
					   |	ЗаработанныеОтпускаПоГодам.ГодОстатков КАК ГодОстатков,
					   |	ЗаработанныеОтпускаПоГодам.ПоследнийГодОстатков КАК ПоследнийГодОстатков,
		               |	ЕСТЬNULL(ЗаработанныеОтпускаПоГодам.Дней, 0) КАК Дней,
		               |	ЕСТЬNULL(ВТУчитываемыеОтпускаСотрудников.Отгуляно, 0) КАК Отгуляно
		               |ПОМЕСТИТЬ ВТРабочиеГодаСотрудниковОтгуляно
		               |ИЗ
		               |	ВТЗаработанныеОтпускаПоГодам КАК ЗаработанныеОтпускаПоГодам
		               |		ЛЕВОЕ СОЕДИНЕНИЕ ВТУчитываемыеОтпускаСотрудников КАК ВТУчитываемыеОтпускаСотрудников
		               |		ПО ЗаработанныеОтпускаПоГодам.Сотрудник = ВТУчитываемыеОтпускаСотрудников.Сотрудник
		               |			И ЗаработанныеОтпускаПоГодам.ВидЕжегодногоОтпуска = ВТУчитываемыеОтпускаСотрудников.ВидЕжегодногоОтпуска
		               |;
		               |
		               |////////////////////////////////////////////////////////////////////////////////
		               |ВЫБРАТЬ
		               |	РабочиеГодаСотрудников.Сотрудник КАК Сотрудник,
		               |	РабочиеГодаСотрудников.ВидЕжегодногоОтпуска КАК ВидОтпуска,
		               |	РабочиеГодаСотрудников.ДатаНачала КАК РабочийГодДатаНачала, 
		               |	РабочиеГодаСотрудников.ГодОстатков КАК ГодОстатков,  
					   |	РабочиеГодаСотрудников.ПоследнийГодОстатков КАК ПоследнийГодОстатков,
		               |	МАКСИМУМ(ЕСТЬNULL(РабочиеГодаСотрудниковПредыдущие.ДатаНачала, РабочиеГодаСотрудников.ДатаНачала)) КАК ПредыдущийРабочийГодДатаНачала
		               |ПОМЕСТИТЬ ВТУказателиРабочихЛет
		               |ИЗ
		               |	ВТЗаработанныеОтпускаПоГодам КАК РабочиеГодаСотрудников
		               |		ЛЕВОЕ СОЕДИНЕНИЕ ВТЗаработанныеОтпускаПоГодам КАК РабочиеГодаСотрудниковПредыдущие
		               |		ПО РабочиеГодаСотрудников.Сотрудник = РабочиеГодаСотрудниковПредыдущие.Сотрудник
		               |			И РабочиеГодаСотрудников.ВидЕжегодногоОтпуска = РабочиеГодаСотрудниковПредыдущие.ВидЕжегодногоОтпуска
		               |			И РабочиеГодаСотрудников.ДатаНачала > РабочиеГодаСотрудниковПредыдущие.ДатаНачала
		               |
		               |СГРУППИРОВАТЬ ПО
		               |	РабочиеГодаСотрудников.Сотрудник,
		               |	РабочиеГодаСотрудников.ВидЕжегодногоОтпуска,
		               |	РабочиеГодаСотрудников.ДатаНачала,
					   |	РабочиеГодаСотрудников.ГодОстатков,
					   |	РабочиеГодаСотрудников.ПоследнийГодОстатков
		               |;
		               |ВЫБРАТЬ
		               |	УказателиРабочихЛет.Сотрудник КАК Сотрудник,
		               |	УказателиРабочихЛет.ВидОтпуска КАК ВидОтпуска,                
		               |	УказателиРабочихЛет.ГодОстатков КАК ГодОстатков,
		               |	УказателиРабочихЛет.ПоследнийГодОстатков КАК ПоследнийГодОстатков,
		               |	УказателиРабочихЛет.РабочийГодДатаНачала КАК РабочийГодДатаНачала,
		               |	СУММА(РабочиеГодаСотрудниковПредыдущие.Дней) КАК НарастающийОстатокДней,
					   |    РабочиеГодаСотрудников.Дней КАК ЗаработаноДней
		               |ПОМЕСТИТЬ ВТНарастающиеОстаткиПоРабочимГодамПолная
		               |ИЗ
		               |	ВТУказателиРабочихЛет КАК УказателиРабочихЛет
		               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТЗаработанныеОтпускаПоГодам КАК РабочиеГодаСотрудниковПредыдущие
		               |		ПО УказателиРабочихЛет.Сотрудник = РабочиеГодаСотрудниковПредыдущие.Сотрудник
		               |			И УказателиРабочихЛет.ВидОтпуска = РабочиеГодаСотрудниковПредыдущие.ВидЕжегодногоОтпуска
		               |			И УказателиРабочихЛет.РабочийГодДатаНачала >= РабочиеГодаСотрудниковПредыдущие.ДатаНачала
		               |		ЛЕВОЕ СОЕДИНЕНИЕ ВТЗаработанныеОтпускаПоГодам КАК РабочиеГодаСотрудников
		               |		ПО УказателиРабочихЛет.Сотрудник = РабочиеГодаСотрудников.Сотрудник
		               |			И УказателиРабочихЛет.ВидОтпуска = РабочиеГодаСотрудников.ВидЕжегодногоОтпуска
		               |			И УказателиРабочихЛет.РабочийГодДатаНачала = РабочиеГодаСотрудников.ДатаНачала
		               |
		               |СГРУППИРОВАТЬ ПО
		               |	УказателиРабочихЛет.Сотрудник,
		               |	УказателиРабочихЛет.ВидОтпуска, 
					   |	УказателиРабочихЛет.ГодОстатков,  
					   |	УказателиРабочихЛет.ПоследнийГодОстатков,
		               |	УказателиРабочихЛет.РабочийГодДатаНачала,
					   |    РабочиеГодаСотрудников.Дней
		               |;
					   |
					   |ВЫБРАТЬ
					   |	УказателиРабочихЛет.Сотрудник КАК Сотрудник,
					   |	УказателиРабочихЛет.ВидОтпуска КАК ВидОтпуска,
					   |	УказателиРабочихЛет.ГодОстатков КАК ГодОстатков,
					   |	УказателиРабочихЛет.ПоследнийГодОстатков КАК ПоследнийГодОстатков,
					   |	УказателиРабочихЛет.РабочийГодДатаНачала КАК РабочийГодДатаНачала,
					   |	ВЫБОР 
					   |		КОГДА УказателиРабочихЛет.ГодОстатков И НЕ УказателиРабочихЛет.ПоследнийГодОстатков
					   |		И УказателиРабочихЛет.ЗаработаноДней <= 0
					   |			ТОГДА УказателиРабочихЛет.ЗаработаноДней
					   |	ИНАЧЕ
					   |		УказателиРабочихЛет.НарастающийОстатокДней - ЕСТЬNULL(РабочиеГодаСотрудниковОтгуляно.Отгуляно, 0) 
					   |	КОНЕЦ КАК НарастающийОстатокДнейОтгуляно,
					   |	ЕСТЬNULL(РабочиеГодаСотрудниковОтгуляно.Отгуляно, 0) КАК Отгуляно,
					   |	УказателиРабочихЛет.НарастающийОстатокДней КАК НарастающийОстатокДней
					   |ПОМЕСТИТЬ ВТНарастающиеОстаткиПоРабочимГодам
					   |ИЗ
					   |	ВТНарастающиеОстаткиПоРабочимГодамПолная КАК УказателиРабочихЛет
					   |		ЛЕВОЕ СОЕДИНЕНИЕ ВТРабочиеГодаСотрудниковОтгуляно КАК РабочиеГодаСотрудниковОтгуляно
					   |		ПО УказателиРабочихЛет.Сотрудник = РабочиеГодаСотрудниковОтгуляно.Сотрудник
					   |			И УказателиРабочихЛет.ВидОтпуска = РабочиеГодаСотрудниковОтгуляно.ВидОтпуска
					   |			И УказателиРабочихЛет.РабочийГодДатаНачала = РабочиеГодаСотрудниковОтгуляно.ДатаНачала
					   |
					   |;
		               |////////////////////////////////////////////////////////////////////////////////
		               |ВЫБРАТЬ
		               |	НарастающиеОстаткиПоРабочимГодам.Сотрудник КАК Сотрудник,
		               |	НарастающиеОстаткиПоРабочимГодам.ВидОтпуска КАК ВидОтпуска,
		               |	НарастающиеОстаткиПоРабочимГодам.РабочийГодДатаНачала КАК ДатаНачала,
					   |	НарастающиеОстаткиПоРабочимГодам.НарастающийОстатокДнейОтгуляно КАК НарастающийОстатокДнейОтгуляно,
					   |	НарастающиеОстаткиПоРабочимГодам.ГодОстатков КАК ГодОстатков,
					   |	НарастающиеОстаткиПоРабочимГодам.ПоследнийГодОстатков КАК ПоследнийГодОстатков, 
		               |	ВЫБОР
		               |		КОГДА НарастающиеОстаткиПоРабочимГодам.НарастающийОстатокДнейОтгуляно < 0
		               |			ТОГДА НарастающиеОстаткиПоРабочимГодам.НарастающийОстатокДнейОтгуляно
		               |		ИНАЧЕ 0
		               |	КОНЕЦ КАК ПереходящийОстаток,
					   |	ВЫБОР 
					   |		КОГДА НарастающиеОстаткиПоРабочимГодам.ГодОстатков И НЕ НарастающиеОстаткиПоРабочимГодам.ПоследнийГодОстатков
					   |			И НарастающиеОстаткиПоРабочимГодам.НарастающийОстатокДнейОтгуляно <= 0
					   |       		ТОГДА ИСТИНА
		               |		КОГДА (НЕ НарастающиеОстаткиПоРабочимГодам.ГодОстатков И НарастающиеОстаткиПоРабочимГодам.НарастающийОстатокДнейОтгуляно <= 0)
					   |        ИЛИ (НарастающиеОстаткиПоРабочимГодам.ГодОстатков И НарастающиеОстаткиПоРабочимГодам.ПоследнийГодОстатков 
					   |			И НарастающиеОстаткиПоРабочимГодам.НарастающийОстатокДнейОтгуляно <= 0) 
		               |			ТОГДА ИСТИНА
					   |		ИНАЧЕ ЛОЖЬ 
		               |	КОНЕЦ КАК РабочийГодЗакрыт
		               |ПОМЕСТИТЬ ВТОстаткиПоРабочимГодам
		               |ИЗ
		               |	ВТНарастающиеОстаткиПоРабочимГодам КАК НарастающиеОстаткиПоРабочимГодам
		               |;
		               |
		               |////////////////////////////////////////////////////////////////////////////////
		               |ВЫБРАТЬ
		               |	ОстаткиПоРабочимГодам.Сотрудник КАК Сотрудник,
		               |	ОстаткиПоРабочимГодам.ВидОтпуска КАК ВидОтпуска,
		               |	ОстаткиПоРабочимГодам.ПереходящийОстаток КАК ПереходящийОстаток,
		               |	ОстаткиПоРабочимГодам.ДатаНачала КАК ДатаНачала
		               |ПОМЕСТИТЬ ВТЗакрытыеГода
		               |ИЗ
		               |	ВТОстаткиПоРабочимГодам КАК ОстаткиПоРабочимГодам
		               |ГДЕ
		               |	ОстаткиПоРабочимГодам.РабочийГодЗакрыт
		               |;
		               |
		               |////////////////////////////////////////////////////////////////////////////////
		               |ВЫБРАТЬ
		               |	ЗакрытыеГода.Сотрудник КАК Сотрудник,
		               |	ЗакрытыеГода.ВидОтпуска КАК ВидОтпуска,
		               |	ЗакрытыеГода.ПереходящийОстаток КАК ПереходящийОстаток,
		               |	ВложенныйЗапрос.ДатаНачала КАК ДатаНачалаПоследнегоЗакрытого
		               |ПОМЕСТИТЬ ВТПоследнийЗакрытыйГод
		               |ИЗ
		               |	ВТЗакрытыеГода КАК ЗакрытыеГода
		               |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
		               |			МАКСИМУМ(ЗакрытыеГода.ДатаНачала) КАК ДатаНачала,
		               |			ЗакрытыеГода.Сотрудник КАК Сотрудник,
		               |			ЗакрытыеГода.ВидОтпуска КАК ВидОтпуска
		               |		ИЗ
		               |			ВТЗакрытыеГода КАК ЗакрытыеГода
		               |		
		               |		СГРУППИРОВАТЬ ПО
		               |			ЗакрытыеГода.Сотрудник,
		               |			ЗакрытыеГода.ВидОтпуска) КАК ВложенныйЗапрос
		               |		ПО ЗакрытыеГода.Сотрудник = ВложенныйЗапрос.Сотрудник
		               |			И ЗакрытыеГода.ВидОтпуска = ВложенныйЗапрос.ВидОтпуска
		               |			И ЗакрытыеГода.ДатаНачала = ВложенныйЗапрос.ДатаНачала
		               |;
		               |
		               |////////////////////////////////////////////////////////////////////////////////
		               |ВЫБРАТЬ
		               |	ЗакрытыеРабочиеГода.Сотрудник КАК Сотрудник,
		               |	ЗакрытыеРабочиеГода.ВидОтпуска КАК ВидОтпуска,
		               |	КОЛИЧЕСТВО(ЗакрытыеРабочиеГода.ПереходящийОстаток) КАК КоличествоСтрок
		               |ПОМЕСТИТЬ ВТНаличиеОстатковПоЗакрытымГодам
		               |ИЗ
		               |	ВТПоследнийЗакрытыйГод КАК ЗакрытыеРабочиеГода
		               |
		               |СГРУППИРОВАТЬ ПО
		               |	ЗакрытыеРабочиеГода.Сотрудник,
		               |	ЗакрытыеРабочиеГода.ВидОтпуска
		               |;
		               |
		               |////////////////////////////////////////////////////////////////////////////////
		               |ВЫБРАТЬ
		               |	ОстаткиПоРабочимГодам.Сотрудник КАК Сотрудник,
		               |	ОстаткиПоРабочимГодам.ВидОтпуска КАК ВидОтпуска,
		               |	МИНИМУМ(ОстаткиПоРабочимГодам.ДатаНачала) КАК ДатаНачалаПервогоНезакрытого
		               |ПОМЕСТИТЬ ВТПервыйНезакрытыйГод
		               |ИЗ
		               |	ВТОстаткиПоРабочимГодам КАК ОстаткиПоРабочимГодам
		               |ГДЕ
		               |	НЕ ОстаткиПоРабочимГодам.РабочийГодЗакрыт
		               |
		               |СГРУППИРОВАТЬ ПО
		               |	ОстаткиПоРабочимГодам.Сотрудник,
		               |	ОстаткиПоРабочимГодам.ВидОтпуска
		               |;
		               |
		               |////////////////////////////////////////////////////////////////////////////////
		               |ВЫБРАТЬ
		               |	ПервыйНезакрытыйГод.Сотрудник КАК Сотрудник,
		               |	ПервыйНезакрытыйГод.ВидОтпуска КАК ВидОтпуска,
		               |	КОЛИЧЕСТВО(ПервыйНезакрытыйГод.ДатаНачалаПервогоНезакрытого) КАК КоличествоСтрок
		               |ПОМЕСТИТЬ ВТНаличиеОстатковПоНезакрытымГодам
		               |ИЗ
		               |	ВТПервыйНезакрытыйГод КАК ПервыйНезакрытыйГод
		               |
		               |СГРУППИРОВАТЬ ПО
		               |	ПервыйНезакрытыйГод.Сотрудник,
		               |	ПервыйНезакрытыйГод.ВидОтпуска
		               |;
		               |
		               |////////////////////////////////////////////////////////////////////////////////
		               |ВЫБРАТЬ
		               |	ЗаработанныеОтпуска.Сотрудник КАК Сотрудник,
		               |	ЗаработанныеОтпуска.ВидЕжегодногоОтпуска КАК ВидОтпуска,
		               |	ЗаработанныеОтпуска.ДатаНачала КАК РабочийГодДатаНачала,
		               |	ЗаработанныеОтпуска.ДатаОкончания КАК РабочийГодДатаОкончания,
		               |	ВЫБОР
		               |		КОГДА ЕСТЬNULL(НаличиеОстатковПоЗакрытымГодам.КоличествоСтрок, 0) = 0
		               |			ТОГДА ВЫБОР
		               |					КОГДА ЕСТЬNULL(ПервыйНезакрытыйГод.ДатаНачалаПервогоНезакрытого, ДАТАВРЕМЯ(1, 1, 1)) = ЗаработанныеОтпуска.ДатаНачала
		               |						ТОГДА ЗаработанныеОтпуска.Дней - ЕСТЬNULL(УчитываемыеОтпускаСотрудников.Отгуляно, 0)
		               |					ИНАЧЕ ЗаработанныеОтпуска.Дней
		               |				КОНЕЦ
		               |		КОГДА ЕСТЬNULL(НаличиеОстатковПоНезакрытымГодам.КоличествоСтрок, 0) = 0
		               |			ТОГДА ВЫБОР
		               |					КОГДА НЕ ЕСТЬNULL(ПоследнийЗакрытыйГод.ДатаНачалаПоследнегоЗакрытого, ДАТАВРЕМЯ(1, 1, 1)) = ДАТАВРЕМЯ(1, 1, 1)
		               |						ТОГДА ЕСТЬNULL(ПоследнийЗакрытыйГод.ПереходящийОстаток, 0)
		               |					ИНАЧЕ 0
		               |				КОНЕЦ
		               |		ИНАЧЕ ВЫБОР
		               |				КОГДА ЕСТЬNULL(ПоследнийЗакрытыйГод.ДатаНачалаПоследнегоЗакрытого, ДАТАВРЕМЯ(1, 1, 1)) = ЗаработанныеОтпуска.ДатаНачала
		               |					ТОГДА 0
		               |				КОГДА ЕСТЬNULL(ПервыйНезакрытыйГод.ДатаНачалаПервогоНезакрытого, ДАТАВРЕМЯ(1, 1, 1)) = ЗаработанныеОтпуска.ДатаНачала
		               |					ТОГДА ЕСТЬNULL(ОстаткиПоРабочимГодам.НарастающийОстатокДнейОтгуляно, 0)
		               |				КОГДА ОстаткиПоРабочимГодам.РабочийГодЗакрыт
		               |					ТОГДА 0
		               |				ИНАЧЕ ЗаработанныеОтпуска.Дней
		               |			КОНЕЦ
		               |	КОНЕЦ КАК Дни,
		               |	ОстаткиПоРабочимГодам.РабочийГодЗакрыт КАК РабочийГодЗакрыт
		               |ИЗ
		               |	ВТЗаработанныеОтпускаПоГодам КАК ЗаработанныеОтпуска
		               |		ЛЕВОЕ СОЕДИНЕНИЕ ВТНаличиеОстатковПоЗакрытымГодам КАК НаличиеОстатковПоЗакрытымГодам
		               |		ПО ЗаработанныеОтпуска.Сотрудник = НаличиеОстатковПоЗакрытымГодам.Сотрудник
		               |			И ЗаработанныеОтпуска.ВидЕжегодногоОтпуска = НаличиеОстатковПоЗакрытымГодам.ВидОтпуска
		               |		ЛЕВОЕ СОЕДИНЕНИЕ ВТНаличиеОстатковПоНезакрытымГодам КАК НаличиеОстатковПоНезакрытымГодам
		               |		ПО ЗаработанныеОтпуска.Сотрудник = НаличиеОстатковПоНезакрытымГодам.Сотрудник
		               |			И ЗаработанныеОтпуска.ВидЕжегодногоОтпуска = НаличиеОстатковПоНезакрытымГодам.ВидОтпуска
		               |		ЛЕВОЕ СОЕДИНЕНИЕ ВТПервыйНезакрытыйГод КАК ПервыйНезакрытыйГод
		               |		ПО ЗаработанныеОтпуска.Сотрудник = ПервыйНезакрытыйГод.Сотрудник
		               |			И ЗаработанныеОтпуска.ВидЕжегодногоОтпуска = ПервыйНезакрытыйГод.ВидОтпуска
		               |			И ЗаработанныеОтпуска.ДатаНачала = ПервыйНезакрытыйГод.ДатаНачалаПервогоНезакрытого
		               |		ЛЕВОЕ СОЕДИНЕНИЕ ВТПоследнийЗакрытыйГод КАК ПоследнийЗакрытыйГод
		               |		ПО ЗаработанныеОтпуска.Сотрудник = ПоследнийЗакрытыйГод.Сотрудник
		               |			И ЗаработанныеОтпуска.ВидЕжегодногоОтпуска = ПоследнийЗакрытыйГод.ВидОтпуска
		               |			И ЗаработанныеОтпуска.ДатаНачала = ПоследнийЗакрытыйГод.ДатаНачалаПоследнегоЗакрытого
		               |		ЛЕВОЕ СОЕДИНЕНИЕ ВТОстаткиПоРабочимГодам КАК ОстаткиПоРабочимГодам
		               |		ПО ЗаработанныеОтпуска.Сотрудник = ОстаткиПоРабочимГодам.Сотрудник
		               |			И ЗаработанныеОтпуска.ВидЕжегодногоОтпуска = ОстаткиПоРабочимГодам.ВидОтпуска
		               |			И ЗаработанныеОтпуска.ДатаНачала = ОстаткиПоРабочимГодам.ДатаНачала
		               |		ЛЕВОЕ СОЕДИНЕНИЕ ВТУчитываемыеОтпускаСотрудников КАК УчитываемыеОтпускаСотрудников
		               |		ПО ЗаработанныеОтпуска.Сотрудник = УчитываемыеОтпускаСотрудников.Сотрудник
		               |			И ЗаработанныеОтпуска.ВидЕжегодногоОтпуска = УчитываемыеОтпускаСотрудников.ВидЕжегодногоОтпуска
	               	   |УПОРЯДОЧИТЬ ПО
		               |	Сотрудник,
		               |	ВидОтпуска УБЫВ,
		               |	РабочийГодДатаНачала,
		               |	РабочийГодДатаОкончания";                                   
		
		ТаблицаОстатков = Запрос.Выполнить().Выгрузить();     
		
		ВнешнийНаборДанных = Новый Структура("ТаблицаОстатков", ТаблицаОстатков);   
		
	КонецЕсли;
	СтандартнаяОбработка = ложь;
	
	ДокументРезультат.Очистить();
	
	КомпоновщикМакета = Новый КомпоновщикМакетаКомпоновкиДанных;     
	
	МакетКомпоновки = КомпоновщикМакета.Выполнить(ЭтотОбъект.СхемаКомпоновкиДанных, НастройкиОтчета, ДанныеРасшифровки);
	
	// Создадим и инициализируем процессор компоновки.
	ПроцессорКомпоновки = Новый ПроцессорКомпоновкиДанных;       
	
	Если КадровыйУчетРасширенный.НастройкиКадровогоУчета().РассчитыватьОстатокОтпускаПоКалендарнымДням Тогда
		ПроцессорКомпоновки.Инициализировать(МакетКомпоновки, ВнешнийНаборДанных, ДанныеРасшифровки, Истина);
	Иначе
		ПроцессорКомпоновки.Инициализировать(МакетКомпоновки, , ДанныеРасшифровки, Истина);
	КонецЕсли;
	
	ПроцессорВывода = Новый ПроцессорВыводаРезультатаКомпоновкиДанныхВТабличныйДокумент;
	ПроцессорВывода.УстановитьДокумент(ДокументРезультат);
	
	// Обозначим начало вывода.
	ПроцессорВывода.Вывести(ПроцессорКомпоновки, Истина);
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

Процедура ДобавитьСтрокиВТаблицу(Приемник, Источник) 

	Для каждого СтрокаИсточника Из Источник Цикл
		НоваяСтрока = Приемник.Добавить();
		ЗаполнитьЗначенияСвойств(НоваяСтрока, СтрокаИсточника);
	КонецЦикла;

КонецПроцедуры  

Процедура ИнициализироватьОтчет() Экспорт

	Если КадровыйУчетРасширенный.НастройкиКадровогоУчета().РассчитыватьОстатокОтпускаПоКалендарнымДням Тогда
		СхемаКомпоновкиДанных = ПолучитьМакет("СхемаКомпоновкиДанныхПоКалендарнымДням")
	Иначе
		СхемаКомпоновкиДанных = ПолучитьМакет("ОсновнаяСхемаКомпоновкиДанных")  
	КонецЕсли;	
    ЭтотОбъект.СхемаКомпоновкиДанных = СхемаКомпоновкиДанных; 
	ЗарплатаКадрыОбщиеНаборыДанных.ЗаполнитьОбщиеИсточникиДанныхОтчета(ЭтотОбъект);
	
КонецПроцедуры

// Для общей формы "Форма отчета" подсистемы "Варианты отчетов".
Процедура ОпределитьНастройкиФормы(Форма, КлючВарианта, Настройки) Экспорт
	
	Настройки.События.ПриСозданииНаСервере = Истина;
	
КонецПроцедуры

// Вызывается в обработчике одноименного события формы отчета после выполнения кода формы.
//
// Параметры:
//   Форма - УправляемаяФорма - Форма отчета.
//   Отказ - Передается из параметров обработчика "как есть".
//   СтандартнаяОбработка - Передается из параметров обработчика "как есть".
//
// См. также:
//   "УправляемаяФорма.ПриСозданииНаСервере" в синтакс-помощнике.
//
Процедура ПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка) Экспорт
	
	ИнициализироватьОтчет();  
	ЗначениеВДанныеФормы(ЭтотОбъект, Форма.Отчет);
	
КонецПроцедуры

#КонецОбласти

#КонецЕсли