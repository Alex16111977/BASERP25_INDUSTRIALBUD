#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область СлужебныйПрограммныйИнтерфейс

// Настройки общей формы отчета подсистемы "Варианты отчетов".
//
// Параметры:
//   Форма - ФормаКлиентскогоПриложения - Форма отчета.
//   КлючВарианта - Строка - Имя предопределенного варианта отчета или уникальный идентификатор пользовательского.
//   Настройки - Структура - см. возвращаемое значение ОтчетыКлиентСервер.ПолучитьНастройкиОтчетаПоУмолчанию().
//
Процедура ОпределитьНастройкиФормы(Форма, КлючВарианта, Настройки) Экспорт
	Настройки.События.ПриСозданииНаСервере = Истина;
КонецПроцедуры

// Вызывается в обработчике одноименного события формы отчета после выполнения кода формы.
//
// Параметры:
//   ЭтаФорма - ФормаКлиентскогоПриложения - Форма отчета.
//   Отказ - Булево - Передается из параметров обработчика "как есть".
//   СтандартнаяОбработка - Булево - Передается из параметров обработчика "как есть".
//
// См. также:
//   "ФормаКлиентскогоПриложения.ПриСозданииНаСервере" в синтакс-помощнике.
//
Процедура ПриСозданииНаСервере(ЭтаФорма, Отказ, СтандартнаяОбработка) Экспорт
	
	КомпоновщикНастроекФормы = ЭтаФорма.Отчет.КомпоновщикНастроек;
	Параметры = ЭтаФорма.Параметры;
	
	Если Параметры.Свойство("ПараметрКоманды") Тогда
		
		ЭтаФорма.ФормаПараметры.Отбор = Новый Структура("НалоговыйДокумент", Параметры.ПараметрКоманды);
		
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиСобытий

Процедура ПриКомпоновкеРезультата(ДокументРезультат, ДанныеРасшифровки, СтандартнаяОбработка)
	
	//Параметр доступный для редактирования пользователем
	ПараметрНалоговыйДокумент = КомпоновщикНастроек.Настройки.ПараметрыДанных.НайтиЗначениеПараметра(Новый ПараметрКомпоновкиДанных("НалоговыйДокумент"));
	//Параметр, который определяется по параметру НалоговыйДокумент и устанавливается программно
	ПараметрНалоговаяНакладная = КомпоновщикНастроек.Настройки.ПараметрыДанных.НайтиЗначениеПараметра(Новый ПараметрКомпоновкиДанных("НалоговаяНакладная"));
	
	Если ПараметрНалоговыйДокумент <> Неопределено Тогда
		
		НалоговыйДокумент = Неопределено;
		
		Если Не ЗначениеЗаполнено(ПараметрНалоговыйДокумент.Значение) Тогда
			//Проверим в пользовательских настройках
			ПараметрПользовательскойНастройки = КомпоновщикНастроек.ПользовательскиеНастройки.Элементы.Найти(ПараметрНалоговыйДокумент.ИдентификаторПользовательскойНастройки);
			
			Если ПараметрПользовательскойНастройки <> Неопределено И ЗначениеЗаполнено(ПараметрПользовательскойНастройки.Значение) Тогда
				НалоговыйДокумент = ПараметрПользовательскойНастройки.Значение;
			КонецЕсли;
			
		Иначе
			НалоговыйДокумент = ПараметрНалоговыйДокумент.Значение;	
		КонецЕсли;
			
		Если ЗначениеЗаполнено(НалоговыйДокумент) И ПараметрНалоговаяНакладная <> Неопределено Тогда
	
			НалоговаяНакладная = Неопределено;
			Если ТипЗнч(НалоговыйДокумент) = Тип("ДокументСсылка.Приложение2КНалоговойНакладной") Тогда
				НалоговаяНакладная = ОбщегоНазначения.ЗначениеРеквизитаОбъекта(НалоговыйДокумент, "НалоговаяНакладная");
				Если Не ЗначениеЗаполнено(НалоговаяНакладная) Тогда
					ТекстСообщения = НСтр("ru='В сохраненном документе ""%1"" не заполнен реквизит ""Налоговая накладная""';uk='У збереженому документі ""%1"" не заповнений реквізит ""Податкова накладна""'");
					ВызватьИсключение СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, НалоговыйДокумент);
				КонецЕсли;
		 	Иначе
				НалоговаяНакладная = НалоговыйДокумент;
			КонецЕсли;
			
			ПараметрНалоговаяНакладная.Значение = НалоговаяНакладная;
			ПараметрНалоговаяНакладная.Использование = Истина;
		КонецЕсли;	
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#КонецЕсли