#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

// СтандартныеПодсистемы.УправлениеДоступом

// См. УправлениеДоступомПереопределяемый.ПриЗаполненииСписковСОграничениемДоступа.
Процедура ПриЗаполненииОграниченияДоступа(Ограничение) Экспорт
	Ограничение.Текст =
	"РазрешитьЧтениеИзменение
	|ГДЕ
	|	ДляВсехСтрок( ЗначениеРазрешено(ФизическиеЛица.ФизическоеЛицо, NULL КАК ИСТИНА)
	|	) И ЗначениеРазрешено(Организация)";
КонецПроцедуры

// Конец СтандартныеПодсистемы.УправлениеДоступом

// Возвращает описание состава документа
//
// Возвращаемое значение:
//  Структура - см. ЗарплатаКадрыСоставДокументов.НовоеОписаниеСоставаОбъекта.
Функция ОписаниеСоставаОбъекта() Экспорт
	
	МетаданныеДокумента = Метаданные.Документы.НачислениеОценочныхОбязательствПоОтпускам;
	Возврат ЗарплатаКадрыСоставДокументов.ОписаниеСоставаОбъектаПоМетаданнымФизическиеЛицаВТабличныхЧастях(МетаданныеДокумента);
	
КонецФункции

#Область ПрограммныйИнтерфейс

// ERP Резервы отпусков 3286

#Область Проведение

Функция ДополнительныеИсточникиДанныхДляДвижений(ИмяРегистра) Экспорт

	ИсточникиДанных = Новый Соответствие;

	Возврат ИсточникиДанных; 

КонецФункции

// Описывает учетные механизмы используемые в документе для регистрации в механизме проведения.
//
// Параметры:
//  МеханизмыДокумента - Массив - список имен учетных механизмов, для которых будет выполнена
//              регистрация в механизме проведения.
//
Процедура ЗарегистрироватьУчетныеМеханизмы(МеханизмыДокумента) Экспорт
	
	//++ НЕ УТКА
	МеханизмыДокумента.Добавить("МеждународныйУчет");
	//-- НЕ УТКА
	МеханизмыДокумента.Добавить("ОборотныеРегистрыУправленческогоУчета");
	МеханизмыДокумента.Добавить("ОтражениеЗарплатыВФинансовомУчете");
	МеханизмыДокумента.Добавить("РегламентированныйУчет");
	МеханизмыДокумента.Добавить("СебестоимостьИПартионныйУчет");
	МеханизмыДокумента.Добавить("УчетДоходовРасходов");
	МеханизмыДокумента.Добавить("УчетНЗП");
	МеханизмыДокумента.Добавить("УчетПрочихАктивовПассивов");
	
КонецПроцедуры

// Возвращает таблицы для движений, необходимые для проведения документа по регистрам учетных механизмов.
//
// Параметры:
//  Документ - ДокументСсылка - ссылка на документ, по которому необходимо получить данные
//  Регистры - Структура - список имен регистров, для которых необходимо получить таблицы
//  ДопПараметры - Структура - дополнительные параметры для получения данных, определяющие контекст проведения.
//
// Возвращаемое значение:
//  Структура - коллекция элементов:
//     * Таблица<ИмяРегистра> - ТаблицаЗначений - таблица данных для отражения в регистр.
//
Функция ДанныеДокументаДляПроведения(Документ, Регистры, ДопПараметры = Неопределено) Экспорт
	
	Если ДопПараметры = Неопределено Тогда
		ДопПараметры = ПроведениеДокументов.ДопПараметрыИнициализироватьДанныеДокументаДляПроведения();
	КонецЕсли;
	
	Запрос			= Новый Запрос;
	ТекстыЗапроса	= Новый СписокЗначений;
	
	Если Не ДопПараметры.ПолучитьТекстыЗапроса Тогда
		////////////////////////////////////////////////////////////////////////////
		// Создадим запрос инициализации движений
		
		ЗаполнитьПараметрыИнициализации(Запрос, Документ);
		
		////////////////////////////////////////////////////////////////////////////
		// Сформируем текст запроса
		
		ТекстЗапросаТаблицаПрочиеРасходы(ТекстыЗапроса, Регистры);
		ТекстЗапросаТаблицаПартииПрочихРасходов(ТекстыЗапроса, Регистры);
		ТекстЗапросаПрочиеАктивыПассивы(Запрос, ТекстыЗапроса, Регистры);
		ТекстЗапросаДвиженияДоходыРасходыПрочиеАктивыПассивы(ТекстыЗапроса, Регистры);
		ТекстЗапросаТаблицаПорядокОтраженияПрочихОпераций(ТекстыЗапроса, Регистры);
		ТекстЗапросаТаблицаОтражениеДокументовВРеглУчете(ТекстыЗапроса, Регистры);
		ТекстЗапросаТаблицаТрудозатратыНезавершенногоПроизводства(Запрос, ТекстыЗапроса, Регистры);
		ТекстЗапросаТаблицаОтражениеЗарплатыВФинансовомУчете(Запрос, ТекстыЗапроса, Регистры);
	КонецЕсли;
	
	////////////////////////////////////////////////////////////////////////////
	// Получим таблицы для движений
	
	Возврат ПроведениеДокументов.ИнициализироватьДанныеДокументаДляПроведения(Запрос, ТекстыЗапроса, ДопПараметры);
	
КонецФункции

#КонецОбласти

#Область ПроводкиРегУчета

// Возвращает текст запроса для отражения в регл. учете.
//
// Возвращаемое значение:
//   Строка - текст отражения в регл. учете
//
Функция ТекстОтраженияВРеглУчете() Экспорт
	
	Возврат ТекстОтраженияВРеглУчетеУКР();
	
КонецФункции

// Функция возвращает текст запроса дополнительных временных таблиц,
// необходимых для отражения в регламетированном учете
//
// Возвращаемое значение:
//   Строка - текст построения временной таблицы для отражения в регл. учете
//
Функция ТекстЗапросаВТОтраженияВРеглУчете() Экспорт
	
	Возврат ТекстЗапросаВТОтраженияВРеглУчетеУКР();
	
КонецФункции

// Возвращает текст запроса для отражения в регл. учете.
//
// Возвращаемое значение:
//   Строка - текст отражения в регл. учете
//
Функция ТекстОтраженияВРеглУчетеУКР() Экспорт

	ЯзыкСодержания = МультиязычностьУкр.КодЯзыкаИнформационнойБазы();
	
	#Область ТекстНачислениеОценочныхОбязательств
	ТекстНачислениеОценочныхОбязательств = "
	// на расходы (Дт <счет затрат> :: Кт 471)
	|ВЫБРАТЬ 
	|
	|	Операция.Ссылка КАК Ссылка,
	|	КОНЕЦПЕРИОДА(Операция.ПериодРегистрации, МЕСЯЦ) КАК Период,
	|	Операция.Организация КАК Организация,
	|	"""" КАК ИдентификаторСтроки,
	|
	|	Строки.Сумма КАК Сумма,
	|	Строки.СуммаУУ КАК СуммаУУ,

	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.Расходы) КАК ВидСчетаДт,
	|	Строки.СтатьяРасходов КАК АналитикаУчетаДт,
	|	Строки.Подразделение КАК МестоУчетаДт,
	|	
	|	НЕОПРЕДЕЛЕНО КАК ВалютаДт,
	|	Строки.Подразделение КАК ПодразделениеДт,
	|	Строки.НаправлениеДеятельности КАК НаправлениеДеятельностиДт,
	|	НЕОПРЕДЕЛЕНО КАК НалоговоеНазначениеДт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетДт,
	|	ЗНАЧЕНИЕ(Перечисление.ТипыЗатратРегл.Прочее) КАК СубконтоДт1,
	|	Строки.СтатьяРасходов КАК СубконтоДт2,
	|	Строки.АналитикаРасходов КАК СубконтоДт3,

	|
	|	0 КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|	0 КАК СуммаНУДт,
	|	0 КАК СуммаПРДт,
	|	0 КАК СуммаВРДт,
	
	|	НЕОПРЕДЕЛЕНО КАК ВидСчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаКт,
	|
	|	&ВалютаРеглУчета ВалютаКт,
	|	НЕОПРЕДЕЛЕНО КАК ПодразделениеКт,
	|	ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка) КАК НаправлениеДеятельностиКт,
	|	НЕОПРЕДЕЛЕНО КАК НалоговоеНазначениеКт,
	|
	|	Строки.СчетКт КАК СчетКт,
	|	ЗНАЧЕНИЕ(Справочник.Резервы.РезервЕжегодныхОтпусков) КАК СубконтоКт1,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|	
	|	Строки.Сумма КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|	0 КАК СуммаНУКт,
	|	0 КАК СуммаПРКт,
	|	0 КАК СуммаВРКт,
	|	""%1"" КАК Содержание
	|
	|ИЗ 
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.НачислениеОценочныхОбязательствПоОтпускам КАК Операция
	|	ПО
	|		ДокументыКОтражению.Ссылка = Операция.Ссылка
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		РасходыДокумента КАК Строки
	|	ПО
	|		ДокументыКОтражению.Ссылка = Строки.Ссылка
	|		ЛЕВОЕ СОЕДИНЕНИЕ ПланВидовХарактеристик.СтатьиРасходов КАК СтатьиРасходов
	|		ПО Строки.СтатьяРасходов = СтатьиРасходов.Ссылка
	|			И (СтатьиРасходов.ВариантРаспределенияРасходовРегл = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаПрочиеАктивы))
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ 
	|		Справочник.ОбъектыСтроительства КАК ОбъектыСтроительства
	|	ПО 
	|		ОбъектыСтроительства.Ссылка = Строки.АналитикаРасходов
	|ГДЕ 
	|	Строки.СтатьяРасходов ССЫЛКА ПланВидовХарактеристик.СтатьиРасходов
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	// на прочие пассивы (Дт <прочие> :: Кт 471)
	|ВЫБРАТЬ 
	|
	|	Операция.Ссылка КАК Ссылка,
	|	КОНЕЦПЕРИОДА(Операция.ПериодРегистрации, МЕСЯЦ) КАК Период,
	|	Операция.Организация КАК Организация,
	|	"""" КАК ИдентификаторСтроки,
	|
	|	Строки.Сумма КАК Сумма,
	|	Строки.СуммаУУ КАК СуммаУУ,

	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.ПрочиеАктивыПассивы) КАК ВидСчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаДт,
	|	
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаДт,
	|	Строки.Подразделение КАК ПодразделениеДт,
	|	Строки.НаправлениеДеятельности КАК НаправлениеДеятельностиДт,
	|	НЕОПРЕДЕЛЕНО КАК НалоговоеНазначениеДт,
	|	
	|	Строки.СчетУчета КАК СчетДт,
	|	Строки.Субконто1 КАК СубконтоДт1,
	|	Строки.Субконто2 КАК СубконтоДт2,
	|	Строки.Субконто3 КАК СубконтоДт3,
	|
	|	0 КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|	0 КАК СуммаНУДт,
	|	0 КАК СуммаПРДт,
	|	0 КАК СуммаВРДт,
	
	
	|	НЕОПРЕДЕЛЕНО КАК ВидСчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаКт,
	|
	|	&ВалютаРеглУчета ВалютаКт,
	|	НЕОПРЕДЕЛЕНО КАК ПодразделениеКт,
	|	ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка) КАК НаправлениеДеятельностиКт,
	|	НЕОПРЕДЕЛЕНО КАК НалоговоеНазначениеКт,
	|
	|	Строки.СчетКт КАК СчетКт,
	|	ЗНАЧЕНИЕ(Справочник.Резервы.РезервЕжегодныхОтпусков) КАК СубконтоКт1,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|	
	|	Строки.Сумма КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|	0 КАК СуммаНУКт,
	|	0 КАК СуммаПРКт,
	|	0 КАК СуммаВРКт,
	|	""%2"" КАК Содержание
	|
	|ИЗ 
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		Документ.НачислениеОценочныхОбязательствПоОтпускам КАК Операция
	|	ПО
	|		ДокументыКОтражению.Ссылка = Операция.Ссылка
	|	
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		РасходыДокумента КАК Строки
	|	ПО
	|		ДокументыКОтражению.Ссылка = Строки.Ссылка
	|
	|ГДЕ
	|	Строки.СтатьяРасходов ССЫЛКА ПланВидовХарактеристик.СтатьиАктивовПассивов
	|";

	ТекстНачислениеОценочныхОбязательств = СтрШаблон(ТекстНачислениеОценочныхОбязательств, 
		НСтр("ru='Начисление оценочных обязательств по отпускам на расходы';uk='Нарахування оціночних зобов''язань щодо відпусток на витрати'",ЯзыкСодержания),
		НСтр("ru='Начисление оценочных обязательств по отпускам на пассивы';uk='Нарахування оціночних зобов''язань щодо відпусток на пасиви'",ЯзыкСодержания));
	
	#КонецОбласти
	
	#Область ТекстЗапросаНачисленоСдельно
	ТекстЗапросаНачисленоСдельно = "
	// прямые производственные
	|ВЫБРАТЬ
	|	Строки.Регистратор КАК Ссылка,
	|	КОНЕЦПЕРИОДА(Строки.Период, МЕСЯЦ) КАК Период,
	|	Строки.Организация КАК Организация,
	|	"""" КАК ИдентификаторСтроки,
	|
	|	Сумма(Строки.СуммаРегл) КАК Сумма,
	|	Сумма(Строки.СуммаРегл / КурсВалютыУпрУчета.Курс) КАК СуммаУУ,
	|
	|	ЗНАЧЕНИЕ(Перечисление.ВидыСчетовРеглУчета.Производство) КАК ВидСчетаДт,
	|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаДт,
	|	Строки.Подразделение КАК МестоУчетаДт,
	|
	|	ЗНАЧЕНИЕ(Справочник.Валюты.ПустаяСсылка) КАК ВалютаДт,
	|	Строки.Подразделение КАК ПодразделениеДт,
	|	Строки.НаправлениеДеятельности КАК НаправлениеДеятельностиДт,
	|	НЕОПРЕДЕЛЕНО КАК НалоговоеНазначениеДт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПустаяСсылка) КАК СчетДт,
	|	Строки.ВидРабот КАК СубконтоДт1,
	|	ЗНАЧЕНИЕ(Перечисление.ТипыЗатратРегл.СдельнаяОплатаТруда) КАК СубконтоДт2,
	|	Строки.ГруппаПродукции КАК СубконтоДт3,
	|
	|	0 КАК ВалютнаяСуммаДт,
	|	0 КАК КоличествоДт,
	|	0 КАК СуммаНУДт,
	|	0 КАК СуммаПРДт,
	|	0 КАК СуммаВРДт,
	
	|
	|	НЕОПРЕДЕЛЕНО КАК ВидСчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаКт,
	|	НЕОПРЕДЕЛЕНО КАК МестоУчетаКт,
	|
	|	&ВалютаРеглУчета КАК ВалютаКт,
	|	Строки.Подразделение КАК ПодразделениеКт,
	|	ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка) КАК НаправлениеДеятельностиКт,
	|	НЕОПРЕДЕЛЕНО КАК НалоговоеНазначениеКт,
	|
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ОбеспечениеВыплатОтпусков) КАК СчетКт,
	|	ЗНАЧЕНИЕ(Справочник.Резервы.РезервЕжегодныхОтпусков) КАК СубконтоКт1,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт2,
	|	НЕОПРЕДЕЛЕНО КАК СубконтоКт3,
	|
	|	Сумма(Строки.СуммаРегл) КАК ВалютнаяСуммаКт,
	|	0 КАК КоличествоКт,
	|	0 КАК СуммаНУКт,
	|	0 КАК СуммаПРКт,
	|	0 КАК СуммаВРКт,
	|	""%1"" КАК Содержание
	|ИЗ
	|	ДокументыКОтражению КАК ДокументыКОтражению
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ
	|		РегистрНакопления.ОтражениеЗарплатыВФинансовомУчете КАК Строки
	|	ПО
	|		ДокументыКОтражению.Ссылка = Строки.Регистратор
	|	
	|
	|	ЛЕВОЕ СОЕДИНЕНИЕ
	|		КурсыВалют КАК КурсВалютыУпрУчета
	|	ПО
	|		КурсВалютыУпрУчета.Валюта = &ВалютаУпрУчета
	|		И КурсВалютыУпрУчета.Дата = НАЧАЛОПЕРИОДА(КОНЕЦПЕРИОДА(Строки.Период, МЕСЯЦ), День)
	|
	|СГРУППИРОВАТЬ ПО
	|	Строки.Регистратор,
	|	КОНЕЦПЕРИОДА(Строки.Период, МЕСЯЦ),
	|	Строки.Организация,
	|	Строки.Подразделение,
	|	Строки.НаправлениеДеятельности,
	|	Строки.ВидРабот,
	|	Строки.ГруппаПродукции
	|";

	ТекстЗапросаНачисленоСдельно = СтрШаблон(ТекстЗапросаНачисленоСдельно, 
		НСтр("ru='Распределение оценочных обязательств по выработке';uk='Розподіл оціночних зобов''язань по виробітку'",ЯзыкСодержания));

	#КонецОбласти

	ТекстыОтражения = Новый Массив;
	ТекстыОтражения.Добавить(ТекстНачислениеОценочныхОбязательств);
	ТекстыОтражения.Добавить(ТекстЗапросаНачисленоСдельно);
	
	Возврат СтрСоединить(ТекстыОтражения, ОбщегоНазначенияУТ.РазделительЗапросовВОбъединении());
	
КонецФункции

// Функция возвращает текст запроса дополнительных временных таблиц,
// необходимых для отражения в регламетированном учете
//
// Возвращаемое значение:
//   Строка - текст построения временной таблицы для отражения в регл. учете
//
Функция ТекстЗапросаВТОтраженияВРеглУчетеУКР() Экспорт
	
	ТекстЗапросаТаблицаРасходыДокумента = 
	"ВЫБРАТЬ
	|	ВТРасходыДокумента.СтатьяРасходов,
	|	ВТРасходыДокумента.НаправлениеДеятельности,
	|	ВТРасходыДокумента.ВариантРаспределения,
	|	ВТРасходыДокумента.АналитикаРасходов,
	|	ВТРасходыДокумента.АналитикаАктивовПассивов,
	|	ВТРасходыДокумента.СчетУчета,
	|	ВТРасходыДокумента.Субконто1,
	|	ВТРасходыДокумента.Субконто2,
	|	ВТРасходыДокумента.Субконто3,
	|	ВТРасходыДокумента.СчетКт,
	|	СУММА(ВТРасходыДокумента.СуммаРегл) КАК Сумма,
	|	СУММА(ВЫРАЗИТЬ(ВТРасходыДокумента.СуммаРегл / КурсВалютыУпрУчета.Курс КАК ЧИСЛО(15, 2))) КАК СуммаУУ,
	|	СУММА(ВТРасходыДокумента.СуммаНУ) КАК СуммаНУ,
	|	МАКСИМУМ(ВТРасходыДокумента.НомерСтроки) КАК НомерСтроки,
	|	ВТРасходыДокумента.Подразделение,
	|	ВТРасходыДокумента.СтатьяАктивовПассивов,
	|	ВТРасходыДокумента.Ссылка
	|ПОМЕСТИТЬ РасходыДокумента
	|ИЗ
	|	ВТРасходыДокументаРегл КАК ВТРасходыДокумента
	|	ЛЕВОЕ СОЕДИНЕНИЕ КурсыВалют КАК КурсВалютыУпрУчета
	|	ПО КурсВалютыУпрУчета.Валюта = &ВалютаУпрУчета
	|		И КурсВалютыУпрУчета.Дата = НАЧАЛОПЕРИОДА(ВТРасходыДокумента.ПериодРегистрации, День)
	|
	|СГРУППИРОВАТЬ ПО
	|	ВТРасходыДокумента.Ссылка,
	|	ВТРасходыДокумента.СчетКт,
	|	ВТРасходыДокумента.Подразделение,
	|	ВТРасходыДокумента.СтатьяАктивовПассивов,
	|	ВТРасходыДокумента.СтатьяРасходов,
	|	ВТРасходыДокумента.НаправлениеДеятельности,
	|	ВТРасходыДокумента.ВариантРаспределения,
	|	ВТРасходыДокумента.АналитикаРасходов,
	|	ВТРасходыДокумента.АналитикаАктивовПассивов,
	|	ВТРасходыДокумента.СчетУчета,
	|	ВТРасходыДокумента.Субконто1,
	|	ВТРасходыДокумента.Субконто2,
	|	ВТРасходыДокумента.Субконто3
	|
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|";
	
	ТекстыСозданияВременныхТаблиц = Новый Массив;
	ТекстыСозданияВременныхТаблиц.Добавить(ТекстЗапросаВтСписокСпособовОтражения());
	ТекстыСозданияВременныхТаблиц.Добавить(Справочники.СпособыОтраженияЗарплатыВБухУчете.ТекстЗапросаДанныхСпособов("ВТСпособыОтражения"));
	ТекстыСозданияВременныхТаблиц.Добавить(ТекстЗапросаТаблицаВТРасходыДокументаРегл());
	ТекстыСозданияВременныхТаблиц.Добавить(ТекстЗапросаТаблицаРасходыДокумента);
	
	ТекстЗапросаСозданияВременныхТаблиц = СтрСоединить(ТекстыСозданияВременныхТаблиц, ОбщегоНазначенияУТ.РазделительЗапросовВПакете());
	ТекстЗапросаСозданияВременныхТаблиц = СтрЗаменить(ТекстЗапросаСозданияВременныхТаблиц, "&КоэффициентПересчетаВВалютуУпр", "1");
	
	Возврат ТекстЗапросаСозданияВременныхТаблиц;
	
КонецФункции

#КонецОбласти

// Конец ERP


#КонецОбласти
	
#Область СлужебныеПроцедурыИФункции

// ERP Резервы отпусков 3286

#Область Проведение

Процедура ЗаполнитьПараметрыИнициализации(Запрос, ДокументСсылка)
	
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	Запрос.УстановитьПараметр("Ссылка", ДокументСсылка);
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ДанныеШапки.ПериодРегистрации КАК Период,
	|	ДанныеШапки.Организация КАК Организация,
	|	ДанныеШапки.КорректировкаОбязательств КАК КорректировкаОбязательств,
	|	ДанныеШапки.Проведен КАК Проведен,
	|	ДанныеШапки.Ссылка КАК Ссылка,
	|	МАКСИМУМ(ЕСТЬNULL(Сотрудники.НомерСтроки,0)) КАК КоличествоСотрудников
	|ИЗ
	|	Документ.НачислениеОценочныхОбязательствПоОтпускам КАК ДанныеШапки
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.НачислениеОценочныхОбязательствПоОтпускам.ОценочныеОбязательстваПоВознаграждениямРаботникам КАК Сотрудники
	|	    ПО ДанныеШапки.Ссылка = Сотрудники.Ссылка
	|ГДЕ
	|	ДанныеШапки.Ссылка = &Ссылка
	|
	|СГРУППИРОВАТЬ ПО
	|	ДанныеШапки.ПериодРегистрации,
	|	ДанныеШапки.Организация,
	|	ДанныеШапки.КорректировкаОбязательств,
	|	ДанныеШапки.Ссылка";
	
	Реквизиты = Запрос.Выполнить().Выбрать();
	Реквизиты.Следующий();
	
	ВалютаРегл = Константы.ВалютаРегламентированногоУчета.Получить();
	Коэффициенты = РаботаСКурсамивалютУТ.ПолучитьКоэффициентыПересчетаВалюты(
		ВалютаРегл, ВалютаРегл, КонецМесяца(Реквизиты.Период));
	
	Запрос.УстановитьПараметр("Период",                         КонецМесяца(Реквизиты.Период));
	Запрос.УстановитьПараметр("КорректировкаОбязательств",      Реквизиты.КорректировкаОбязательств);
	Запрос.УстановитьПараметр("Организация",                    Реквизиты.Организация);
	Запрос.УстановитьПараметр("Проведен",                       Реквизиты.Проведен);
	Запрос.УстановитьПараметр("ИспользоватьНачислениеЗарплаты", ПолучитьФункциональнуюОпцию("ИспользоватьНачислениеЗарплатыУТ"));
	Запрос.УстановитьПараметр("КоэффициентПересчетаВВалютуУпр", Коэффициенты.КоэффициентПересчетаВВалютуУПР);
	Запрос.УстановитьПараметр("ДатаНачала",                     НачалоМесяца(Реквизиты.Период));
	Запрос.УстановитьПараметр("ДатаОкончания",                  КонецМесяца(Реквизиты.Период));
	Запрос.УстановитьПараметр("Сводно",                         Реквизиты.КоличествоСотрудников = 0);
	Запрос.УстановитьПараметр("ПроводкиПоРаботникам",           Ложь);
	Запрос.УстановитьПараметр("ВалютаРегл",                     Константы.ВалютаРегламентированногоУчета.Получить());
	Запрос.УстановитьПараметр("НалоговоеНазначениеОрганизации",  Справочники.Организации.НалоговоеНазначениеНДС(Реквизиты.Организация, Реквизиты.Период));
	
	РасчетСебестоимостиПрикладныеАлгоритмы.ЗаполнитьПараметрыИнициализации(Запрос, Реквизиты);
	
КонецПроцедуры

Функция ТекстЗапросаТаблицаДокументовКОтражению(ТекстыЗапроса)
	
	ИмяРегистра = "ДокументыКОтражению";
	
	ТекстЗапроса =
	"ВЫБРАТЬ
	|	Документ.Ссылка КАК Ссылка
	|ПОМЕСТИТЬ ДокументыКОтражению
	|ИЗ
	|	Документ.НачислениеОценочныхОбязательствПоОтпускам КАК Документ
	|ГДЕ
	|	Документ.Ссылка = &Ссылка";
	
	ТекстыЗапроса.Добавить(ТекстЗапроса, ИмяРегистра);
	
	Возврат ТекстЗапроса;
	
КонецФункции

Функция ТекстЗапросаВтСписокСпособовОтражения(ТекстыЗапроса = Неопределено)
	
	ИмяРегистра = "ВтСписокСпособовОтражения";
	
	Если Не ПроведениеДокументов.ЕстьТаблицаЗапроса("ДокументыКОтражению", ТекстыЗапроса) Тогда
		ТекстЗапросаТаблицаДокументовКОтражению(ТекстыЗапроса);
	КонецЕсли;
	
	ТекстЗапроса =
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ОценочныеОбязательства.СпособОтраженияЗарплатыВБухучете КАК СпособОтражения
	|ПОМЕСТИТЬ ВтСписокСпособовОтражения
	|ИЗ
	|	Документ.НачислениеОценочныхОбязательствПоОтпускам.ОценочныеОбязательства КАК ОценочныеОбязательства
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДокументыКОтражению КАК ДокументыКОтражению
	|		ПО ОценочныеОбязательства.Ссылка = ДокументыКОтражению.Ссылка
	|";
	
	Если Не ТекстыЗапроса = Неопределено Тогда
		ТекстыЗапроса.Добавить(ТекстЗапроса, ИмяРегистра);
	КонецЕсли;
	
	Возврат ТекстЗапроса;
	
КонецФункции

Функция ТекстЗапросаВТСпособыОтражения(ТекстыЗапроса = Неопределено)
	
	ИмяРегистра = "ВТСпособыОтражения";
	
	Если Не ПроведениеДокументов.ЕстьТаблицаЗапроса("ВтСписокСпособовОтражения", ТекстыЗапроса) Тогда
		ТекстЗапросаВтСписокСпособовОтражения(ТекстыЗапроса);
	КонецЕсли;
	
	ТекстЗапроса = Справочники.СпособыОтраженияЗарплатыВБухУчете.ТекстЗапросаДанныхСпособов("ВТСпособыОтражения");
	
	Если Не ТекстыЗапроса = Неопределено Тогда
		ТекстыЗапроса.Добавить(ТекстЗапроса, ИмяРегистра);
	КонецЕсли;
	
	Возврат ТекстЗапроса;
	
КонецФункции

Функция ТекстЗапросаВтВыработкаСотрудников(Запрос, ТекстыЗапроса)
	
	ИмяРегистра = "ВтТаблицаВыработкаСотрудников";
	
	УстановитьПараметрЗапросаТаблицаВыработкаСотрудников(Запрос);
	
	ТекстЗапроса =
	"ВЫБРАТЬ
	|	ВыработкаСотрудников.Период,
	|	ВыработкаСотрудников.Организация,
	|	ВыработкаСотрудников.Подразделение,
	|	ВыработкаСотрудников.НаправлениеДеятельности,
	
	|	ВыработкаСотрудников.ПартияПроизводства,	
	|	ВыработкаСотрудников.ЗаказНаПроизводство,
	|	ВыработкаСотрудников.КодСтрокиПродукция,
	|	ВыработкаСотрудников.ВидРабот,
	|	ВыработкаСотрудников.ГруппаПродукции,
	|	ВыработкаСотрудников.Этап,
	
	|	ВыработкаСотрудников.ТипНалога,
	|	ВыработкаСотрудников.Налог,
	|	ВыработкаСотрудников.ВидОперацииПоЗарплате,
	
	|	ВыработкаСотрудников.СтатьяКалькуляции,
	|	ВыработкаСотрудников.СтатьяРасходов,
	|	ВыработкаСотрудников.АналитикаРасходов,
	|	ВыработкаСотрудников.АналитикаАктивовПассивов,
	|	ВыработкаСотрудников.СчетУчета,
	|	ВыработкаСотрудников.Субконто1,
	|	ВыработкаСотрудников.Субконто2,
	|	ВыработкаСотрудников.Субконто3,
	|	ВыработкаСотрудников.Сотрудник,
	
	|	ВыработкаСотрудников.Сумма,
	|	ВыработкаСотрудников.СуммаРегл
	
	|ПОМЕСТИТЬ ВтТаблицаВыработкаСотрудников
	|ИЗ
	|	&ТаблицаВыработкаСотрудников КАК ВыработкаСотрудников";

	
	ТекстыЗапроса.Добавить(ТекстЗапроса, ИмяРегистра);
	
	Возврат ТекстЗапроса;
	
КонецФункции

Процедура УстановитьПараметрЗапросаТаблицаВыработкаСотрудников(Запрос)
	
	Если Запрос.Параметры.Свойство("ТаблицаВыработкаСотрудников") Тогда
		Возврат;
	КонецЕсли;
	
	Запрос.УстановитьПараметр("ТаблицаВыработкаСотрудников", 
		ОтражениеЗарплатыВФинансовомУчетеУП.РаспределитьНачисленияПоЭтапамПроизводства(Запрос.Параметры));
	
КонецПроцедуры

Функция ТекстЗапросаТаблицаТрудозатратыНезавершенногоПроизводства(Запрос, ТекстыЗапроса, Регистры)
	
	ИмяРегистра = "ТрудозатратыНезавершенногоПроизводства";
	
	Если НЕ ПроведениеДокументов.ТребуетсяТаблицаДляДвижений(ИмяРегистра, Регистры) Тогда
		Возврат "";
	КонецЕсли;
	
	УстановитьПараметрЗапросаТаблицаВыработкаСотрудников(Запрос);
	
	Если НЕ ПроведениеДокументов.ЕстьТаблицаЗапроса("ВтТаблицаВыработкаСотрудников", ТекстыЗапроса) Тогда
		ТекстЗапросаВтВыработкаСотрудников(Запрос, ТекстыЗапроса);
	КонецЕсли;
	
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	&Период                                  КАК Период,
	|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)   КАК ВидДвижения,
	|	&Организация                             КАК Организация,
	|	ВыработкаСотрудников.Подразделение       КАК Подразделение,
	|	ВыработкаСотрудников.ПартияПроизводства  КАК ПартияПроизводства,
	|	ВыработкаСотрудников.ЗаказНаПроизводство КАК ЗаказНаПроизводство,
	|	ВыработкаСотрудников.КодСтрокиПродукция  КАК КодСтрокиПродукция,
	|	ВыработкаСотрудников.Этап                КАК Этап,
	|	ВыработкаСотрудников.СтатьяКалькуляции   КАК СтатьяКалькуляции,
	|	ВыработкаСотрудников.ВидРабот            КАК ВидРабот,
	|	ВыработкаСотрудников.ГруппаПродукции     КАК ГруппаПродукции,
	|	СУММА(ВыработкаСотрудников.Сумма)        КАК Стоимость,
	|	СУММА(ВыработкаСотрудников.СуммаРегл)    КАК СтоимостьРегл,
	|	0  КАК ВременнаяРазница,
	|	0 КАК ПостояннаяРазница
	|ИЗ
	|	ВтТаблицаВыработкаСотрудников КАК ВыработкаСотрудников
	|ГДЕ
	|	ВыработкаСотрудников.СтатьяРасходов = НЕОПРЕДЕЛЕНО
	|
	|СГРУППИРОВАТЬ ПО
	|	ВыработкаСотрудников.Подразделение,
	|	ВыработкаСотрудников.ПартияПроизводства,
	|	ВыработкаСотрудников.ЗаказНаПроизводство,
	|	ВыработкаСотрудников.КодСтрокиПродукция,
	|	ВыработкаСотрудников.Этап,
	|	ВыработкаСотрудников.СтатьяКалькуляции,
	|	ВыработкаСотрудников.ВидРабот,
	|	ВыработкаСотрудников.ГруппаПродукции
	|";
	
	ТекстыЗапроса.Добавить(ТекстЗапроса, ИмяРегистра);
	Возврат ТекстЗапроса;
	
КонецФункции

Функция ТекстЗапросаТаблицаОтражениеЗарплатыВФинансовомУчете(Запрос, ТекстыЗапроса, Регистры)
	
	ИмяРегистра = "ОтражениеЗарплатыВФинансовомУчете";
	
	Если НЕ ПроведениеДокументов.ТребуетсяТаблицаДляДвижений(ИмяРегистра, Регистры) Тогда
		Возврат "";
	КонецЕсли;
	
	УстановитьПараметрЗапросаТаблицаВыработкаСотрудников(Запрос);
	
	Если НЕ ПроведениеДокументов.ЕстьТаблицаЗапроса("ВтТаблицаВыработкаСотрудников", ТекстыЗапроса) Тогда
		ТекстЗапросаВтВыработкаСотрудников(Запрос, ТекстыЗапроса);
	КонецЕсли;
	
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	&Период КАК Период,
	|	&Организация КАК Организация,
	|	ВыработкаСотрудников.Подразделение КАК Подразделение,
	|	ВыработкаСотрудников.НаправлениеДеятельности,
	|	ВыработкаСотрудников.ВидОперацииПоЗарплате,
	|	ВыработкаСотрудников.СтатьяРасходов,
	|	ВыработкаСотрудников.АналитикаРасходов,
	|	ВыработкаСотрудников.ВидРабот,
	|	ВЫБОР
	|		КОГДА НЕ &Сводно
	|				И &ПроводкиПоРаботникам
	|			ТОГДА ВыработкаСотрудников.Сотрудник
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка)
	|	КОНЕЦ КАК ФизическоеЛицо,
	|	ВыработкаСотрудников.ГруппаПродукции,
	|	ВыработкаСотрудников.ТипНалога,
	|	ВыработкаСотрудников.Налог,
	|	ВыработкаСотрудников.АналитикаАктивовПассивов,
	|	ВыработкаСотрудников.СчетУчета,
	|	ВыработкаСотрудников.Субконто1,
	|	ВыработкаСотрудников.Субконто2,
	|	ВыработкаСотрудников.Субконто3,
	|	СУММА(ВыработкаСотрудников.СуммаРегл) КАК СуммаРегл,
	|	0 КАК ПостояннаяРазница,
	|	0 КАК ВременнаяРазница
	|ИЗ
	|	ВтТаблицаВыработкаСотрудников КАК ВыработкаСотрудников
	|
	|СГРУППИРОВАТЬ ПО
	|	ВыработкаСотрудников.Подразделение,
	|	ВыработкаСотрудников.НаправлениеДеятельности,
	|	ВыработкаСотрудников.ВидОперацииПоЗарплате,
	|	ВыработкаСотрудников.СтатьяРасходов,
	|	ВыработкаСотрудников.АналитикаРасходов,
	|	ВыработкаСотрудников.ВидРабот,
	|	ВЫБОР
	|		КОГДА НЕ &Сводно
	|				И &ПроводкиПоРаботникам
	|			ТОГДА ВыработкаСотрудников.Сотрудник
	|		ИНАЧЕ ЗНАЧЕНИЕ(Справочник.ФизическиеЛица.ПустаяСсылка)
	|	КОНЕЦ,
	|	ВыработкаСотрудников.ГруппаПродукции,
	|	ВыработкаСотрудников.ТипНалога,
	|	ВыработкаСотрудников.Налог,
	|	ВыработкаСотрудников.АналитикаАктивовПассивов,
	|	ВыработкаСотрудников.СчетУчета,
	|	ВыработкаСотрудников.Субконто1,
	|	ВыработкаСотрудников.Субконто2,
	|	ВыработкаСотрудников.Субконто3";
	
	ТекстыЗапроса.Добавить(ТекстЗапроса, ИмяРегистра);
	Возврат ТекстЗапроса;
	
КонецФункции

Функция ТекстЗапросаТаблицаВТРасходыДокумента(ТекстыЗапроса = Неопределено)
	
	ИмяРегистра = "ВТРасходыДокумента";
	
	Если Не ПроведениеДокументов.ЕстьТаблицаЗапроса("ВТСпособыОтражения", ТекстыЗапроса) Тогда
		ТекстЗапросаВТСпособыОтражения(ТекстыЗапроса);
	КонецЕсли;
	
	ТекстЗапроса =
	"ВЫБРАТЬ
	|	СтатьиРасходов.НаправлениеДеятельности КАК НаправлениеДеятельности,
	|	СтатьиРасходов.СтатьяРасходов КАК СтатьяРасходов,
	|	СтатьиРасходов.ВариантРаспределения КАК ВариантРаспределения,
	|
	|	ВЫБОР
	|		КОГДА СтатьиРасходов.АналитикаРасходов = ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)
	|			ТОГДА ОценочныеОбязательства.ПодразделениеПредприятия
	|		КОГДА СтатьиРасходов.АналитикаРасходов = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
	|			ТОГДА ОценочныеОбязательства.Ссылка.Организация
	|		ИНАЧЕ СтатьиРасходов.АналитикаРасходов
	|	КОНЕЦ КАК АналитикаРасходов,
	|
	|	ВЫБОР
	|		КОГДА СтатьиРасходов.АналитикаАктивовПассивов = ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)
	|			ТОГДА ОценочныеОбязательства.ПодразделениеПредприятия
	|		КОГДА СтатьиРасходов.АналитикаАктивовПассивов = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
	|			ТОГДА ОценочныеОбязательства.Ссылка.Организация
	|		ИНАЧЕ СтатьиРасходов.АналитикаАктивовПассивов
	|	КОНЕЦ КАК АналитикаАктивовПассивов,
	|
	|	СтатьиРасходов.СчетУчета КАК СчетУчета,
	|	СтатьиРасходов.Субконто1 КАК Субконто1,
	|	СтатьиРасходов.Субконто2 КАК Субконто2,
	|	СтатьиРасходов.Субконто3 КАК Субконто3,
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ОбеспечениеВыплатОтпусков) КАК СчетКт,
	|	ВЫРАЗИТЬ(ОценочныеОбязательства.СуммаРезерва * &КоэффициентПересчетаВВалютуУпр КАК ЧИСЛО(15, 2)) КАК Сумма,
	|	0 КАК СуммаНУ,
	|	ОценочныеОбязательства.СуммаРезерва КАК СуммаРегл,
	|	0 КАК СуммаРеглНУ,
	|	ОценочныеОбязательства.НомерСтроки КАК НомерСтроки,
	|	ОценочныеОбязательства.ПодразделениеПредприятия КАК Подразделение,
	|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.НачислениеРезервовПоВознаграждениям) КАК ХозяйственнаяОперация,
	|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиАктивовПассивов.ОплатаТруда) КАК СтатьяАктивовПассивов,
	|	ОценочныеОбязательства.Ссылка,
	|	КОНЕЦПЕРИОДА(ОценочныеОбязательства.Ссылка.ПериодРегистрации, МЕСЯЦ) КАК ПериодРегистрации
	|ПОМЕСТИТЬ ВТРасходыДокумента
	|ИЗ
	|	Документ.НачислениеОценочныхОбязательствПоОтпускам.ОценочныеОбязательства КАК ОценочныеОбязательства
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДокументыКОтражению КАК ДокументыКОтражению
	|		ПО ОценочныеОбязательства.Ссылка = ДокументыКОтражению.Ссылка
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТСпособыОтражения КАК СтатьиРасходов
	|		ПО ОценочныеОбязательства.СпособОтраженияЗарплатыВБухучете = СтатьиРасходов.СпособОтражения
	|ГДЕ
	|	НЕ ДокументыКОтражению.Ссылка.КорректировкаОбязательств
	|	И ОценочныеОбязательства.СуммаРезерва <> 0
	|	И НЕ СтатьиРасходов.ОплатаСдельныхРабот
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	СтатьиРасходов.НаправлениеДеятельности КАК НаправлениеДеятельности,
	|	СтатьиРасходов.СтатьяРасходовВзносов,
	|	СтатьиРасходов.ВариантРаспределенияВзносов,
	|
	|	ВЫБОР
	|		КОГДА СтатьиРасходов.АналитикаРасходовВзносов = ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)
	|			ТОГДА ОценочныеОбязательства.ПодразделениеПредприятия
	|		КОГДА СтатьиРасходов.АналитикаРасходовВзносов = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
	|			ТОГДА ОценочныеОбязательства.Ссылка.Организация
	|		ИНАЧЕ СтатьиРасходов.АналитикаРасходовВзносов
	|	КОНЕЦ,
	|
	|	ВЫБОР
	|		КОГДА СтатьиРасходов.АналитикаАктивовПассивовВзносов = ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)
	|			ТОГДА ОценочныеОбязательства.ПодразделениеПредприятия
	|		КОГДА СтатьиРасходов.АналитикаАктивовПассивовВзносов = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
	|			ТОГДА ОценочныеОбязательства.Ссылка.Организация
	|		ИНАЧЕ СтатьиРасходов.АналитикаАктивовПассивовВзносов
	|	КОНЕЦ,
	|
	|	СтатьиРасходов.СчетУчетаВзносов,
	|	СтатьиРасходов.Субконто1Взносов,
	|	СтатьиРасходов.Субконто2Взносов,
	|	СтатьиРасходов.Субконто3Взносов,
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ОбеспечениеВыплатОтпусков),	
	|	ВЫРАЗИТЬ((ОценочныеОбязательства.СуммаРезерваСтраховыхВзносов) * &КоэффициентПересчетаВВалютуУпр КАК ЧИСЛО(15, 2)),
	|	0,
	|	ОценочныеОбязательства.СуммаРезерваСтраховыхВзносов,
	|	0,
	|	ОценочныеОбязательства.НомерСтроки,
	|	ОценочныеОбязательства.ПодразделениеПредприятия,
	|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.НачислениеРезервовПоСтраховымВзносам),
	|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиАктивовПассивов.Налоги),
	|	ОценочныеОбязательства.Ссылка,
	|	КОНЕЦПЕРИОДА(ОценочныеОбязательства.Ссылка.ПериодРегистрации, МЕСЯЦ) КАК ПериодРегистрации
	|ИЗ
	|	Документ.НачислениеОценочныхОбязательствПоОтпускам.ОценочныеОбязательства КАК ОценочныеОбязательства
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДокументыКОтражению КАК ДокументыКОтражению
	|		ПО ОценочныеОбязательства.Ссылка = ДокументыКОтражению.Ссылка
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТСпособыОтражения КАК СтатьиРасходов
	|		ПО ОценочныеОбязательства.СпособОтраженияЗарплатыВБухучете = СтатьиРасходов.СпособОтражения
	|ГДЕ
	|	НЕ ДокументыКОтражению.Ссылка.КорректировкаОбязательств
	|	И ОценочныеОбязательства.СуммаРезерваСтраховыхВзносов <> 0
	|	И НЕ СтатьиРасходов.ОплатаСдельныхРабот
	|";
	
	Если Не ТекстыЗапроса = Неопределено Тогда	
		ТекстыЗапроса.Добавить(ТекстЗапроса, ИмяРегистра);
	КонецЕсли;
	
	Возврат ТекстЗапроса;
	
КонецФункции

Функция ТекстЗапросаТаблицаВтИсходныеПрочиеРасходы(ТекстыЗапроса)
	
	ИмяРегистра = "ВтИсходныеПрочиеРасходы";
	
	Если Не ПроведениеДокументов.ЕстьТаблицаЗапроса("ВТРасходыДокумента", ТекстыЗапроса) Тогда
		ТекстЗапросаТаблицаВТРасходыДокумента(ТекстыЗапроса);
	КонецЕсли;
	
	ТекстЗапроса = "
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход) КАК ВидДвижения,
	|	&Период                                КАК Период,
	|	&Организация                           КАК Организация,
	|	ВТДанныеРасходы.Подразделение          КАК Подразделение,
	|	ВТДанныеРасходы.НаправлениеДеятельности КАК НаправлениеДеятельности,
	|	ВЫБОР КОГДА ВТДанныеРасходы.ВариантРаспределения =
	|		ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаВнеоборотныеАктивы)
	|	ТОГДА
	|		ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
	|	ИНАЧЕ
	|		&НалоговоеНазначениеОрганизации 
	|	КОНЕЦ КАК НалоговоеНазначение,
	|	ВТДанныеРасходы.СтатьяРасходов         КАК СтатьяРасходов,
	|	ВТДанныеРасходы.АналитикаРасходов      КАК АналитикаРасходов,
	|	НЕОПРЕДЕЛЕНО КАК ВидДеятельностиНДС,
	|
	|	СУММА(ВТДанныеРасходы.Сумма) КАК СуммаСНДС,
	|	СУММА(ВТДанныеРасходы.Сумма) КАК СуммаБезНДС,
	|	СУММА(ВТДанныеРасходы.Сумма) КАК СуммаБезНДСУпр,
	|	СУММА(ВТДанныеРасходы.СуммаРегл) КАК СуммаСНДСРегл,
	|	СУММА(ВТДанныеРасходы.СуммаРегл) КАК СуммаБезНДСРегл,
	|	0 КАК ПостояннаяРазница,
	|	0 КАК ВременнаяРазница,
	|	0 КАК НДСРегл,	
	|	НЕОПРЕДЕЛЕНО КАК ХозяйственнаяОперация,
	|	НЕОПРЕДЕЛЕНО КАК АналитикаУчетаНоменклатуры
	|
	|ПОМЕСТИТЬ ВтИсходныеПрочиеРасходы
	|ИЗ
	|	ВТРасходыДокумента КАК ВТДанныеРасходы
	|
	|ГДЕ
	|	ВТДанныеРасходы.СтатьяРасходов Ссылка ПланВидовХарактеристик.СтатьиРасходов
	|
	|СГРУППИРОВАТЬ ПО
	|	ВТДанныеРасходы.ВариантРаспределения,
	|	ВТДанныеРасходы.НомерСтроки,
	|	ВТДанныеРасходы.СтатьяРасходов,
	|	ВТДанныеРасходы.НаправлениеДеятельности,
	|	ВЫБОР КОГДА ВТДанныеРасходы.ВариантРаспределения =
	|		ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаВнеоборотныеАктивы)
	|	ТОГДА
	|		ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
	|	ИНАЧЕ
	|		&НалоговоеНазначениеОрганизации 
	|	КОНЕЦ,
	|	ВТДанныеРасходы.АналитикаРасходов,
	|	ВТДанныеРасходы.Подразделение
	|";
	
	ТекстыЗапроса.Добавить(ТекстЗапроса, ИмяРегистра);
	Возврат ТекстЗапроса;
	
КонецФункции

Функция ТекстЗапросаТаблицаВтПрочиеРасходы(ТекстыЗапроса)
	
	ИмяРегистра = "ВтПрочиеРасходы";
	
	Если Не ПроведениеДокументов.ЕстьТаблицаЗапроса("ВтИсходныеПрочиеРасходы", ТекстыЗапроса) Тогда
		ТекстЗапросаТаблицаВтИсходныеПрочиеРасходы(ТекстыЗапроса);
	КонецЕсли;
	
	ТекстЗапроса = РегистрыНакопления.ПрочиеРасходы.ТекстЗапросаТаблицаВтПрочиеРасходы();
	ТекстыЗапроса.Добавить(ТекстЗапроса, ИмяРегистра);
	Возврат ТекстЗапроса;
	
КонецФункции

Функция ТекстЗапросаТаблицаПрочиеРасходы(ТекстыЗапроса, Регистры)
	
	ИмяРегистра = "ПрочиеРасходы";
	
	Если НЕ ПроведениеДокументов.ТребуетсяТаблицаДляДвижений(ИмяРегистра, Регистры) Тогда
		Возврат "";
	КонецЕсли;
	
	Если Не ПроведениеДокументов.ЕстьТаблицаЗапроса("ВтПрочиеРасходы", ТекстыЗапроса) Тогда
		ТекстЗапросаТаблицаВтПрочиеРасходы(ТекстыЗапроса);
	КонецЕсли;
	
	ТекстЗапроса = РегистрыНакопления.ПрочиеРасходы.ТекстЗапросаТаблицаПрочиеРасходы();
	ТекстыЗапроса.Добавить(ТекстЗапроса, ИмяРегистра);
	Возврат ТекстЗапроса;
	
КонецФункции

Функция ТекстЗапросаТаблицаВтИсходныеПартииПрочихРасходов(ТекстыЗапроса)
	
	ИмяРегистра = "ВтИсходныеПартииПрочихРасходов";
	
	Если Не ПроведениеДокументов.ЕстьТаблицаЗапроса("ВТРасходыДокумента", ТекстыЗапроса) Тогда
		ТекстЗапросаТаблицаВТРасходыДокумента(ТекстыЗапроса);
	КонецЕсли;
	
	ТекстЗапроса = "
	|ВЫБРАТЬ
	|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)      КАК ВидДвижения,
	|	&Период                                     КАК Период,
	|	&Организация                                КАК Организация,
	|	ВТДанныеРасходы.Подразделение               КАК Подразделение,
	|	ВТДанныеРасходы.СтатьяРасходов              КАК СтатьяРасходов,
	|	ВТДанныеРасходы.АналитикаРасходов           КАК АналитикаРасходов,
	|	НЕОПРЕДЕЛЕНО                                КАК АналитикаАктивовПассивов,
	|	ВТДанныеРасходы.Ссылка                      КАК ДокументПоступленияРасходов,
	|	НЕОПРЕДЕЛЕНО                                КАК АналитикаУчетаПартий,
	|	НЕОПРЕДЕЛЕНО                                КАК НаправлениеДеятельности,
	|	ВЫБОР КОГДА ВТДанныеРасходы.ВариантРаспределения = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаВнеоборотныеАктивы) ТОГДА
	|		ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
	|	ИНАЧЕ
	|		&НалоговоеНазначениеОрганизации
	|	КОНЕЦ КАК НалоговоеНазначение,
	|	НЕОПРЕДЕЛЕНО                                КАК АналитикаУчетаНоменклатуры,
	|	НЕОПРЕДЕЛЕНО                                КАК ВидДеятельностиНДС,
	|
	|	СУММА(ВТДанныеРасходы.Сумма)                КАК Стоимость,
	|	СУММА(ВТДанныеРасходы.Сумма)                КАК СтоимостьБезНДС,
	|	0                                           КАК НДСУпр,
	|	СУММА(ВТДанныеРасходы.СуммаРегл)            КАК СтоимостьРегл,
	|	0                                           КАК ПостояннаяРазница,
	|	0                                           КАК ВременнаяРазница,
	|	0                                           КАК НДСРегл,
	|	НЕОПРЕДЕЛЕНО                                КАК ХозяйственнаяОперация
	|
	|ПОМЕСТИТЬ ВтИсходныеПартииПрочихРасходов
	|ИЗ
	|	ВТРасходыДокумента КАК ВТДанныеРасходы
	|
	|ГДЕ
	|	ВТДанныеРасходы.СтатьяРасходов Ссылка ПланВидовХарактеристик.СтатьиРасходов
	|
	|СГРУППИРОВАТЬ ПО
	|	ВТДанныеРасходы.Подразделение,
	|	ВТДанныеРасходы.СтатьяРасходов,
	|	ВТДанныеРасходы.АналитикаРасходов,
	|	ВЫБОР КОГДА ВТДанныеРасходы.ВариантРаспределения = ЗНАЧЕНИЕ(Перечисление.ВариантыРаспределенияРасходов.НаВнеоборотныеАктивы) ТОГДА
	|		ЗНАЧЕНИЕ(Справочник.НалоговыеНазначенияАктивовИЗатрат.ПустаяСсылка)
	|	ИНАЧЕ
	|		&НалоговоеНазначениеОрганизации
	|	КОНЕЦ,
	|	ВТДанныеРасходы.Ссылка
	|";
	
	ТекстыЗапроса.Добавить(ТекстЗапроса, ИмяРегистра);
	Возврат ТекстЗапроса;
	
КонецФункции

Функция ТекстЗапросаТаблицаВтПартииПрочихРасходов(ТекстыЗапроса)
	
	ИмяРегистра = "ВтПартииПрочихРасходов";
	
	Если Не ПроведениеДокументов.ЕстьТаблицаЗапроса("ВтИсходныеПартииПрочихРасходов", ТекстыЗапроса) Тогда
		ТекстЗапросаТаблицаВтИсходныеПартииПрочихРасходов(ТекстыЗапроса);
	КонецЕсли;
	
	ТекстЗапроса = РегистрыНакопления.ПартииПрочихРасходов.ТекстЗапросаТаблицаВтПартииПрочихРасходов();
	ТекстыЗапроса.Добавить(ТекстЗапроса, ИмяРегистра);
	Возврат ТекстЗапроса;
	
КонецФункции

Функция ТекстЗапросаТаблицаПартииПрочихРасходов(ТекстыЗапроса, Регистры)
	
	ИмяРегистра = "ПартииПрочихРасходов";
	
	Если НЕ ПроведениеДокументов.ТребуетсяТаблицаДляДвижений(ИмяРегистра, Регистры) Тогда
		Возврат "";
	КонецЕсли;
	
	Если Не ПроведениеДокументов.ЕстьТаблицаЗапроса("ВтПартииПрочихРасходов", ТекстыЗапроса) Тогда
		ТекстЗапросаТаблицаВтПартииПрочихРасходов(ТекстыЗапроса);
	КонецЕсли;
	
	ТекстЗапроса = РегистрыНакопления.ПартииПрочихРасходов.ТекстЗапросаТаблицаПартииПрочихРасходов();
	ТекстыЗапроса.Добавить(ТекстЗапроса, ИмяРегистра);
	Возврат ТекстЗапроса;
	
КонецФункции

Функция ТекстЗапросаПрочиеАктивыПассивы(Запрос, ТекстыЗапроса, Регистры)

	ИмяРегистра = "ПрочиеАктивыПассивы";
	
	Если НЕ ПроведениеДокументов.ТребуетсяТаблицаДляДвижений(ИмяРегистра, Регистры) Тогда
		Возврат "";
	КонецЕсли;
	
	Если Не ПроведениеДокументов.ЕстьТаблицаЗапроса("ВТРасходыДокумента", ТекстыЗапроса) Тогда
		ТекстЗапросаТаблицаВТРасходыДокумента(ТекстыЗапроса);
	КонецЕсли;
	
	Если Не ПроведениеДокументов.ЕстьТаблицаЗапроса("ВтПрочиеРасходы", ТекстыЗапроса) Тогда
		ТекстЗапросаТаблицаВтПрочиеРасходы(ТекстыЗапроса);
	КонецЕсли;
	
	Если Не ПроведениеДокументов.ЕстьТаблицаЗапроса("ВтПартииПрочихРасходов", ТекстыЗапроса) Тогда
		ТекстЗапросаТаблицаВтПартииПрочихРасходов(ТекстыЗапроса);
	КонецЕсли;
	
	Если НЕ ПроведениеДокументов.ЕстьТаблицаЗапроса("ВтТаблицаВыработкаСотрудников", ТекстыЗапроса) Тогда
		ТекстЗапросаВтВыработкаСотрудников(Запрос, ТекстыЗапроса);
	КонецЕсли;

	ТекстЗапроса = 
	// расходное движение по предопределенным статьям Оплата труда и Взносы с оплаты труда
	"ВЫБРАТЬ
	|	&Период                                  КАК Период,
	|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)   КАК ВидДвижения,
	|	&Организация                             КАК Организация,
	|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК Подразделение,
	|	НЕОПРЕДЕЛЕНО                             КАК НаправлениеДеятельности,
	|	ВТДанныеРасходы.СтатьяАктивовПассивов    КАК Статья,
	|	НЕОПРЕДЕЛЕНО                             КАК Аналитика,
	|	СУММА(ВТДанныеРасходы.Сумма)             КАК Сумма
	|ИЗ
	|	ВТРасходыДокумента КАК ВТДанныеРасходы
	|
	|СГРУППИРОВАТЬ ПО
	|	ВТДанныеРасходы.СтатьяАктивовПассивов
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	// сдельная зарплата к выплате на пассивы
	|ВЫБРАТЬ
	|	&Период КАК Период,
	|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход) КАК ВидДвижения,
	|	&Организация КАК Организация,
	|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК Подразделение,
	|	ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка) КАК НаправлениеДеятельности,
	|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиАктивовПассивов.ОплатаТруда) КАК Статья,
	|	НЕОПРЕДЕЛЕНО КАК Аналитика,
	|	СУММА(Строки.Сумма) КАК Сумма
	|ИЗ
	|	ВтТаблицаВыработкаСотрудников КАК Строки
	|ГДЕ
	|	Строки.ТипНалога = ЗНАЧЕНИЕ(Перечисление.ТипыОценочныхОбязательств.ОценочныеОбязательстваПоВознаграждениям)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	// взносы со сдельной зарплаты к перечислению на пассивы
	|ВЫБРАТЬ
	|	&Период,
	|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход),
	|	&Организация,
	|	ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка) КАК Подразделение,
	|	ЗНАЧЕНИЕ(Справочник.НаправленияДеятельности.ПустаяСсылка) КАК НаправлениеДеятельности,
	|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиАктивовПассивов.Налоги),
	|	НЕОПРЕДЕЛЕНО,
	|	СУММА(Строки.Сумма) КАК Сумма
	|ИЗ
	|	ВтТаблицаВыработкаСотрудников КАК Строки
	|ГДЕ
	|	Строки.ТипНалога <> ЗНАЧЕНИЕ(Перечисление.ТипыОценочныхОбязательств.ОценочныеОбязательстваПоВознаграждениям)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	// приходное движение по статьям пассивов, указанных в способах отражения
	|ВЫБРАТЬ
	|	&Период                                  КАК Период,
	|	ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)   КАК ВидДвижения,
	|	&Организация                             КАК Организация,
	|	ВТДанныеРасходы.Подразделение            КАК Подразделение,
	|	ВТДанныеРасходы.НаправлениеДеятельности  КАК НаправлениеДеятельности,
	|	ВТДанныеРасходы.СтатьяРасходов           КАК Статья,
	|	ВТДанныеРасходы.АналитикаАктивовПассивов КАК Аналитика,
	|	СУММА(ВТДанныеРасходы.Сумма)             КАК Сумма
	|ИЗ
	|	ВТРасходыДокумента КАК ВТДанныеРасходы
	|
	|ГДЕ
	|	ВТДанныеРасходы.СтатьяРасходов Ссылка ПланВидовХарактеристик.СтатьиАктивовПассивов
	|
	|СГРУППИРОВАТЬ ПО
	|	ВТДанныеРасходы.Подразделение,
	|	ВТДанныеРасходы.СтатьяРасходов,
	|	ВТДанныеРасходы.НаправлениеДеятельности,
	|	ВТДанныеРасходы.АналитикаАктивовПассивов
	|";
	ТекстЗапроса = ТекстЗапроса + "ОБЪЕДИНИТЬ ВСЕ"
		+ РегистрыНакопления.ПрочиеАктивыПассивы.ТекстЗапросаТаблицаПрочиеАктивыПассивы();
	
	ТекстыЗапроса.Добавить(ТекстЗапроса, ИмяРегистра);
	Возврат ТекстЗапроса;
	
КонецФункции

Функция ТекстЗапросаДвиженияДоходыРасходыПрочиеАктивыПассивы(ТекстыЗапроса, Регистры)

	ИмяРегистра = "ДвиженияДоходыРасходыПрочиеАктивыПассивы";
	
	Если НЕ ПроведениеДокументов.ТребуетсяТаблицаДляДвижений(ИмяРегистра, Регистры) Тогда
		Возврат "";
	КонецЕсли;
	
	Если Не ПроведениеДокументов.ЕстьТаблицаЗапроса("ВТРасходыДокумента", ТекстыЗапроса) Тогда
		ТекстЗапросаТаблицаВТРасходыДокумента(ТекстыЗапроса);
	КонецЕсли;
	
	ТекстЗапроса =
	// расходы - пассивы
	"ВЫБРАТЬ
	|	&Период                                  КАК Период,
	|	МАКСИМУМ(ВТДанныеРасходы.НомерСтроки)    КАК НомерСтроки,
	|	ВТДанныеРасходы.ХозяйственнаяОперация    КАК ХозяйственнаяОперация,
	|
	|	&Организация                             КАК Организация,
	
	|	ВТДанныеРасходы.Подразделение            КАК Подразделение,
	|	НЕОПРЕДЕЛЕНО                             КАК НаправлениеДеятельности,
	|	ВТДанныеРасходы.СтатьяАктивовПассивов    КАК Статья,
	|	НЕОПРЕДЕЛЕНО                             КАК АналитикаРасходов,
	|	ВЫБОР КОГДА ВТДанныеРасходы.СтатьяАктивовПассивов = ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиАктивовПассивов.Налоги) ТОГДА
	|		ЗНАЧЕНИЕ(Перечисление.ТипыНалогов.ПустаяСсылка)
	|	ИНАЧЕ
	|		НЕОПРЕДЕЛЕНО
	|	КОНЕЦ КАК АналитикаАктивовПассивов,
	
	|	ВТДанныеРасходы.Подразделение            КАК КорПодразделение,
	|	ВТДанныеРасходы.НаправлениеДеятельности  КАК КорНаправлениеДеятельности,
	|	ВТДанныеРасходы.СтатьяРасходов           КАК КорСтатья,
	|	ВТДанныеРасходы.АналитикаРасходов        КАК КорАналитикаРасходов,
	|	НЕОПРЕДЕЛЕНО                             КАК КорАналитикаАктивовПассивов,
	|
	|	СУММА(ВТДанныеРасходы.Сумма)             КАК Сумма,
	|	СУММА(ВТДанныеРасходы.Сумма)             КАК СуммаУпр,
	|	СУММА(ВТДанныеРасходы.СуммаРегл)         КАК СуммаРегл
	|
	|ИЗ
	|	ВТРасходыДокумента КАК ВТДанныеРасходы
	|
	|ГДЕ
	|	ВТДанныеРасходы.Сумма <> 0
	|	И ВТДанныеРасходы.СтатьяРасходов Ссылка ПланВидовХарактеристик.СтатьиРасходов
	|
	|СГРУППИРОВАТЬ ПО
	|	ВТДанныеРасходы.СтатьяРасходов,
	|	ВТДанныеРасходы.АналитикаРасходов,
	|	ВТДанныеРасходы.СтатьяАктивовПассивов,
	|	ВТДанныеРасходы.ХозяйственнаяОперация,
	|	ВТДанныеРасходы.Подразделение,
	|	ВТДанныеРасходы.НаправлениеДеятельности
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	// пассивы - пассивы
	|ВЫБРАТЬ
	|	&Период                                  КАК Период,
	|	МАКСИМУМ(ВТДанныеРасходы.НомерСтроки)    КАК НомерСтроки,
	|
	|	ВТДанныеРасходы.ХозяйственнаяОперация    КАК ХозяйственнаяОперация,
	|
	|	&Организация                             КАК Организация,
	
	|	ВТДанныеРасходы.Подразделение            КАК Подразделение,
	|	ВТДанныеРасходы.НаправлениеДеятельности  КАК НаправлениеДеятельности,
	|	ВТДанныеРасходы.СтатьяАктивовПассивов    КАК Статья,
	|	НЕОПРЕДЕЛЕНО                             КАК АналитикаРасходов,
	|	ВЫБОР КОГДА ВТДанныеРасходы.СтатьяАктивовПассивов = ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиАктивовПассивов.Налоги) ТОГДА
	|		ЗНАЧЕНИЕ(Перечисление.ТипыНалогов.ПустаяСсылка)
	|	ИНАЧЕ
	|		НЕОПРЕДЕЛЕНО
	|	КОНЕЦ КАК АналитикаАктивовПассивов,
	|
	|	ВТДанныеРасходы.Подразделение            КАК КорПодразделение,
	|	ВТДанныеРасходы.НаправлениеДеятельности  КАК КорНаправлениеДеятельности,
	|	ВТДанныеРасходы.СтатьяРасходов           КАК КорСтатья,
	|	НЕОПРЕДЕЛЕНО                             КАК КорАналитикаРасходов,
	|	ВТДанныеРасходы.АналитикаАктивовПассивов КАК КорАналитикаАктивовПассивов,
	
	|	СУММА(ВТДанныеРасходы.Сумма)             КАК Сумма,
	|	СУММА(ВТДанныеРасходы.Сумма)             КАК СуммаУпр,
	|	СУММА(ВТДанныеРасходы.СуммаРегл)         КАК СуммаРегл
	|
	|ИЗ
	|	ВТРасходыДокумента КАК ВТДанныеРасходы
	|
	|ГДЕ
	|	ВТДанныеРасходы.Сумма > 0
	|	И ВТДанныеРасходы.СтатьяРасходов Ссылка ПланВидовХарактеристик.СтатьиАктивовПассивов
	|
	|СГРУППИРОВАТЬ ПО
	|	ВТДанныеРасходы.СтатьяРасходов,
	|	ВТДанныеРасходы.АналитикаАктивовПассивов,
	|	ВТДанныеРасходы.СтатьяАктивовПассивов,
	|	ВТДанныеРасходы.ХозяйственнаяОперация,
	|	ВТДанныеРасходы.Подразделение,
	|	ВТДанныеРасходы.НаправлениеДеятельности
	|
	|УПОРЯДОЧИТЬ ПО
	|	НомерСтроки";
	
	ТекстыЗапроса.Добавить(ТекстЗапроса, ИмяРегистра);
	Возврат ТекстЗапроса;
	
КонецФункции

Функция ТекстЗапросаТаблицаПорядокОтраженияПрочихОпераций(ТекстыЗапроса, Регистры)
	
	ИмяРегистра = "ПорядокОтраженияПрочихОпераций";
	
	Если Не ПроведениеДокументов.ТребуетсяТаблицаДляДвижений(ИмяРегистра, Регистры) Тогда
		Возврат "";
	КонецЕсли;
	
	ТекстЗапроса =
	"ВЫБРАТЬ ПЕРВЫЕ 1
	|	&Период	КАК Дата,
	|	&Организация КАК Организация,
	|	&Ссылка КАК Документ,
	|	"""" КАК ИдентификаторСтроки
	|ИЗ
	|	Документ.НачислениеОценочныхОбязательствПоОтпускам.ОценочныеОбязательства КАК Строки
	|	ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.СпособыОтраженияЗарплатыВБухУчете КАК СпособыОтражения
	|		ПО СпособыОтражения.Ссылка = Строки.СпособОтраженияЗарплатыВБухучете
	|ГДЕ
	|	Строки.Ссылка = &Ссылка
	|	И СпособыОтражения.ЕстьПрочиеОперации
	|	И НЕ &КорректировкаОбязательств";
	
	ТекстыЗапроса.Добавить(ТекстЗапроса, ИмяРегистра);
	Возврат ТекстЗапроса;
	
КонецФункции

Функция ТекстЗапросаТаблицаОтражениеДокументовВРеглУчете(ТекстыЗапроса, Регистры)
	
	ИмяРегистра = "ОтражениеДокументовВРеглУчете";
	
	Если Не ПроведениеДокументов.ТребуетсяТаблицаДляДвижений(ИмяРегистра, Регистры) Тогда
		Возврат "";
	КонецЕсли;
	
	ТекстЗапроса =
	"ВЫБРАТЬ
	|	&Период           КАК Период,
	|	&Организация      КАК Организация,
	|	&Период           КАК ДатаОтражения";
	
	ТекстыЗапроса.Добавить(ТекстЗапроса, ИмяРегистра);
	Возврат ТекстЗапроса;
	
КонецФункции

Функция ТекстЗапросаТаблицаВТРасходыДокументаРегл(ТекстыЗапроса = Неопределено)
	
	ИмяРегистра = "ВТРасходыДокументаРегл";
	
	Если Не ПроведениеДокументов.ЕстьТаблицаЗапроса("ВТСпособыОтражения", ТекстыЗапроса) Тогда
		ТекстЗапросаВТСпособыОтражения(ТекстыЗапроса);
	КонецЕсли;
	
	ТекстЗапроса =
	"ВЫБРАТЬ
	|	СтатьиРасходов.НаправлениеДеятельности КАК НаправлениеДеятельности,
	|	СтатьиРасходов.СтатьяРасходов КАК СтатьяРасходов,
	|	СтатьиРасходов.ВариантРаспределения КАК ВариантРаспределения,
	|
	|	ВЫБОР
	|		КОГДА СтатьиРасходов.АналитикаРасходов = ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)
	|			ТОГДА ОценочныеОбязательства.ПодразделениеПредприятия
	|		КОГДА СтатьиРасходов.АналитикаРасходов = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
	|			ТОГДА ОценочныеОбязательства.Ссылка.Организация
	|		ИНАЧЕ СтатьиРасходов.АналитикаРасходов
	|	КОНЕЦ КАК АналитикаРасходов,
	|
	|	ВЫБОР
	|		КОГДА СтатьиРасходов.АналитикаАктивовПассивов = ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)
	|			ТОГДА ОценочныеОбязательства.ПодразделениеПредприятия
	|		КОГДА СтатьиРасходов.АналитикаАктивовПассивов = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
	|			ТОГДА ОценочныеОбязательства.Ссылка.Организация
	|		ИНАЧЕ СтатьиРасходов.АналитикаАктивовПассивов
	|	КОНЕЦ КАК АналитикаАктивовПассивов,
	|
	|	СтатьиРасходов.СчетУчета КАК СчетУчета,
	|	СтатьиРасходов.Субконто1 КАК Субконто1,
	|	СтатьиРасходов.Субконто2 КАК Субконто2,
	|	СтатьиРасходов.Субконто3 КАК Субконто3,
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ОбеспечениеВыплатОтпусков) КАК СчетКт,
	|	ВЫРАЗИТЬ(ОценочныеОбязательства.СуммаРезерва * &КоэффициентПересчетаВВалютуУпр КАК ЧИСЛО(15, 2)) КАК Сумма,
	|	0 КАК СуммаНУ,
	|	ОценочныеОбязательства.СуммаРезерва КАК СуммаРегл,
	|	0 КАК СуммаРеглНУ,
	|	ОценочныеОбязательства.НомерСтроки КАК НомерСтроки,
	|	ОценочныеОбязательства.ПодразделениеПредприятия КАК Подразделение,
	|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.НачислениеРезервовПоВознаграждениям) КАК ХозяйственнаяОперация,
	|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиАктивовПассивов.ОплатаТруда) КАК СтатьяАктивовПассивов,
	|	ОценочныеОбязательства.Ссылка,
	|	КОНЕЦПЕРИОДА(ОценочныеОбязательства.Ссылка.ПериодРегистрации, МЕСЯЦ) КАК ПериодРегистрации
	|ПОМЕСТИТЬ ВТРасходыДокументаРегл
	|ИЗ
	|	Документ.НачислениеОценочныхОбязательствПоОтпускам.ОценочныеОбязательства КАК ОценочныеОбязательства
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДокументыКОтражению КАК ДокументыКОтражению
	|		ПО ОценочныеОбязательства.Ссылка = ДокументыКОтражению.Ссылка
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТСпособыОтражения КАК СтатьиРасходов
	|		ПО ОценочныеОбязательства.СпособОтраженияЗарплатыВБухучете = СтатьиРасходов.СпособОтражения
	|ГДЕ
	|	НЕ ДокументыКОтражению.Ссылка.КорректировкаОбязательств
	|	И ОценочныеОбязательства.СуммаРезерва <> 0
	|	И НЕ СтатьиРасходов.ОплатаСдельныхРабот
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	СтатьиРасходов.НаправлениеДеятельности КАК НаправлениеДеятельности,
	|	СтатьиРасходов.СтатьяРасходовВзносов,
	|	СтатьиРасходов.ВариантРаспределенияВзносов,
	|
	|	ВЫБОР
	|		КОГДА СтатьиРасходов.АналитикаРасходовВзносов = ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)
	|			ТОГДА ОценочныеОбязательства.ПодразделениеПредприятия
	|		КОГДА СтатьиРасходов.АналитикаРасходовВзносов = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
	|			ТОГДА ОценочныеОбязательства.Ссылка.Организация
	|		ИНАЧЕ СтатьиРасходов.АналитикаРасходовВзносов
	|	КОНЕЦ,
	|
	|	ВЫБОР
	|		КОГДА СтатьиРасходов.АналитикаАктивовПассивовВзносов = ЗНАЧЕНИЕ(Справочник.СтруктураПредприятия.ПустаяСсылка)
	|			ТОГДА ОценочныеОбязательства.ПодразделениеПредприятия	
	|		КОГДА СтатьиРасходов.АналитикаАктивовПассивовВзносов = ЗНАЧЕНИЕ(Справочник.Организации.ПустаяСсылка)
	|			ТОГДА ОценочныеОбязательства.Ссылка.Организация
	|		ИНАЧЕ СтатьиРасходов.АналитикаАктивовПассивовВзносов
	|	КОНЕЦ,
	|
	|	СтатьиРасходов.СчетУчетаВзносов,
	|	СтатьиРасходов.Субконто1Взносов,
	|	СтатьиРасходов.Субконто2Взносов,
	|	СтатьиРасходов.Субконто3Взносов,
	|	ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ОбеспечениеВыплатОтпусков),
	|	ВЫРАЗИТЬ((ОценочныеОбязательства.СуммаРезерваСтраховыхВзносов) * &КоэффициентПересчетаВВалютуУпр КАК ЧИСЛО(15, 2)),
	|	0,
	|	ОценочныеОбязательства.СуммаРезерваСтраховыхВзносов,
	|	0,
	|	ОценочныеОбязательства.НомерСтроки,
	|	ОценочныеОбязательства.ПодразделениеПредприятия,
	|	ЗНАЧЕНИЕ(Перечисление.ХозяйственныеОперации.НачислениеРезервовПоСтраховымВзносам),
	|	ЗНАЧЕНИЕ(ПланВидовХарактеристик.СтатьиАктивовПассивов.Налоги),
	|	ОценочныеОбязательства.Ссылка,
	|	КОНЕЦПЕРИОДА(ОценочныеОбязательства.Ссылка.ПериодРегистрации, МЕСЯЦ) КАК ПериодРегистрации
	|ИЗ
	|	Документ.НачислениеОценочныхОбязательствПоОтпускам.ОценочныеОбязательства КАК ОценочныеОбязательства
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ДокументыКОтражению КАК ДокументыКОтражению
	|		ПО ОценочныеОбязательства.Ссылка = ДокументыКОтражению.Ссылка
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ ВТСпособыОтражения КАК СтатьиРасходов
	|		ПО ОценочныеОбязательства.СпособОтраженияЗарплатыВБухучете = СтатьиРасходов.СпособОтражения
	|ГДЕ
	|	НЕ ДокументыКОтражению.Ссылка.КорректировкаОбязательств
	|	И ОценочныеОбязательства.СуммаРезерваСтраховыхВзносов <> 0
	|	И НЕ СтатьиРасходов.ОплатаСдельныхРабот
	|";
	
	Если Не ТекстыЗапроса = Неопределено Тогда	
		ТекстыЗапроса.Добавить(ТекстЗапроса, ИмяРегистра);
	КонецЕсли;
	
	Возврат ТекстЗапроса;
	
КонецФункции

#КонецОбласти

// Конец ERP


#Область Печать

// Заполняет список команд печати.
// 
// Параметры:
//   КомандыПечати - ТаблицаЗначений - состав полей см. в функции УправлениеПечатью.СоздатьКоллекциюКомандПечати.
//
Процедура ДобавитьКомандыПечати(КомандыПечати) Экспорт
	
КонецПроцедуры

#КонецОбласти

Функция ТребуетсяУтверждениеДокументаБухгалтером(Организация = Неопределено) Экспорт
	
	// Подтверждение требуется, если используется обмен с бухгалтерией.
	
	// ЗарплатаКадрыПриложения.ОбменЗарплата30Бухгалтерия21
	Если ОбщегоНазначения.ПодсистемаСуществует("ЗарплатаКадрыПриложения.ОбменЗарплата30Бухгалтерия21")
		И Не ОбщегоНазначения.ПодсистемаСуществует("ЗарплатаКадрыПриложения.КонфигурацииЗарплатаКадры") Тогда
		
		Модуль = ОбщегоНазначения.ОбщийМодуль("ОбменДаннымиЗарплата30Бухгалтерия21");
		Возврат Модуль.ОбменИспользуется(Организация);
		
	КонецЕсли;
	// Конец ЗарплатаКадрыПриложения.ОбменЗарплата30Бухгалтерия21
	
	Возврат Ложь;
	
КонецФункции

Процедура ЗаполнитьНачислениеОценочныхОбязательствПоОтпускам(ПараметрыЗаполнения, АдресХранилища) Экспорт
	
	ЭтотОбъект = ПараметрыЗаполнения.Объект;
	РезервОтпусков.ЗаполнитьДокументНачислениеОценочныхОбязательствПоОтпускам(ЭтотОбъект);
	
	Результат = Новый Структура("ЗаданиеВыполнено, Объект, ИмяТаблицы", Истина, ЭтотОбъект, ПараметрыЗаполнения.ИмяТаблицы);
	ПоместитьВоВременноеХранилище(Результат, АдресХранилища);

КонецПроцедуры

Процедура ПеречитатьОценочныеОбязательства(ПараметрыЗаполнения, АдресХранилища) Экспорт
	
	ЭтотОбъект = ПараметрыЗаполнения.Объект;
	РезервОтпусков.ПеречитатьОценочныеОбязательства(ЭтотОбъект);
	
	Результат = Новый Структура("ЗаданиеВыполнено, Объект, ИмяТаблицы", Истина, ЭтотОбъект, ПараметрыЗаполнения.ИмяТаблицы);
	ПоместитьВоВременноеХранилище(Результат, АдресХранилища);

КонецПроцедуры

#КонецОбласти

#КонецЕсли