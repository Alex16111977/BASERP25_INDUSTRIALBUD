
Процедура _ПроводкиПоЕдиномуНалогуОбработкаПроведения(Источник, Отказ, РежимПроведения) Экспорт
	
	Если УчетнаяПолитика.ПлательщикЕдиногоНалога(Источник.Организация,Источник.Дата) Тогда 
		НаборДвижений = Источник.Движения.КнигаДоходовРасходовПоЕдиномуНалогу; 
		НаборДвижений.Очистить();
		НомерДокумента = "ПВ"+" "+Источник.Номер;    
		Для Каждого СтрокаДвижений Из Источник.Движения.Хозрасчетный Цикл  
			
			Если СтрокаДвижений.СчетКт = ПланыСчетов.Хозрасчетный.ДоходОтОперационнойКурсовойРазницы Тогда 
				
				
				Если НЕ ЗначениеЗаполнено(Источник.Субконто2ДоходовКурсоваяРазница) ИЛИ Источник.Субконто2ДоходовКурсоваяРазница = Справочники.СтатьиНалоговыхДеклараций.ЕННК_ДоходыДоходомНеПризнается Тогда
					Продолжить;
				КонецЕсли;	
				
				Строка = НаборДвижений.Добавить(); 
				Строка.Регистратор = Источник.Ссылка;
				Строка.Период     	  = Источник.Дата;
				Строка.Организация    = СтрокаДвижений.Организация;
				Строка.Статья    	  = Источник.Субконто2ДоходовКурсоваяРазница;
				Строка.Сумма    	  = СтрокаДвижений.Сумма;
				Строка.НомерПлатежногоДокумента = НомерДокумента;
				НаборДвижений.Записывать = Истина; 
				
			КонецЕсли;
			
		КонецЦикла;  
		
	//	НаборДвижений.Зписать();
		
	КонецЕсли;
	
КонецПроцедуры

Процедура _ЗакрытиеМесяцаОбработкаПроведения(Источник, Отказ, РежимПроведения) Экспорт    
	Если Источник.РасчетСтоимостиПродукции Тогда   
				
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ХозрасчетныйОстатки.Субконто1 КАК Субконто1,
		|	ХозрасчетныйОстатки.Субконто2 КАК Субконто2,
		|	ХозрасчетныйОстатки.Субконто3 КАК Субконто3,
		|	СУММА(ХозрасчетныйОстатки.СуммаОстатокДт) КАК СуммаОстатокДт,
		|	ХозрасчетныйОстатки.НалоговоеНазначение КАК НалоговоеНазначение
		|ИЗ
		|	РегистрБухгалтерии.Хозрасчетный.Остатки(&ДатаОстатков, Счет = &Счет231, , Организация = &Организация) КАК ХозрасчетныйОстатки
		|
		|СГРУППИРОВАТЬ ПО
		|	ХозрасчетныйОстатки.Субконто2,
		|	ХозрасчетныйОстатки.Субконто1,
		|	ХозрасчетныйОстатки.НалоговоеНазначение,
		|	ХозрасчетныйОстатки.Субконто3";
	МомВрем = Источник.Ссылка;
	Запрос.УстановитьПараметр("ДатаОстатков", КонецМесяца(Источник.Дата)+1);
	Запрос.УстановитьПараметр("Организация", Источник.Организация);
	Запрос.УстановитьПараметр("Счет231", ПланыСчетов.Хозрасчетный.ОсновноеПроизводство);
	
	Выборка = Запрос.Выполнить().Выбрать();
	НаборДвижений = Источник.Движения.Хозрасчетный; 
	Пока Выборка.Следующий() Цикл  
		НоваяПроводка = НаборДвижений.Добавить();
		НоваяПроводка.Организация = Источник.Организация;
		НоваяПроводка.Активность  = Истина;  
		НоваяПроводка.регистратор = источник.Ссылка;
		НоваяПроводка.Период      = Источник.Дата;
		НоваяПроводка.Содержание  = НСтр("ru='Корректировка выпуска продукции (услуг)';uk='Коригування випуску продукції (послуг)'",Локализация.КодЯзыкаИнформационнойБазы());
		
		НоваяПроводка.Сумма       = Выборка.СуммаОстатокДт; 
		НоваяПроводка.НалоговоеНазначениеДт = Выборка.НалоговоеНазначение;   
		НоваяПроводка.НалоговоеНазначениеКт = Выборка.НалоговоеНазначение;
		НоваяПроводка.СчетДт = ПланыСчетов.Хозрасчетный.СебестоимостьРеализованнойГотовойПродукции;
		БухгалтерскийУчет.УстановитьСубконто( НоваяПроводка.СчетДт, НоваяПроводка.СубконтоДт, 1, Выборка.Субконто2);
		БухгалтерскийУчет.УстановитьСубконто( НоваяПроводка.СчетДт, НоваяПроводка.СубконтоДт, 2, Выборка.Субконто3);
		//БухгалтерскийУчет.УстановитьСубконто( НоваяПроводка.СчетДт, НоваяПроводка.СубконтоДт, 3, Обход.СубконтоСписания3);
		
		НоваяПроводка.СчетКт = ПланыСчетов.Хозрасчетный.ОсновноеПроизводство;
		//БухгалтерскийУчет.УстановитьСубконто( НоваяПроводка.СчетКт, НоваяПроводка.СубконтоКт, "Подразделения",        Обход.Подразделение);
		//БухгалтерскийУчет.УстановитьСубконто( НоваяПроводка.СчетКт, НоваяПроводка.СубконтоКт, "НоменклатурныеГруппы", Обход.НоменклатурнаяГруппа);
		БухгалтерскийУчет.УстановитьСубконто( НоваяПроводка.СчетКт, НоваяПроводка.СубконтоКт, 1, Выборка.Субконто1);
		БухгалтерскийУчет.УстановитьСубконто( НоваяПроводка.СчетКт, НоваяПроводка.СубконтоКт, 2, Выборка.Субконто2);
		БухгалтерскийУчет.УстановитьСубконто( НоваяПроводка.СчетКт, НоваяПроводка.СубконтоКт, 3, Выборка.Субконто3);
	
		
		
	КонецЦикла;
	
	// мПроводкиБУ = Движения.Хозрасчетный;
	ПроведениеСервер.ЗаписатьНаборЗаписейБезЗамещенияТекущихДвижений(НаборДвижений);

	     
	КонецЕсли;

КонецПроцедуры

Процедура _ПередЗаписьюЗПВедомостиПередЗаписью(Источник, Отказ, РежимЗаписи, РежимПроведения) Экспорт
	Источник.СуммаДокумента = Источник.РаботникиОрганизации.Итог("Сумма");
КонецПроцедуры


Процедура _ПередЗаписьюОСПередЗаписью(Источник, Отказ) Экспорт
		
	Если ЗначениеЗаполнено(Источник._Организация) И НЕ ЗначениеЗаполнено(Источник.Код) Тогда  
	//	Источник._Организация = Организация;
		Запрос = Новый Запрос;
		Запрос.Текст = 
		//"ВЫБРАТЬ РАЗРЕШЕННЫЕ ПЕРВЫЕ 1
		//|	ДоговорыКонтрагентов.Номер КАК Номер
		//|ИЗ
		//|	Справочник.ДоговорыКонтрагентов КАК ДоговорыКонтрагентов
		//|ГДЕ
		//|	ДоговорыКонтрагентов._ВидВзаиморасчетов = &ВидВзаиморасчетов
		//|	И ДоговорыКонтрагентов.Номер <> &Пустой
		//|	И ДоговорыКонтрагентов.Ссылка <> &Ссылка
		//|	И ДоговорыКонтрагентов.Номер ПОДОБНО &НомерДокумента
		//|
		//|УПОРЯДОЧИТЬ ПО
		//|	Номер УБЫВ";  
		
		"ВЫБРАТЬ ПЕРВЫЕ 1
		|	ОсновныеСредства.Код КАК Код
		|ИЗ
		|	Справочник.ОсновныеСредства КАК ОсновныеСредства
		|ГДЕ
		|	ОсновныеСредства.Код ПОДОБНО &Код
		|	И ОсновныеСредства.Ссылка <> &Ссылка
		|	И ОсновныеСредства._Организация = &Организация
		|
		|УПОРЯДОЧИТЬ ПО
		|	Код УБЫВ";
		
		Запрос.УстановитьПараметр("Организация", Источник._Организация);  
		//Запрос.УстановитьПараметр("Пустой", "");      
		Запрос.УстановитьПараметр("Ссылка", Источник.Ссылка); 
		Запрос.УстановитьПараметр("Код", Источник._Организация.Префикс+"%"); 

		
		Выборка = Запрос.Выполнить().Выбрать();
		
		Если Выборка.Следующий() Тогда 
			НомерСтрокой = СтрЗаменить(Выборка.Код,Источник._Организация.Префикс+"-","");  
			НомерЧислом = СтроковыеФункцииКлиентСервер.СтрокаВЧисло(НомерСтрокой);  
			Попытка    
				НомерЧисломНовый = НомерЧислом+1;
				Источник.Код = Источник._Организация.Префикс+"-" + СтроковыеФункцииКлиентСервер.ДополнитьСтроку(НомерЧисломНовый,6); 
			Исключение  
				Сообщить(ОписаниеОшибки());
			КонецПопытки;
		Иначе
			Источник.Код = Источник._Организация.Префикс+"-" + СтроковыеФункцииКлиентСервер.ДополнитьСтроку("1",6);
		КонецЕсли;
	//ИначеЕсли НЕ ЗначениеЗаполнено(Источник._Организация)	Тогда  
	//	Отказ = Истина;
	//	Сообщить("Вкажіть організацію!");
		
	КонецЕсли;

КонецПроцедуры
