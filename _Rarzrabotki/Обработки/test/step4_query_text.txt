=== РЕЗУЛЬТАТ КРОКУ 4: ТЕКСТ ЗАПИТУ ===
Дата формування: 2025-11-29

Джерела даних (з кроків 1-3):
- План рахунків: Хозрасчетный
- Рахунки для запасів:
  * Товары (28) - група
  * ПроизводственныеЗапасы (20) - група
  * ГотоваяПродукция (26)
  * МалоценныеИБыстроизнашивающиесяПредметы (22)
- Регістр: Хозрасчетный
- Ресурси: Сумма, Количество, СуммаНУ
- Субконто: Субконто1 (Номенклатура), Субконто2 (Склад)
- Зіставлення: по Коду

ТЕКСТ ЗАПИТУ ДЛЯ ВИКОНАННЯ В BuhBud:
----- початок -----
ВЫБРАТЬ
    Остатки.Счет КАК Счет,
    Остатки.Счет.Код КАК СчетКод,
    Остатки.Организация КАК Организация,
    Остатки.Субконто1 КАК НоменклатураСсылка,
    ВЫРАЗИТЬ(Остатки.Субконто1 КАК Справочник.Номенклатура).Код КАК НоменклатураКод,
    ВЫРАЗИТЬ(Остатки.Субконто1 КАК Справочник.Номенклатура).Наименование КАК НоменклатураНаименование,
    Остатки.Субконто2 КАК СкладСсылка,
    ВЫРАЗИТЬ(Остатки.Субконто2 КАК Справочник.Склады).Код КАК СкладКод,
    ВЫРАЗИТЬ(Остатки.Субконто2 КАК Справочник.Склады).Наименование КАК СкладНаименование,
    Остатки.КоличествоОстатокДт КАК Количество,
    Остатки.СуммаОстатокДт КАК Сумма
ИЗ
    РегистрБухгалтерии.Хозрасчетный.Остатки(
        &ДатаОстатков,
        Счет В ИЕРАРХИИ(ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.Товары))
            ИЛИ Счет В ИЕРАРХИИ(ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПроизводственныеЗапасы))
            ИЛИ Счет В ИЕРАРХИИ(ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ГотоваяПродукция))
            ИЛИ Счет В ИЕРАРХИИ(ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.МалоценныеИБыстроизнашивающиесяПредметы)),
    ) КАК Остатки
ГДЕ
    Остатки.КоличествоОстатокДт > 0
----- кінець -----

ПАРАМЕТРИ ЗАПИТУ:
- ДатаОстатков: КонецДня(ОкончаниеПериода) - дата, на яку отримуємо залишки

ПРИМІТКИ:
1. Запит вибирає залишки з рахунків запасів (28, 20, 26, 22 та їх субрахунків)
2. Фільтр КоличествоОстатокДт > 0 - тільки ненульові залишки
3. Субконто1 = Номенклатура, Субконто2 = Склад (типова конфігурація)
4. ВЫРАЗИТЬ використовується для доступу до реквізитів довідників через субконто

СПРОЩЕНИЙ ВАРІАНТ ЗАПИТУ (без ВЫРАЗИТЬ):
----- початок -----
ВЫБРАТЬ
    Остатки.Счет.Код КАК СчетКод,
    Остатки.Субконто1 КАК НоменклатураСсылка,
    Остатки.Субконто2 КАК СкладСсылка,
    Остатки.КоличествоОстатокДт КАК Количество,
    Остатки.СуммаОстатокДт КАК Сумма
ИЗ
    РегистрБухгалтерии.Хозрасчетный.Остатки(
        &ДатаОстатков,
        Счет В ИЕРАРХИИ(ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.Товары))
            ИЛИ Счет В ИЕРАРХИИ(ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ПроизводственныеЗапасы))
            ИЛИ Счет В ИЕРАРХИИ(ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.ГотоваяПродукция))
            ИЛИ Счет В ИЕРАРХИИ(ЗНАЧЕНИЕ(ПланСчетов.Хозрасчетный.МалоценныеИБыстроизнашивающиесяПредметы)),
    ) КАК Остатки
ГДЕ
    Остатки.КоличествоОстатокДт > 0
----- кінець -----

ОБРОБКА ПОСИЛАНЬ НА СУБКОНТО:
При спрощеному варіанті в колонках НоменклатураСсылка та СкладСсылка
будуть посилання на елементи довідників. Для передачі через COM
та десеріалізації використовується:

стр_ТЗ = V83.ЗначениеВСтрокуВнутр(ТЗОстатки);
ТаблицаОстатков = ЗначениеИзСтрокиВнутр(стр_ТЗ);

Після цього посилання будуть передані як UUID (GUID), які потрібно
зіставити з елементами в базі ERP по Коду:

Для Каждого Строка Из ТаблицаОстатков Цикл
    // Посилання в Строка.НоменклатураСсылка - об'єкт бухгалтерської бази
    // Потрібно отримати Код з бухгалтерії окремим запитом або через властивість
КонецЦикла;

РЕКОМЕНДОВАНИЙ ПІДХІД - з отриманням Коду в запиті:
Використовувати повний варіант запиту, де Код номенклатури та складу
вибираються безпосередньо - це дозволяє уникнути додаткових запитів
при зіставленні.
