
&НаКлиенте
Процедура ЗагрузитьОстатки(Команда)

    // Перевірка заповнення дати
    Если НЕ ЗначениеЗаполнено(Объект.ОкончаниеПериода) Тогда
        ПоказатьПредупреждение(, "Вкажіть дату залишків (Окончание периода)!");
        Возврат;
    КонецЕсли;

    // Підтвердження операції
    ОписаниеОповещения = Новый ОписаниеОповещения("ЗагрузитьОстаткиЗавершение", ЭтотОбъект);
    ПоказатьВопрос(ОписаниеОповещения,
        "Завантажити залишки з бази BuhBud на дату " + Формат(Объект.ОкончаниеПериода, "ДЛФ=D") + "?
        |
        |Поточні дані в табличній частині будуть очищені!",
        РежимДиалогаВопрос.ДаНет,
        ,
        КодВозвратаДиалога.Нет,
        "Завантаження залишків");

КонецПроцедуры

&НаКлиенте
Процедура ЗагрузитьОстаткиЗавершение(Результат, ДополнительныеПараметры) Экспорт

    Если Результат <> КодВозвратаДиалога.Да Тогда
        Возврат;
    КонецЕсли;

    // Показати стан
    Состояние("Завантаження залишків з BuhBud...");

    Попытка
        КоличествоЗагружено = ЗагрузитьОстаткиНаСервере();
        ПоказатьПредупреждение(, "Завантажено " + КоличествоЗагружено + " позицій");
    Исключение
        ПоказатьПредупреждение(, "Помилка: " + ОписаниеОшибки());
    КонецПопытки;

КонецПроцедуры

&НаСервере
Функция ЗагрузитьОстаткиНаСервере()

    ОбъектОбработки = РеквизитФормыВЗначение("Объект");
    ОбъектОбработки.ЗагрузитьОстатки();
    ЗначениеВРеквизитФормы(ОбъектОбработки, "Объект");

    Возврат Объект.Товары.Количество();

КонецФункции

// Обробник ПриСозданииНаСервере - встановлення значень за замовчуванням
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)

    // Встановити поточну дату як дату залишків за замовчуванням
    Если НЕ ЗначениеЗаполнено(Объект.ОкончаниеПериода) Тогда
        Объект.ОкончаниеПериода = КонецМесяца(ТекущаяДатаСеанса());
    КонецЕсли;

КонецПроцедуры

