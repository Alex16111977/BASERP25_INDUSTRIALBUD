Функция ПолучитьЦену(НаДату,Подразделение, Номенклатура=Неопределено) Экспорт 
	УстановитьПривилегированныйРежим(Истина);
	Запрос = Новый Запрос;
	Запрос.Текст=   "ВЫБРАТЬ
	                |	СтоимостьПродукцииСрезПоследних.Цена,
	                |	ВЫБОР
	                |		КОГДА СтоимостьПродукцииСрезПоследних.Подразделение = &Подразделение
	                |				И СтоимостьПродукцииСрезПоследних.Номенклатура = &Номенклатура
	                |			ТОГДА 1
	                |		КОГДА СтоимостьПродукцииСрезПоследних.Подразделение = &Подразделение
	                |			ТОГДА 2
					|		КОГДА СтоимостьПродукцииСрезПоследних.Номенклатура = &Номенклатура
	                |			ТОГДА 3
	                |		ИНАЧЕ 9
	                |	КОНЕЦ КАК Приоритет
	                |ИЗ
	                |	РегистрСведений.СтоимостьПродукции.СрезПоследних(&НаДату, ) КАК СтоимостьПродукцииСрезПоследних
	                |ГДЕ
	                |	(СтоимостьПродукцииСрезПоследних.Подразделение = &Подразделение
	                |			ИЛИ СтоимостьПродукцииСрезПоследних.Подразделение = ЗНАЧЕНИЕ(Справочник.Подразделения.ПустаяСсылка))
	                |	И (СтоимостьПродукцииСрезПоследних.Номенклатура = &Номенклатура
	                |			ИЛИ СтоимостьПродукцииСрезПоследних.Номенклатура = ЗНАЧЕНИЕ(Справочник.Номенклатура.ПустаяСсылка))
	                |
	                |УПОРЯДОЧИТЬ ПО
	                |	Приоритет"   ;
	ЗАпрос.УстановитьПараметр("НаДату",НаДату);
	ЗАпрос.УстановитьПараметр("Подразделение",Подразделение);
	ЗАпрос.УстановитьПараметр("Номенклатура",Номенклатура);
	Выборка = Запрос.Выполнить().Выбрать();
	
	
	Если Выборка.Следующий() Тогда
		Цена  = Выборка.Цена;
	Иначе
		Цена=  0;
	КонецЕсли;
	
	УстановитьПривилегированныйРежим(Ложь);
	
	Возврат Цена;
КонецФункции // ()


