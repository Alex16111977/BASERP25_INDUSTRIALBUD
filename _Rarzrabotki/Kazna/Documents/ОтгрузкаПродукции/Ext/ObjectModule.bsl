
Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
	Если НЕ РольДоступна("ПолныеПрава") Тогда
		//Доступен текущий месяц + 5 дней
		Если НачалоМесяца(Дата)>=НачалоМесяца(ТекущаяДата()) Тогда
		      //ОК
		ИначеЕсли НачалоМесяца(Дата)=НачалоМесяца(ТекущаяДата()-5*60*60*24) Тогда	
			// с 01 по 05 можно редактировать весь прошлый месяц
			
		ИНаче
			//ОбщегоНазначенияКлиентСервер.СообщитьОшибкиПользователю("Запрещено редактировать документ за указанный период",Отказ);
			ОбщегоНазначенияКлиентСервер.СообщитьПользователю( "Запрещено редактировать документ за указанный период",,,,Отказ);
		КонецЕсли;
	КонецЕсли;
КонецПроцедуры

Процедура ОбработкаПроведения(Отказ, Режим)
	//{{__КОНСТРУКТОР_ДВИЖЕНИЙ_РЕГИСТРОВ
	// Данный фрагмент построен конструктором.
	// При повторном использовании конструктора, внесенные вручную изменения будут утеряны!!!

	// регистр БДДС 
	СуммаДокумента=Состав.Итог("Сумма");
	
	Если СуммаДокумента =0 Тогда
		СуммаДокумента =   РегистрыСведений.СтоимостьПродукции.ПолучитьЦену(Дата,ПодразделениеЗаказчик,Неопределено)*Состав.Итог("Количество");
	КонецЕсли;
	
	
	Движения.БДДС.Записывать = Истина;
	Если НЕ СтороннийЗаказчик Тогда
		Движение = Движения.БДДС.Добавить();
		Движение.Период = Дата;
		Движение.Подразделение = Подразделение;
		Движение.ВидОплаты=Перечисления.ВидыДенежныхСредств.Безналичные;
		Движение.ДокументОснование=Ссылка;
		Движение.НаправлениеДДС=Перечисления.НаправленияДвиженийДенежныхСредств.Приход;
		Движение.Направление=НаправлениеДохода;//Справочники.Направления.НайтиПоКоду("000000003");
		Движение.ПланФакт=Ложь;
		Движение.Сумма=  СуммаДокумента;
		Движение.СуммаПриход=  СуммаДокумента;
		Движение.СтатьяДвиженияДенежныхСредств=Справочники.СтатьиДвиженияДенежныхСредств.НайтиПоКоду("УТ-001146");
		
		
		
		
		Движение = Движения.БДДС.Добавить();
		Движение.Период = Дата;
		Движение.Подразделение = ПодразделениеЗаказчик;
		Движение.ВидОплаты=Перечисления.ВидыДенежныхСредств.Безналичные;
		Движение.ДокументОснование=Ссылка;
		Движение.НаправлениеДДС=Перечисления.НаправленияДвиженийДенежныхСредств.Расход;
		Движение.ПланФакт=Ложь;
		Движение.Направление=НаправлениеРасхода;//Направление;
		Движение.Сумма=  СуммаДокумента;
		Движение.СуммаРасход=  СуммаДокумента;
		Движение.СтатьяДвиженияДенежныхСредств=Справочники.СтатьиДвиженияДенежныхСредств.НайтиПоКоду("УТ-001068");
	КонецЕсли;
	
	
	//}}__КОНСТРУКТОР_ДВИЖЕНИЙ_РЕГИСТРОВ
КонецПроцедуры
