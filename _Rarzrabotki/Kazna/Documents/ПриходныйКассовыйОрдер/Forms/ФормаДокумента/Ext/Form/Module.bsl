&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
		
	ВерсионированиеОбъектов.ПриСозданииНаСервере(ЭтотОбъект);
    ВидимостьФинАгента();//Тютюн
КонецПроцедуры

&НаКлиенте
Процедура УстановитьВидимостьДоступность()
	
	Элементы.Организация.Видимость	= Объект.ВидОперации = ПредопределенноеЗначение("Перечисление.ВидыОперацийПКО.ПоступлениеСРасчетногоСчета");
	Элементы.СтатьяДвиженияДенежныхСредств.Доступность	=
	(Не Объект.ВидОперации = ПредопределенноеЗначение("Перечисление.ВидыОперацийПКО.ПоступлениеСРасчетногоСчета"))
	ИЛИ локРольДоступна("ПолныеПрава");
	Элементы.КассаОтправитель.Видимость	= Объект.ВидОперации = ПредопределенноеЗначение("Перечисление.ВидыОперацийПКО.ПеремещениеДС");
	
КонецПроцедуры

&НаКлиенте
Процедура ВидОперацииПриИзменении(Элемент)
	
	ВидОперацииПриИзмененииНаСервере();
	УстановитьВидимостьДоступность();
	
КонецПроцедуры

&НаСервере
Процедура ВидОперацииПриИзмененииНаСервере()
	
	Если Объект.ВидОперации = Перечисления.ВидыОперацийПКО.ПоступлениеСРасчетногоСчета Тогда
		Объект.СтатьяДвиженияДенежныхСредств = Константы.СтатьяТранзитНал.Получить();
	КонецЕсли;
	ПодразделениеПриИзмененииНаСервере();
	
КонецПроцедуры

&НаКлиенте
Процедура ПодразделениеПриИзменении(Элемент)
	ПодразделениеПриИзмененииНаСервере();
КонецПроцедуры

&НаСервере
Процедура ПодразделениеПриИзмененииНаСервере()
	Справочники.Подразделения.ЗаполнитьСписокВыбора(Элементы.Подразделение);
	Справочники.Секции.ЗаполнитьСписокСекций(Элементы.Секция, Объект.Подразделение, Ложь);
	Справочники.Кассы.ЗаполнитьСписокВыбора(Элементы.Касса, Объект.Подразделение);
	Если Объект.ВидОперации=Перечисления.ВидыОперацийПКО.ПеремещениеДС Тогда
		Справочники.Кассы.ЗаполнитьСписокВыбора(Элементы.КассаОтправитель, Неопределено);
	КонецЕсли; 
КонецПроцедуры

Функция локРольДоступна(ТекРоль)
	Возврат РольДоступна(ТекРоль);
КонецФункции // ()

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
	УстановитьВидимостьДоступность();
	ПодразделениеПриИзмененииНаСервере();
	
КонецПроцедуры

&НаКлиенте
Процедура КассаОтправительНачалоВыбораПродолжить(ВыбранныйЭлемент, ДополнительныеПараметры) Экспорт
	Объект.КассаОтправитель = ВыбранныйЭлемент.Значение;
КонецПроцедуры

&НаКлиенте
Процедура КассаОтправительНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	СтандартнаяОбработка = Ложь;
	ПоказатьВыборИзСписка(Новый ОписаниеОповещения("КассаОтправительНачалоВыбораПродолжить", ЭтаФорма),
		Элемент.СписокВыбора, Элемент, Элемент.СписокВыбора.НайтиПоЗначению(Объект.КассаОтправитель));
КонецПроцедуры
 //Тютюн
&НаКлиенте
Процедура СтатьяДвиженияДенежныхСредствПриИзменении(Элемент)
	ВидимостьФинАгента(); 
КонецПроцедуры

&НаСервере
Процедура ВидимостьФинАгента();  
	Если Объект.СтатьяДвиженияДенежныхСредств = Справочники.СтатьиДвиженияДенежныхСредств.НайтиПоКоду("УТ-001082") ТОгда    
		Элементы.ГруппаФинАгенты.Видимость = Истина;
	Иначе 
		Элементы.ГруппаФинАгенты.Видимость = Ложь; 
	КонецЕсли;
КонецПроцедуры 


&НаСервере
Процедура ПередЗаписьюНаСервере(Отказ, ТекущийОбъект, ПараметрыЗаписи)
	Если Объект.СтатьяДвиженияДенежныхСредств = Справочники.СтатьиДвиженияДенежныхСредств.НайтиПоКоду("УТ-001082") 
		И НЕ Значениезаполнено(Объект._ФинАгент) Тогда 
		Отказ = Истина;
		Сообщить("Не указан Фин агент");
	КонецЕсли;	
	КонецПроцедуры


&НаСервере
	Процедура ПриЧтенииНаСервере(ТекущийОбъект)
		ДатыЗапретаИзменения.ОбъектПриЧтенииНаСервере(ЭтаФорма, ТекущийОбъект);  
		Этаформа.ТолькоПросмотр = ДопМодуль.ПроверитьОтветственного(Объект.Ответственный);
	КонецПроцедуры
 //КонецИзменений
