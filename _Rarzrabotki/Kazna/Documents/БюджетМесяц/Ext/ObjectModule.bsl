
Процедура ОбработкаЗаполнения(ДанныеЗаполнения, СтандартнаяОбработка)
	
	Ответственный= Пользователи.ТекущийПользователь();
	
	ВидВерсии= Перечисления.ВидыВерсийБюджетов.Первичный;
	ВидПериода=Перечисления.ВидыПериодовБюджетирования.Неделя;
КонецПроцедуры

Процедура ОбработкаПроведения(Отказ, РежимПроведения)
	
	Движения.БюджетыНаМесяц.Записывать = Истина;
	
	Для Каждого Строка Из Показатели Цикл
		Движение	= Движения.БюджетыНаМесяц.Добавить();
		Движение.Регистратор		= Ссылка;
		Движение.Период				= Дата;
		Движение.Подразделение		= Подразделение;//Строка.Подразделение;
		Движение.ПоказательБюджета	= Строка.ПоказательБюджета;
		Движение.Месяц				= НачалоМесяца(Месяц);
		Движение.НаправлениеДДС		= Строка.НаправлениеДДС;
		Движение.Сумма				= Строка.Сумма;
		Движение.Направление=Направление;
	КонецЦикла;
	
	
	Для Каждого Строка Из ПоказателиБДДС Цикл
		Движение	= Движения.БюджетыНаМесяц.Добавить();
		Движение.Регистратор		= Ссылка;
		Движение.Период				= Дата;
		Движение.Подразделение		= Подразделение;//Строка.Подразделение;
		Движение.ПоказательБюджета	= Строка.ПоказательБюджета;
		Если ВидПериода= Перечисления.ВидыПериодовБюджетирования.Неделя Тогда
			Движение.Месяц				= НачалоНедели(Месяц);	
		Иначе	
		     Движение.Месяц				= НачалоМесяца(Месяц);
		КонецЕсли;
		//Движение.НаправлениеДДС		= Строка.НаправлениеДДС;
		Движение.ВидОплаты				= Строка.ВидОплаты;
		Движение.Сумма				= Строка.Сумма  ;
		Движение.ВидПериода				= ВидПериода ;
		Если ЗначениеЗаполнено(Направление) Тогда
			Движение.Направление=Направление;
		КонецЕсли;
	КонецЦикла;
	
	Если ВидВерсии=Перечисления.ВидыВерсийБюджетов.Корректировка Тогда
		
		Для Каждого Строка Из ДокументОснование.Показатели Цикл
			Движение	= Движения.БюджетыНаМесяц.Добавить();
			Движение.Регистратор		= Ссылка;
			Движение.Период				= ДокументОснование.Дата;
			Движение.Подразделение		= Подразделение;//Строка.Подразделение;
			Движение.ПоказательБюджета	= Строка.ПоказательБюджета;
			Движение.Месяц				= НачалоМесяца(ДокументОснование.Месяц);
			Движение.НаправлениеДДС		= Строка.НаправлениеДДС;
			Движение.Сумма				= -Строка.Сумма;
			Движение.Направление=Направление;
		КонецЦикла;
		
		Для Каждого Строка Из ДокументОснование.ПоказателиБДДС Цикл
			Движение	= Движения.БюджетыНаМесяц.Добавить();
			Движение.Регистратор		= Ссылка;
			Движение.Период				= ДокументОснование.Дата;
			Движение.Подразделение		= Подразделение;//Строка.Подразделение;
			Движение.ПоказательБюджета	= Строка.ПоказательБюджета;
			Если ВидПериода= Перечисления.ВидыПериодовБюджетирования.Неделя Тогда
				Движение.Месяц				= НачалоНедели(ДокументОснование.Месяц);	
			Иначе	
				Движение.Месяц				= НачалоМесяца(ДокументОснование.Месяц);
			КонецЕсли;
			//Движение.НаправлениеДДС		= Строка.НаправлениеДДС;
			Движение.ВидОплаты				= Строка.ВидОплаты;
			Движение.Сумма				= -Строка.Сумма  ;
			Движение.ВидПериода				= ВидПериода ;
			Движение.Направление=Направление;
		КонецЦикла;
		
		
		
	КонецЕсли;   
	
	//Тютюн   
			Движения.ЛимитыНаМесяц.Записывать = Истина;
		
	Если Лимит Тогда    
		ДЛя Каждого Строка Из ПоказателиБДДС Цикл
			
			Движение           	= Движения.ЛимитыНаМесяц.Добавить(); 
			Движение.ВидДвижения = ВидДвиженияНакопления.Приход;
			Движение.Регистратор		= Ссылка;
			Движение.Период				= Дата;
			Движение.Месяц				= НачалоМесяца(Дата);
			Движение.Подразделение		= Строка.Подразделение;
			Движение.ПоказательБюджета	= Строка.ПоказательБюджета;
			Движение.Сумма				= Строка.Сумма;
			  
		КонецЦикла;	

		
	КонецЕсли;
	//КонецИзменений
	
КонецПроцедуры

Процедура ПроверитьЗаполнениеОбязательныхРевизитов(Отказ)
	
	МассивПроверяемыхРеквизитов = Новый Массив;
	МассивПроверяемыхРеквизитов.Добавить("Подразделение");
	МассивПроверяемыхРеквизитов.Добавить("Месяц");
	
	АХ_ОбщегоНазначения.КонтрольЗаполненияОбязательныхРеквизитовШапкиОбъекта(ЭтотОбъект, МассивПроверяемыхРеквизитов, Отказ);
	
КонецПроцедуры

Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
	Если не ЗначениеЗаполнено(ВидВерсии) Тогда
		ВидВерсии= Перечисления.ВидыВерсийБюджетов.Первичный;
	КонецЕсли;
	
	Если не ЗначениеЗаполнено(ВидПериода) Тогда
		ВидПериода=Перечисления.ВидыПериодовБюджетирования.Неделя;
	КонецЕсли;

КонецПроцедуры

Процедура ПриКопировании(ОбъектКопирования)
	ДокументОснование=Документы.БюджетМесяц.ПустаяСсылка();
КонецПроцедуры
