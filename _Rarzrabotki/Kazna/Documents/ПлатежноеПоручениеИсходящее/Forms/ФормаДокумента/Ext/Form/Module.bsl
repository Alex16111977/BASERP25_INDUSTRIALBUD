&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
		
	// СтандартныеПодсистемы.ВерсионированиеОбъектов
	ВерсионированиеОбъектов.ПриСозданииНаСервере(ЭтотОбъект);
	// Конец СтандартныеПодсистемы.ВерсионированиеОбъектов	
    ВидимостьФинАгента();
КонецПроцедуры

&НаКлиенте
Процедура ПодразделениеПриИзменении(Элемент)
	ПодразделениеПриИзмененииНаСервере();
КонецПроцедуры

&НаСервере
Процедура ПодразделениеПриИзмененииНаСервере()
	Справочники.Секции.ЗаполнитьСписокСекций(Элементы.Секция, Объект.Подразделение, Ложь);
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	ПодразделениеПриИзмененииНаСервере();
КонецПроцедуры

//Тютюн ФинАгент
&НаКлиенте
Процедура СтатьяДвиженияДенежныхСредствПриИзменении(Элемент)
	ВидимостьФинАгента()  ;
КонецПроцедуры     

&НаСервере
Процедура ВидимостьФинАгента();  
	Если Объект.СтатьяДвиженияДенежныхСредств = Справочники.СтатьиДвиженияДенежныхСредств.НайтиПоКоду("УТ-001096") ТОгда    
		Элементы.ГруппаФинАгенты.Видимость = Истина;
	Иначе 
		Элементы.ГруппаФинАгенты.Видимость = Ложь; 
	КонецЕсли;
КонецПроцедуры    

&НаСервере
Процедура ПередЗаписьюНаСервере(Отказ, ТекущийОбъект, ПараметрыЗаписи)
	Если Объект.СтатьяДвиженияДенежныхСредств = Справочники.СтатьиДвиженияДенежныхСредств.НайтиПоКоду("УТ-001096") ТОгда  
		Если Не ЗначениеЗаполнено(Объект._ФинАгент) ИЛИ Не ЗначениеЗаполнено(Объект._ПроцентФинАгента)
			ИЛИ Не ЗначениеЗаполнено(Объект._ДатаВозвратаФинАгента)ТОгда   
			Отказ = Истина;
			Сообщить("Заполните данные фин агента");
		Иначе
			РаспределитьСуммы(ТекущийОбъект);
		КонецЕсли; 
		
	КонецЕсли;	 
	
		
КонецПроцедуры   

Процедура РаспределитьСуммы(ТекущийОбъект);  
	
//	Если ТекущийОбъект.Расшифровка.Итог("Сумма") <> ТекущийОбъект.СуммаДокумента Тогда   
		ТекущийОбъект.Расшифровка.Очистить();
		СтрокаКомиссии = ТекущийОбъект.Расшифровка.Добавить();
		СтрокаКомиссии.Подразделение                 = ТекущийОбъект.Подразделение; 
		СтрокаКомиссии.Направление                   = ТекущийОбъект.Направление; 
		СтрокаКомиссии.НеОтражатьВДДС                = Истина;
		СуммаКомиссии                                = Формат(ТекущийОбъект.СуммаДокумента * ТекущийОбъект._ПроцентФинАгента/100,"ЧДЦ=2"); 
		СтрокаКомиссии.Сумма                         = СуммаКомиссии;
		СтрокаКомиссии.СтатьяДвиженияДенежныхСредств = Справочники.СтатьиДвиженияДенежныхСредств.НайтиПоКоду("УТ-001097");	
		
		СтрокаФинАгент = ТекущийОбъект.Расшифровка.Добавить();
		СтрокаФинАгент.Подразделение = ТекущийОбъект.Подразделение; 
		СтрокаФинАгент.Направление = ТекущийОбъект.Направление; 
		СтрокаФинАгент.Сумма = ТекущийОбъект.СуммаДокумента - СуммаКомиссии; 
		СтрокаФинАгент.СтатьяДвиженияДенежныхСредств = ТекущийОбъект.СтатьяДвиженияДенежныхСредств;
		
//	КонецЕсли;
	
	
	
КонецПроцедуры

&НаСервере
Процедура ПриЧтенииНаСервере(ТекущийОбъект)
	// СтандартныеПодсистемы.ДатыЗапретаИзменения
	ДатыЗапретаИзменения.ОбъектПриЧтенииНаСервере(ЭтаФорма, ТекущийОбъект);  
	
	Если НЕ РольДоступна("ПолныеПрава") Тогда 
		Этаформа.ТолькоПросмотр = ДопМодуль.ПроверитьОтветственного(Объект.Ответственный);
	КонецЕсли;
	// Конец СтандартныеПодсистемы.ДатыЗапретаИзменения
КонецПроцедуры




//КонецИзменений

