&НаСервере
Процедура СуммаДокументаПриИзмененииНаСервере()
	
	Если Объект.СуммаДокумента>Объект.СчетНаОплатуПоставщика.СуммаДокумента Тогда
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю("Сумма заявки не может превышать сумму счета", Объект.Ссылка, "СуммаДокумента", "СуммаДокумента");
		Объект.СуммаДокумента = Объект.СчетНаОплатуПоставщика.СуммаДокумента;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура СуммаДокументаПриИзменении(Элемент)
	СуммаДокументаПриИзмененииНаСервере();
КонецПроцедуры

&НаКлиенте
Процедура СчетНаОплатуПоставщикаПриИзменении(Элемент)
	СчетНаОплатуПоставщикаПриИзмененииНаСервере();
	УстановитьВидимость();
КонецПроцедуры

&НаСервере
Процедура СчетНаОплатуПоставщикаПриИзмененииНаСервере()
	
	лДок = РеквизитФормыВЗначение("Объект");
	
	ЗаполнитьЗначенияСвойств(лДок, лДок.СчетНаОплатуПоставщика, "ВалютаДокумента,ВидОплаты,Контрагент,НазначениеПлатежа,Организация,ПлановаяДатаОплаты,Подразделение,СтатьяДвиженияДенежныхСредств,СуммаДокумента,СчетКонтрагента" );
	//СтруктурнаяЕдиница = ?(ДанныеЗаполнения.ВидОплаты = Перечисления.ВидыДенежныхСредств.Безналичные, Организация.ОсновнойБанковскийСчет, Организация.ОсновнаяКасса);
	
	ЗначениеВРеквизитФормы(лДок, "Объект");
	
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	// СтандартныеПодсистемы.ВерсионированиеОбъектов
	ВерсионированиеОбъектов.ПриСозданииНаСервере(ЭтотОбъект);
	// Конец СтандартныеПодсистемы.ВерсионированиеОбъектов	
	
	УстановитьВидимость();
	
КонецПроцедуры

&НаСервере
Процедура УстановитьВидимость()
	
	лДоступно = НЕ ЗначениеЗаполнено(Объект.СчетНаОплатуПоставщика);
	Если РольДоступна("ПолныеПрава") Тогда
	  лДоступно=Истина;
	КонецЕсли;
	лРеквизиты = Новый Структура("Подразделение,СтатьяДвиженияДенежныхСредств,ВидОплаты,Организация,Контрагент");
	Для Каждого лСтрока ИЗ лРеквизиты Цикл
		Элементы[лСтрока.Ключ].ТолькоПросмотр = НЕ лДоступно;//Доступность 
	КонецЦикла;  
	
	ВидимостьФинАгента(); //Тютюн

	
КонецПроцедуры

&НаКлиенте
Процедура ПодразделениеПриИзменении(Элемент)
	ПодразделениеПриИзмененииНаСервере();
КонецПроцедуры

&НаСервере
Процедура ПодразделениеПриИзмененииНаСервере()
	Справочники.Секции.ЗаполнитьСписокСекций(Элементы.Секция, Объект.Подразделение, Ложь);
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
	Если Не ЗначениеЗаполнено(Объект.Ссылка)
		И Объект.СуммаДокумента=0
		И ЗначениеЗаполнено(Объект.ДокументОснование) Тогда 
		Отказ = Истина;
		ПоказатьПредупреждение(, "Вы пытаетесь создать заявку, хотя лимит денежных средств на нее равен нулю. Вероятно ваш счет не утвержден, либо он уже полностью оплачен другими заявками.", 20, "Нельзя создать заявку");
		Возврат;
	КонецЕсли;
	
	//Слав нач
	//Временно добаляется доступность на исзменение счета входящего
	Если ДоступностьИзмененияСчетаНаОплатуПоставщикаВЗаявке() тогда
		Элементы.СчетНаОплатуПоставщика.ТолькоПросмотр = Ложь;
	КонецЕсли;
	//Слав кон
	
	ПодразделениеПриИзмененииНаСервере();
	
КонецПроцедуры

&НаСервере
Функция ДоступностьИзмененияСчетаНаОплатуПоставщикаВЗаявке()
	Возврат РольДоступна("ДоступностьИзмененияСчетаНаОплатуПоставщикаВЗаявке");
КонецФункции
 //Тютюн ФинАгент видимость
&НаКлиенте
Процедура СтатьяДвиженияДенежныхСредствПриИзменении(Элемент)
	ВидимостьФинАгента();
КонецПроцедуры 

&НаСервере
Процедура ВидимостьФинАгента();  
	Если Объект.СтатьяДвиженияДенежныхСредств = Справочники.СтатьиДвиженияДенежныхСредств.НайтиПоКоду("УТ-001096") ТОгда    
		Элементы.ГруппаФинАгенты.Видимость = Истина;
	Иначе 
		Элементы.ГруппаФинАгенты.Видимость = Ложь; 
	КонецЕсли;   
	Если Объект.СчетНаОплатуПоставщика.ВидОперации = Перечисления.ВидыОперацийСчетНаОплатуПоставщику.Перемещение Тогда  
		Элементы.ФормаСоздатьПриходРасход.Видимость = Истина;
	Иначе
		Элементы.ФормаСоздатьПриходРасход.Видимость = Ложь;
	КонецЕсли;
	
КонецПроцедуры    

&НаСервере
Процедура ПриЧтенииНаСервере(ТекущийОбъект)
	ДатыЗапретаИзменения.ОбъектПриЧтенииНаСервере(ЭтаФорма, ТекущийОбъект);
КонецПроцедуры

&НаКлиенте
Процедура СоздатьПриходРасход(Команда)    
	
	 // Создание документа ПриходныйКассовыйОрдер
    ПараметрыПКО = Новый Структура;
    ПараметрыПКО.Вставить("Основание", Объект.Ссылка); 
    ОткрытьФорму("Документ.ПриходныйКассовыйОрдер.ФормаОбъекта", ПараметрыПКО, ЭтотОбъект);

	
       // Создание документа РасходныйКассовыйОрдер
    ПараметрыРКО = Новый Структура;
    ПараметрыРКО.Вставить("Основание", Объект.Ссылка); 
    ОткрытьФорму("Документ.РасходныйКассовыйОрдер.ФормаОбъекта", ПараметрыРКО, ЭтотОбъект);
    
   

КонецПроцедуры
//КОнецИзменений

