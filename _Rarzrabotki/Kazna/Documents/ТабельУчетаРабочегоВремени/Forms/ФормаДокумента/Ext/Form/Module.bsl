
&НаКлиенте
Процедура НачДатаПриИзменении(Элемент)
	УстановитьВидимостьИЗаголовкиКолонок();
КонецПроцедуры

&НаКлиенте
Процедура КонДатаПриИзменении(Элемент)
	УстановитьВидимостьИЗаголовкиКолонок();
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	//Вставить содержимое обработчика
	Если Не ЗначениеЗаполнено(Объект.Дата) Тогда
		Объект.Дата=ТекущаяДата();
		Объект.НачДата=НачалоМесяца(Объект.Дата);
		Объект.КОнДата=КонецМесяца(Объект.Дата);
	КонецЕсли;
	УстановитьВидимостьИЗаголовкиКолонок();
КонецПроцедуры


Процедура УстановитьВидимостьИЗаголовкиКолонок() Экспорт
	
	УстановитьПривилегированныйРежим(Истина);
	МожноРедактироватьВсеДаные=РольДоступна("ПолныеПрава") ИЛИ РольДоступна("ТабелированиеАдминистратор");
	
	//** Ограничения на реквизиты шапки
	Если ЗначениеЗаполнено(Объект.БригадаСпр) Тогда
		Элементы.БригадаСпр.ТолькоПросмотр= НЕ МожноРедактироватьВсеДаные;
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Объект.Подразделение) Тогда
		Элементы.Подразделение.ТолькоПросмотр= НЕ МожноРедактироватьВсеДаные;
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Объект.НачДата) Тогда
		Элементы.НачДата.ТолькоПросмотр= НЕ МожноРедактироватьВсеДаные;
	КонецЕсли;
	
	Если ЗначениеЗаполнено(Объект.КонДата) Тогда
		Элементы.КонДата.ТолькоПросмотр= НЕ МожноРедактироватьВсеДаные;
	КонецЕсли;
	
	
	
	//Элементы.ОтработанноеВремя.Видимость=МожноРедактироватьВсеДаные;
	Элементы.ОтработанноеВремяСтавка.Видимость=МожноРедактироватьВсеДаные;
	Элементы.ОтработанноеВремяФОТ.Видимость=МожноРедактироватьВсеДаные;
	Элементы.ОтработанноеВремяВсегоГрн.Видимость=МожноРедактироватьВсеДаные;
	
	ВыводитьОборудование = Объект.Подразделение.ИспользоватьОборудование ИЛИ  Объект.БригадаСпр.ИспользоватьОборудование;
	Если ЗначениеЗаполнено(Объект.НачДата) И ЗначениеЗаполнено(Объект.КонДата) Тогда
		ТекДата =Объект.НачДата;
		Сч=1;
		Пока ТекДата<=Объект.КонДата Цикл
			Если Сч>31 Тогда
				Сообщить("Некорректный период табеля, больше месяца");
				УстановитьПривилегированныйРежим(Ложь);
				Возврат;
			КонецЕсли;
			
			Элементы["ОтработанноеВремяПервыйЧасов"+Сч].Заголовок = Сч;	
			Элементы["ОтработанноеВремя1ВторойЧасов"+Сч].Заголовок = Сч;	
			Элементы["ОтработанноеВремяПервыйЧасов"+Сч].Ширина = 4;	
			
			//**Если ТекДата+60*60*24*1<НачалоДня(ТекущаяДата()) Тогда
			Если ТекДата+60*60*Константы.КоличествоЧасовДляРедактированияТабеля.Получить()<НачалоДня(ТекущаяДата()) Тогда
				Элементы["ОтработанноеВремяПервыйЧасов"+Сч].ТолькоПросмотр= НЕ МожноРедактироватьВсеДаные;
				Элементы["ОтработанноеВремя1ВторойЧасов"+Сч].ТолькоПросмотр= НЕ МожноРедактироватьВсеДаные;
			КонецЕсли;
			
			Попытка
				Элементы["ОтработанноеВремяГруппа"+Сч].Заголовок = Сч;	
				Элементы["ОтработанноеВремяЧетвертыйВидВремени"+Сч].Видимость=ВыводитьОборудование;	
				Если ВыводитьОборудование Тогда
					Элементы["ОтработанноеВремяЧетвертыйВидВремени"+Сч].Заголовок = "Обор";	
					Элементы["ОтработанноеВремяЧетвертыйВидВремени"+Сч].МаксимальнаяШирина = 5;	
					Элементы["ОтработанноеВремяПервыйЧасов"+Сч].МаксимальнаяШирина = 5;	
				КонецЕсли;
			Исключение
				
			КонецПопытки;
			
			
			
			ТекДата=ТекДата+60*60*24;
			сч=Сч+1;
		КонецЦикла;
		
		Пока Сч<=31  Цикл
			Элементы["ОтработанноеВремяГруппа"+Сч].Видимость = Ложь;
			Элементы["ОтработанноеВремяПервыйЧасов"+Сч].Видимость = Ложь;
			Элементы["ОтработанноеВремя1ВторойЧасов"+Сч].Видимость = Ложь;
			сч=Сч+1;
		КонецЦикла;
	Иначе	
		Элементы.ОтработанноеВремя.Видимость=Ложь;
	КонецЕсли;
	
	
	УстановитьПривилегированныйРежим(Ложь);
	
КонецПроцедуры

&НаКлиенте
Процедура ДатаПриИзменении(Элемент)
	Объект.НачДата=НачалоМесяца(Объект.Дата);
	Объект.КОнДата=КонецМесяца(Объект.Дата);
	УстановитьВидимостьИЗаголовкиКолонок();
КонецПроцедуры

&НаСервере
Процедура ОтработанноеВремяПриИзмененииНаСервере()
	
	
КонецПроцедуры

&НаКлиенте
Процедура ОтработанноеВремяПриИзменении(Элемент)
	ТекДанные= Элементы.ОтработанноеВремя.ТекущиеДанные;
	Если Найти(Элемент.Имя	,"ПервыйЧасов") Тогда
		//Проверка на допустиые значения
	КонецЕсли;
	
	ИтогоЧасов = 0;
	Для Сч=1 По 31 Цикл
		Попытка
			ТекЧисло = Число(ТекДанные["ПервыйЧасов"+Сч]);
		Исключение
			ТекЧисло =0;
		КонецПопытки;
		ИтогоЧасов =ИтогоЧасов + ТекЧисло ;
	КонецЦикла;
	ТекДанные.ВсегоЧасов=  ИтогоЧасов;
	ТекДанные.ВсегоГрн= ТекДанные.Ставка* ИтогоЧасов-ТекДанные.ФОТ;
	//ОтработанноеВремяПриИзмененииНаСервере();
КонецПроцедуры

&НаКлиенте
Процедура ОтработанноеВремяПриОкончанииРедактирования(Элемент, НоваяСтрока, ОтменаРедактирования)
	// Вставить содержимое обработчика.
	
КонецПроцедуры

&НаКлиенте
Процедура ОтработанноеВремяПередОкончаниемРедактирования(Элемент, НоваяСтрока, ОтменаРедактирования, Отказ)
	// Вставить содержимое обработчика.
	ТекДанные= Элементы.ОтработанноеВремя.ТекущиеДанные;
	ИмяКолонки = СтрЗаменить(Элементы.ОтработанноеВремя.ТекущийЭлемент.Имя,"ОтработанноеВремя","");
	Если Найти(ИмяКолонки,"ПервыйЧасов") Тогда
		//Проверка на допустиые значения
		текЗначение =СОКРЛП(ВРЕГ( ТекДанные[ИмяКолонки]));
		
		Если текЗначение=""  ИЛИ текЗначение="О"  ИЛИ текЗначение="В"  ИЛИ текЗначение="Н"  ИЛИ текЗначение="Б" ИЛИ текЗначение="Д" ИЛИ текЗначение="К" ИЛИ текЗначение="С" ИЛИ (текЗначение>="0" И текЗначение<="9") Тогда
			//ОК
		ИНАЧЕ 	
			Предупреждение("Можно вносить только О, Б, Н, В, Д, К, С, 8",15);
			ТекДанные[ИмяКолонки]="";
			//Отказ=Истина;
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ОтработанноеВремяПередУдалением(Элемент, Отказ)
	// Вставить содержимое обработчика.
	Отказ =НЕ МожноРедактироватьВсеДаные();
КонецПроцедуры

&НаСервере
Функция МожноРедактироватьВсеДаные()
	
	Возврат РольДоступна("ПолныеПрава") ИЛИ РольДоступна("ТабелированиеАдминистратор");
	
КонецФункции // ()


&НаКлиенте
Процедура ОтработанноеВремяПередНачаломИзменения(Элемент, Отказ)
	//
	//ТекДанные= Элементы.ОтработанноеВремя.ТекущиеДанные;
	//ИмяКолонки = СтрЗаменить(Элементы.ОтработанноеВремя.ТекущийЭлемент.Имя,"ОтработанноеВремя","");
	//Если Найти(ИмяКолонки,"ПервыйЧасов") Тогда
	//	
	//	текЗначение =СОКРЛП(ВРЕГ( ТекДанные[ИмяКолонки]));
	//	ТекПараметры = Новый Структура("Сотрудник,Оборудование,ТекДата,ТекЧасов", ТекДанные["Сотрудник"],ТекДанные["Сотрудник"],1,текЗначение);
	//	ОткрытьФорму("Документ.ТабельУчетаРабочегоВремени.Форма.ФормаВводаОборудования",
	//	,
	//	ЭтаФорма,
	//	УникальныйИдентификатор,
	//	ВариантОткрытияОкна.ОтдельноеОкно,
	//	,
	//	Новый ОписаниеОповещения("ВставитьИзФормыВвыодОборудования",ЭтотОбъект),
	//	РежимОткрытияОкнаФормы.БлокироватьОкноВладельца);
	//	Отказ=Истина;
	//КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура ВставитьИзФормыВвыодОборудования(Рез,Доп) экспорт
	Если ТипЗнч(Рез)= Тип("Массив") Тогда
		//Для каждого Стр Из Рез Цикл
		//	Стр2 = Объект.Услуги.Добавить();
		//	ЗаполнитьЗначенияСвойств(Стр2,Стр);
		//	Стр2.СтавкаНДС = ПредопределенноеЗначение("Перечисление.СтавкиНДС.НДС20");
		//	Стр2.СуммаНДС = УчетНДС.РассчитатьСуммуНДС(Стр2.Сумма,Истина,Истина,УчетНДС.ПолучитьСтавкуНДС(Стр2.СтавкаНДС));
		//КонецЦикла;
	КонецЕсли;
Конецпроцедуры


&НаКлиенте
Процедура ОтработанноеВремяПриНачалеРедактирования(Элемент, НоваяСтрока, Копирование)
	// Вставить содержимое обработчика.
	//Сообщить("При начале редакт");
КонецПроцедуры


&НаКлиенте
Процедура ОтработанноеВремя1ПриИзменении(Элемент)
	ТекДанные= Элементы.ОтработанноеВремя1.ТекущиеДанные;
	Если Найти(Элемент.Имя	,"ВторойЧасов") Тогда
		//Проверка на допустиые значения
	КонецЕсли;
	
	ИтогоЧасов = 0;
	Для Сч=1 По 31 Цикл
		Попытка
			ТекЧисло = Число(ТекДанные["ВторойЧасов"+Сч]);
		Исключение
			ТекЧисло =0;
		КонецПопытки;
		ИтогоЧасов =ИтогоЧасов + ТекЧисло ;
	КонецЦикла;
	ТекДанные.ВсегоЧасовПлан=  ИтогоЧасов;
	
КонецПроцедуры


&НаКлиенте
Процедура ОтработанноеВремяПередНачаломДобавления(Элемент, Отказ, Копирование, Родитель, Группа, Параметр)
	Отказ= Не МожноРедактироватьВсеДаные();
КонецПроцедуры


&НаСервере
Процедура БригадаСпрПриИзмененииНаСервере()
	//Справочники.Сотрудники.ЗаполнитьСписокВыбора(Элементы.БригадаСпр);	// Вставить содержимое обработчика.
КонецПроцедуры


&НаКлиенте
Процедура БригадаСпрПриИзменении(Элемент)
	БригадаСпрПриИзмененииНаСервере();
КонецПроцедуры


&НаСервере
Процедура ПриЧтенииНаСервере(ТекущийОбъект)
	ДатыЗапретаИзменения.ОбъектПриЧтенииНаСервере(ЭтаФорма, ТекущийОбъект);

КонецПроцедуры

