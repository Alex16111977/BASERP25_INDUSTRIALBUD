
&НаСервере
Процедура ПерепровестиДокументыНаСервере()
		
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ДенежныеСредстваФинАгенты.Регистратор
		|ИЗ
		|	РегистрНакопления.ДенежныеСредстваФинАгенты КАК ДенежныеСредстваФинАгенты
		|ГДЕ
		|	ДенежныеСредстваФинАгенты.Регистратор <> &Ссылка
		|
		|СГРУППИРОВАТЬ ПО
		|	ДенежныеСредстваФинАгенты.Регистратор
		|
		|УПОРЯДОЧИТЬ ПО
		|	ДенежныеСредстваФинАгенты.Регистратор.Дата";
	
	Запрос.УстановитьПараметр("Ссылка", Объект.Ссылка);
	
	Выборка = Запрос.Выполнить().Выбрать();
	
	Пока Выборка.Следующий() Цикл
		ДокументОбъект = Выборка.Регистратор.ПолучитьОбъект();
		Попытка 
			ДокументОбъект.Записать(РежимзаписиДокумента.Проведение);
		исключение   
			Сообщить(ОписаниеОшибки());
		конецпопытки;
		
	КонецЦикла;

КонецПроцедуры

&НаКлиенте
Процедура ПерепровестиДокументы(Команда)
 ТекстВопроса = "Перепровести все документы по фин агентам?";
    Заголовок = "Подтверждение действия";
    
    // Создаём описание оповещения для обработки ответа
    ОписаниеОповещения = Новый ОписаниеОповещения("ОбработкаОтветаПользователя", ЭтотОбъект);
    
    // Показываем вопрос пользователю
    ПоказатьВопрос(ОписаниеОповещения, ТекстВопроса, РежимДиалогаВопрос.ДаНет,, КодВозвратаДиалога.Нет, Заголовок);

КонецПроцедуры   

// Обработчик ответа пользователя
&НаКлиенте
Процедура ОбработкаОтветаПользователя(Результат, ДополнительныеПараметры) Экспорт
    Если Результат = КодВозвратаДиалога.Да Тогда
        Сообщить("Проводятся документы");
        // Вызываем серверную процедуру, если нужно
        ПерепровестиДокументыНаСервере();
    Иначе
        Сообщить("Пользователь отменил действие.");
    КонецЕсли;
КонецПроцедуры

&НаСервере
Процедура ПриЧтенииНаСервере(ТекущийОбъект)
	ДатыЗапретаИзменения.ОбъектПриЧтенииНаСервере(ЭтаФорма, ТекущийОбъект);

КонецПроцедуры
