
&НаСервере
Процедура ЗаполнитьОстаткамиНаСервере()

	Объект.ОстаткиКасс.Очистить();
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ДенежныеСредстваОстатки.БанковскийСчетКасса КАК Касса,
		|	ДенежныеСредстваОстатки.СуммаОстаток КАК Остаток
		|ИЗ
		|	РегистрНакопления.ДенежныеСредства.Остатки(&Дата, ВидДенежныхСредств = &Касса) КАК ДенежныеСредстваОстатки";
	
	Запрос.УстановитьПараметр("Дата", Объект.Дата);
	Запрос.УстановитьПараметр("Касса", Перечисления.ВидыДенежныхСредств.Наличные);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
	
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
		Нстрока = Объект.ОстаткиКасс.Добавить();
		ЗаполнитьЗначенияСвойств(Нстрока,ВыборкаДетальныеЗаписи); 
		Если ЗначениеЗаполнено(ВыборкаДетальныеЗаписи.Касса._Направление) Тогда  
			СтруктураПроцентФинАгента = РегистрыСведений.ПроцентКомиссииФинАгента.ПолучитьПоследнее(Объект.Дата,Новый Структура("Направление",ВыборкаДетальныеЗаписи.Касса._Направление));
			Если СтруктураПроцентФинАгента.ПроцентКомиссии<>0 Тогда    
				 Нстрока.Комиссия = ВыборкаДетальныеЗаписи.Остаток * СтруктураПроцентФинАгента.ПроцентКомиссии/100; 
			КонецЕсли;
		КонецЕсли;
	КонецЦикла;

КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьОстатками(Команда)
	ЗаполнитьОстаткамиНаСервере();
КонецПроцедуры
