// СтандартныеПодсистемы.ВерсионированиеОбъектов
// Определяет настройки объекта для подсистемы ВерсионированиеОбъектов.
//
// Параметры:
// Настройки - Структура - настройки подсистемы.
Процедура ПриОпределенииНастроекВерсионированияОбъектов(Настройки) Экспорт
КонецПроцедуры
// Конец СтандартныеПодсистемы.ВерсионированиеОбъектов


Функция ЗаполнитьСписокВыбора(Элемент) Экспорт
	
	// Заполним список выбора элемента формы.
	// Он может быть только чтением, поэтому передаем его в параметре.
	// Следует учесть одну особенность 1С. Если значение нет в списке выбора, оно будет пустым,
	// поэтому очищать его не стоит самому.
	Список = Элемент.СписокВыбора;
	Список.Очистить();
	
	НадоУстановитьПривилегированныйРежим = Ложь;
	НадоУстановитьПривилегированныйРежим = Истина;
	
	Если НадоУстановитьПривилегированныйРежим Тогда
		УстановитьПривилегированныйРежим(Истина);
	КонецЕсли; 
	
	ТекстЗапроса =
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	Подразделения.Ссылка,
	|	Подразделения.Наименование
	|ИЗ
	|	Справочник.Подразделения КАК Подразделения
	|ГДЕ
	|	Подразделения.НеИспользовать = ЛОЖЬ
	|	И ВЫБОР
	|			КОГДА Подразделения.Родитель = ЗНАЧЕНИЕ(Справочник.Подразделения.ПустаяСсылка)
	|				ТОГДА Подразделения.НеИспользовать = ЛОЖЬ
	|			ИНАЧЕ Подразделения.Родитель.НеИспользовать = ЛОЖЬ
	|		КОНЕЦ";
	//Если НадоУстановитьПривилегированныйРежим Тогда
	//	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "РАЗРЕШЕННЫЕ", "");
	//	ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "Элементы.Владелец В ИЕРАРХИИ(&Владелец)", "Истина");
	//КонецЕсли; 
	//УстановитьПривилегированныйРежим(Истина);
	Запрос = Новый Запрос(ТекстЗапроса);
	Выборка = Запрос.Выполнить().Выбрать();
	
	Пока Выборка.Следующий() Цикл
		Список.Добавить(Выборка.Ссылка, Выборка.Наименование);
	КонецЦикла;
	
	УстановитьПривилегированныйРежим(Ложь);
КонецФункции

Процедура ОбработкаПолученияДанныхВыбора(ДанныеВыбора, Параметры, СтандартнаяОбработка)
	// Вставить содержимое обработчика.
	СтандартнаяОбработка=Ложь;
	
	//УстановитьПривилегированныйРежим(Истина);

	Запрос = Новый Запрос("ВЫБРАТЬ РАЗРЕШЕННЫЕ
	                      |	Подразделения.Ссылка
	                      |ИЗ
	                      |	Справочник.Подразделения КАК Подразделения
	                      |ГДЕ
	                      |	Подразделения.Наименование ПОДОБНО &Наименование
	                      |	И Подразделения.НеИспользовать = ЛОЖЬ
	                      |	И ВЫБОР
	                      |			КОГДА Подразделения.Родитель = ЗНАЧЕНИЕ(Справочник.Подразделения.ПустаяСсылка)
	                      |				ТОГДА Подразделения.НеИспользовать = ЛОЖЬ
	                      |			ИНАЧЕ Подразделения.Родитель.НеИспользовать = ЛОЖЬ
	                      |		КОНЕЦ");
	
	Запрос.УстановитьПараметр("Наименование", "%" + Параметры.СтрокаПоиска + "%");
	// Конструкция "%" + Параметры.СтрокаПоиска + "%" показывает что в начале и в конце строки
	//может быть неопределенное количество символов
	Таблица = Запрос.Выполнить().Выгрузить();
	//Выгружаем таблицу в массив чтобы потом загрузить ее в данные выбора
	Массив = Таблица.ВыгрузитьКолонку("Ссылка");
	ДанныеВыбора = Новый СписокЗначений; // Переопределяем данные выбора т.к. по
	//умолчанию они имею тип - "неопределено"
	ДанныеВыбора.ЗагрузитьЗначения(Массив);
	
	//УстановитьПривилегированныйРежим(Ложь);

	СтандартнаяОбработка=Ложь;
КонецПроцедуры

Процедура ОбработкаПолученияФормы(ВидФормы, Параметры, ВыбраннаяФорма, ДополнительнаяИнформация, СтандартнаяОбработка)
	// Вставить содержимое обработчика.
КонецПроцедуры
