Функция ПолучитьРодителяПодразделения(Знач Подразделение)
	Пока ЗначениеЗаполнено(Подразделение.Родитель) Цикл
		Подразделение = Подразделение.Родитель;
	КонецЦикла; 
	Возврат Подразделение;
КонецФункции

Функция ЗаполнитьСписокВыбора(Элемент, Подразделение) Экспорт
	
	// Заполним список выбора элемента формы.
	// Он может быть только чтением, поэтому передаем его в параметре.
	// Следует учесть одну особенность 1С. Если значение нет в списке выбора, оно будет пустым,
	// поэтому очищать его не стоит самому.
	Список = Элемент.СписокВыбора;
	Список.Очистить();
	
	НадоУстановитьПривилегированныйРежим = Ложь;
	Если Подразделение=Неопределено Тогда
		НадоУстановитьПривилегированныйРежим = Истина;
	КонецЕсли; 
	
	Если НадоУстановитьПривилегированныйРежим Тогда
		УстановитьПривилегированныйРежим(Истина);
	КонецЕсли; 
	
	ТекстЗапроса =
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	Элементы.Ссылка,
	|	Элементы.Наименование
	|ИЗ
	|	Справочник.Кассы КАК Элементы
	|ГДЕ
	|	Элементы.Владелец В ИЕРАРХИИ(&Владелец)
	|	И НЕ Элементы.ПометкаУдаления
	|	И Элементы.НеИспользовать = ЛОЖЬ";
	Если НадоУстановитьПривилегированныйРежим Тогда
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "РАЗРЕШЕННЫЕ", "");
		ТекстЗапроса = СтрЗаменить(ТекстЗапроса, "Элементы.Владелец В ИЕРАРХИИ(&Владелец)", "Истина");
	КонецЕсли; 
	Запрос = Новый Запрос(ТекстЗапроса);
	Если Подразделение<>Неопределено Тогда
		Запрос.УстановитьПараметр("Владелец", ПолучитьРодителяПодразделения(Подразделение));
	КонецЕсли; 
	Выборка = Запрос.Выполнить().Выбрать();
	
	Пока Выборка.Следующий() Цикл
		Список.Добавить(Выборка.Ссылка, Выборка.Наименование);
	КонецЦикла;
	
КонецФункции